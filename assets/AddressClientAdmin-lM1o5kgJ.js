import{_ as de,r as m,z as ge,A as me,T as L,u as pe,c as R,w as Ne,o as fe,a as c,b as d,d as u,e as g,f as l,i as o,h as v,j as M,L as _e,t as r,F as S,m as E,B as V,k as p,y as z,a6 as ve,n as C,a7 as Ce,E as k,R as J,G as be}from"./index-BFtI-PwE.js";import{b as ye}from"./KhachHangServices-DSZDVUWy.js";import{u as Ve,a as ke}from"./DiaChiServices-RoJFDHKy.js";import{p as Te,w as Pe}from"./ward-CwBRO0K0.js";const we={class:"address-view"},xe={class:"header-section"},De={key:0},Ae={key:1},Be={class:"address-list"},Me={class:"address-content"},Se={class:"address-details"},Ee={class:"address-actions"},Ue={class:"action-buttons"},Oe={class:"footer-actions"},qe={key:0,class:"error-message"},Fe={key:0,class:"error-message"},Ke={key:0,class:"error-message"},je={key:0,class:"error-message"},He={key:0,class:"error-message"},Le={class:"switch-container"},Re={key:0,class:"note"},ze={key:0,class:"error-message"},Je={class:"dialog-footer"},Xe={__name:"AddressClientAdmin",setup($e){const f=m([]),X=m(null),$=m(null),U=ge(),I=me(),i=L({}),P=m(Object.values(Te)),w=m(Object.values(Pe).flat()),b=m(!1),_=m(!1),x=m(!1),O=m({}),G=pe(),n=L({id:null,tenNguoiNhan:"",sdtNguoiNhan:"",emailNguoiNhan:"",soNha:"",tenDuong:"",xaPhuong:null,tinhThanhPho:null,diaChiChinh:!1}),Q=R(()=>n.tinhThanhPho?w.value.filter(t=>t.parent_code===String(n.tinhThanhPho)):[]);Ne(()=>n.tinhThanhPho,()=>{n.xaPhuong=null});const W={tenNguoiNhan:[{required:!0,message:"Vui lòng nhập tên người nhận",trigger:"blur"}],sdtNguoiNhan:[{required:!0,message:"Vui lòng nhập số điện thoại",trigger:"blur"},{pattern:/^[0-9]{10}$/,message:"Số điện thoại không hợp lệ",trigger:"blur"}],soNha:[{required:!0,message:"Vui lòng nhập thông tin cụ thể",trigger:"blur"}],tenDuong:[{required:!0,message:"Vui lòng nhập thôn/làng",trigger:"blur"}],xaPhuong:[{required:!0,message:"Vui lòng nhập xã/phường",trigger:"blur"}],emailNguoiNhan:[{required:!0,message:"Vui lòng nhập email người nhận",trigger:"blur"}],tinhThanhPho:[{required:!0,message:"Vui lòng nhập tỉnh/thành phố",trigger:"blur"}]},T=m(),q=async()=>{try{const t=U.params.idClient;console.log(t);const a=await ye(t);f.value=a}catch(t){X.value=t}},F=()=>{var t;Object.assign(n,{id:null,tenNguoiNhan:"",sdtNguoiNhan:"",soNha:"",tenDuong:"",xaPhuong:"",emailNguoiNhan:"",tinhThanhPho:"",diaChiChinh:!1}),(t=T.value)==null||t.clearValidate()},Y=()=>{if(f.value.length>=5){k.warning("Mỗi khách hàng chỉ được phép có tối đa 5 địa chỉ");return}_.value=!1,F(),b.value=!0},D=m(!1),Z=t=>{_.value=!0,n.id=t.id,n.tenNguoiNhan=t.tenNguoiNhan,n.sdtNguoiNhan=t.sdtNguoiNhan,n.emailNguoiNhan=t.emailNguoiNhan,n.soNha=t.soNha,n.tenDuong=t.tenDuong,n.diaChiChinh=t.diaChiChinh;const a=P.value.find(s=>s.name===t.tinhThanhPho);n.tinhThanhPho=(a==null?void 0:a.code)||"",be(()=>{const s=w.value.find(h=>h.name===t.xaPhuong&&h.parent_code===n.tinhThanhPho);n.xaPhuong=(s==null?void 0:s.code)||""}),D.value=t.diaChiChinh,O.value=JSON.parse(JSON.stringify(n)),b.value=!0},ee=R(()=>JSON.stringify(n)!==JSON.stringify(O.value)),A=()=>{b.value=!1,F()},ne=async()=>{if(T.value)try{await T.value.validate(),x.value=!0,Object.keys(i).forEach(h=>delete i[h]);const t=P.value.find(h=>h.code===n.tinhThanhPho),a=w.value.find(h=>h.code===n.xaPhuong);if(!t||!a){G.warning("Vui lòng chọn tỉnh và xã hợp lệ.");return}const s={id:n.id,tenNguoiNhan:n.tenNguoiNhan,sdtNguoiNhan:n.sdtNguoiNhan,soNha:n.soNha,tenDuong:n.tenDuong,xaPhuong:(a==null?void 0:a.name)||"",emailNguoiNhan:n.emailNguoiNhan,tinhThanhPho:(t==null?void 0:t.name)||"",diaChiChinh:n.diaChiChinh,idKhachHang:U.params.idClient};if(_.value){await J.confirm("Bạn có chắc chắn muốn cập nhật địa chỉ này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"});const h=await Ve(s.id,s);console.log("Updating address:",s,h),k.success("Cập nhật địa chỉ thành công!")}else{await J.confirm("Bạn có chắc chắn muốn thêm địa chỉ này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"});const h=await ke(s);console.log("Adding new address:",s,h),k.success("Thêm địa chỉ thành công!")}await q(),A()}catch(t){if(t==="cancel"||t==="close")return;console.error("Form validation failed:",t),Array.isArray(t)?t.forEach(({field:a,message:s})=>{i[a]=s}):k.error(_.value?"Cập nhật địa chỉ thất bại":"Thêm địa chỉ thất bại")}finally{x.value=!1}},ae=t=>{const a=f.value.find(s=>s.id===t);a&&Z(a)},te=()=>{Y()},le=()=>{I.push("/admin/client")};function oe(t){D.value===!0&&t===!1&&(n.diaChiChinh=!0,k.error("Không thể bỏ trạng thái địa chỉ chính. Mỗi khách hàng phải có ít nhất một địa chỉ chính."))}return fe(()=>{q()}),(t,a)=>{const s=c("el-icon"),h=c("el-button"),B=c("el-descriptions-item"),ie=c("el-descriptions"),se=c("el-tag"),he=c("el-card"),y=c("el-input"),N=c("el-form-item"),K=c("el-option"),j=c("el-select"),ue=c("el-switch"),re=c("el-form"),ce=c("el-dialog");return u(),d("div",we,[g("div",xe,[f.value.length==0?(u(),d("h2",De,"Khách hàng chưa cập nhật địa chỉ")):(u(),d("h2",Ae,"Địa chỉ giao hàng")),l(h,{type:"primary",onClick:te,disabled:f.value.length>=5,class:"add-address-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(M(_e))]),_:1}),v(" Thêm địa chỉ ("+r(f.value.length)+"/5) ",1)]),_:1},8,["disabled"])]),g("div",Be,[(u(!0),d(S,null,E(f.value,e=>(u(),V(he,{key:e.id,class:C(["address-card",{"is-default":e.diaChiChinh}]),shadow:"hover",onClick:H=>!e.diaChiChinh&&t.selectAddress(e.id)},{default:o(()=>[g("div",Me,[g("div",Se,[l(ie,{column:1,border:""},{default:o(()=>[l(B,{label:"Người nhận:"},{default:o(()=>[g("span",null,r(e.tenNguoiNhan!=null?e.tenNguoiNhan:"Không có thông tin"),1)]),_:2},1024),l(B,{label:"Số điện thoại:"},{default:o(()=>[g("span",null,r(e.sdtNguoiNhan!=null?e.sdtNguoiNhan:"Không có thông tin"),1)]),_:2},1024),l(B,{label:"Địa chỉ:"},{default:o(()=>[g("span",null,r(e.soNha!=null?e.soNha:"")+r(e.soNha?", ":"")+r(e.tenDuong!=null?e.tenDuong:"")+r(e.tenDuong?", ":"")+" "+r(e.xaPhuong!=null?e.xaPhuong:"")+r(e.xaPhuong?", ":"")+r(e.tinhThanhPho!=null?e.tinhThanhPho:""),1)]),_:2},1024)]),_:2},1024)]),g("div",Ee,[e.diaChiChinh?(u(),V(se,{key:0,type:"danger",effect:"plain",class:"default-tag"},{default:o(()=>a[9]||(a[9]=[v(" Mặc định ")])),_:1})):p("",!0),g("div",Ue,[l(h,{type:"primary",size:"small",circle:"",onClick:z(H=>ae(e.id),["stop"]),title:"Chỉnh sửa"},{default:o(()=>[l(s,null,{default:o(()=>[l(M(ve))]),_:1})]),_:2},1032,["onClick"]),$.value===e.id&&!e.diaChiChinh?(u(),V(h,{key:0,type:"success",size:"small",onClick:z(H=>t.setPrimary(e),["stop"]),class:"set-primary-btn"},{default:o(()=>a[10]||(a[10]=[v(" Đặt làm mặc địnhhh ")])),_:2},1032,["onClick"])):p("",!0)])])])]),_:2},1032,["class","onClick"]))),128)),g("div",Oe,[l(h,{onClick:le,type:"info"},{default:o(()=>[l(s,null,{default:o(()=>[l(M(Ce))]),_:1}),a[11]||(a[11]=v(" Quay lại "))]),_:1})])]),l(ce,{modelValue:b.value,"onUpdate:modelValue":a[8]||(a[8]=e=>b.value=e),title:_.value?"Chỉnh sửa địa chỉ":"Thêm địa chỉ mới",width:"600px","before-close":A},{footer:o(()=>[g("div",Je,[l(h,{onClick:A},{default:o(()=>a[12]||(a[12]=[v("Hủy")])),_:1}),l(h,{type:"primary",onClick:ne,loading:x.value,disabled:_.value&&!ee.value},{default:o(()=>[v(r(_.value?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading","disabled"])])]),default:o(()=>[l(re,{ref_key:"formRef",ref:T,model:n,rules:W,"label-width":"140px","label-position":"left"},{default:o(()=>[l(N,{label:"Tên người nhận",prop:"tenNguoiNhan"},{default:o(()=>[l(y,{modelValue:n.tenNguoiNhan,"onUpdate:modelValue":a[0]||(a[0]=e=>n.tenNguoiNhan=e),placeholder:"Nhập tên người nhận",clearable:"",class:C({"is-error":i.tenNguoiNhan})},null,8,["modelValue","class"]),i.tenNguoiNhan?(u(),d("div",qe,r(i.tenNguoiNhan),1)):p("",!0)]),_:1}),l(N,{label:"Số điện thoại",prop:"sdtNguoiNhan"},{default:o(()=>[l(y,{modelValue:n.sdtNguoiNhan,"onUpdate:modelValue":a[1]||(a[1]=e=>n.sdtNguoiNhan=e),placeholder:"Nhập số điện thoại",clearable:"",maxlength:"10",class:C({"is-error":i.sdtNguoiNhan})},null,8,["modelValue","class"]),i.sdtNguoiNhan?(u(),d("div",Fe,r(i.sdtNguoiNhan),1)):p("",!0)]),_:1}),l(N,{label:"Email người nhận",prop:"emailNguoiNhan"},{default:o(()=>[l(y,{modelValue:n.emailNguoiNhan,"onUpdate:modelValue":a[2]||(a[2]=e=>n.emailNguoiNhan=e),placeholder:"Nhập email người nhận",clearable:"",class:C({"is-error":i.emailNguoiNhan})},null,8,["modelValue","class"]),i.emailNguoiNhan?(u(),d("div",Ke,r(i.emailNguoiNhan),1)):p("",!0)]),_:1}),l(N,{label:"Tỉnh/Thành phố",prop:"tinhThanhPho"},{default:o(()=>[l(j,{modelValue:n.tinhThanhPho,"onUpdate:modelValue":a[3]||(a[3]=e=>n.tinhThanhPho=e),placeholder:"Chọn tỉnh/thành phố",clearable:""},{default:o(()=>[(u(!0),d(S,null,E(P.value,e=>(u(),V(K,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(N,{label:"Xã/Phường",prop:"xaPhuong"},{default:o(()=>[l(j,{modelValue:n.xaPhuong,"onUpdate:modelValue":a[4]||(a[4]=e=>n.xaPhuong=e),disabled:!n.tinhThanhPho,placeholder:"Chọn xã/phường",clearable:""},{default:o(()=>[(u(!0),d(S,null,E(Q.value,e=>(u(),V(K,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(N,{label:"Thôn/làng",prop:"tenDuong"},{default:o(()=>[l(y,{modelValue:n.tenDuong,"onUpdate:modelValue":a[5]||(a[5]=e=>n.tenDuong=e),placeholder:"Nhập tên thôn/làng",clearable:"",class:C({"is-error":i.tenDuong})},null,8,["modelValue","class"]),i.tenDuong?(u(),d("div",je,r(i.tenDuong),1)):p("",!0)]),_:1}),l(N,{label:"Cụ thể",prop:"soNha"},{default:o(()=>[l(y,{modelValue:n.soNha,"onUpdate:modelValue":a[6]||(a[6]=e=>n.soNha=e),placeholder:"Nhập thông tin cụ thể",clearable:"",class:C({"is-error":i.soNha})},null,8,["modelValue","class"]),i.soNha?(u(),d("div",He,r(i.soNha),1)):p("",!0)]),_:1}),l(N,{label:"Địa chỉ chính"},{default:o(()=>[g("div",Le,[l(ue,{modelValue:n.diaChiChinh,"onUpdate:modelValue":a[7]||(a[7]=e=>n.diaChiChinh=e),onChange:oe,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"]),D.value?(u(),d("span",Re," (Địa chỉ chính không thể bỏ chọn) ")):p("",!0)]),i.diaChiChinh?(u(),d("div",ze,r(i.diaChiChinh),1)):p("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ye=de(Xe,[["__scopeId","data-v-180558e8"]]);export{Ye as default};
