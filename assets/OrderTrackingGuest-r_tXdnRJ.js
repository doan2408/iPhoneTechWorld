import{_ as ln,T as rn,z as cn,u as dn,c as u,r as d,w as gn,o as hn,b as l,d as o,e as n,B as b,k as c,t as i,f as g,h as M,j as h,n as y,F as m,m as v,a0 as I,v as O,Z as un,X as pn}from"./index-I05jmhuU.js";import{h as mn,b as vn}from"./MyOrderClient-DquLT7bn.js";import{C as _n}from"./ConfirmModal-u76TAxHq.js";import{u as yn,c as Tn}from"./ActionAfterCaseServices-BFZbvqk8.js";import{S as fn,P as F,T as Dn,R as Cn,C as bn,U as L,a as Hn,M as kn,b as Gn,c as Nn}from"./GiaoHangServices-Cjg39Jro.js";import{F as wn,C as Sn,a as Mn}from"./file-text-BNSMHWWn.js";import{T as B}from"./truck-DBVMS4Gv.js";import{C as In}from"./circle-check-big-DbQEdKiO.js";import{X as Ln}from"./x-BLXPrgBB.js";import{H as En}from"./history-BHNFF5NA.js";import"./createLucideIcon-GQ3IAryt.js";const xn={class:"delivery-tracking-container"},Vn={class:"order-header"},An={class:"order-info"},Rn={key:0},Pn={key:1},On={class:"order-date"},Fn={class:"info-item"},Bn={class:"order-summary"},Un={class:"total-info"},Kn={class:"total-amount"},$n={class:"timeline-section"},Xn={class:"timeline-wrapper"},jn={class:"step-icon"},zn={class:"step-content"},qn={class:"step-title"},Yn={key:0,class:"step-time"},Zn={key:1,class:"step-description"},Jn={key:0,class:"step-arrow"},Qn={class:"timeline-section-row"},Wn={class:"timeline-section timeline-shipping"},nt={class:"timeline-wrapper"},tt={class:"step-icon"},st={class:"step-content"},et={class:"step-title"},at={key:0,class:"step-time"},it={key:1,class:"step-description"},ot={key:0,class:"step-arrow-shipping"},lt={class:"timeline-section timeline-false"},rt={class:"timeline-wrapper"},ct={class:"step-icon"},dt={class:"step-content"},gt={class:"step-title"},ht={key:0,class:"step-time"},ut={key:1,class:"step-description"},pt={class:"actions-section"},mt={class:"left-actions"},vt={key:1,class:"return-overlay"},_t={class:"return-modal"},yt={class:"return-imei-list"},Tt=["onUpdate:modelValue"],ft={class:"return-imei-info"},Dt={class:"imei-main"},Ct={class:"imei-sub"},bt={key:0,class:"return-selected-empty"},Ht={key:0,class:"return-selected"},kt={class:"return-table"},Gt=["onUpdate:modelValue"],Nt=["value"],wt={class:"upload-group"},St=["onChange"],Mt={key:0,class:"upload-preview"},It={class:"upload-group"},Lt=["onChange"],Et={key:0,class:"upload-preview"},xt={class:"return-actions"},Vt=["disabled"],At={class:"right-actions"},Rt={class:"delivery-details"},Pt={class:"details-grid"},Ot={class:"detail-card customer-card"},Ft={class:"card-header"},Bt={class:"card-content"},Ut={class:"customer-info"},Kt={class:"customer-avatar"},$t={class:"customer-details"},Xt={class:"contact-info"},jt={class:"contact-item"},zt={class:"contact-item"},qt={class:"contact-item"},Yt={class:"detail-card delivery-card"},Zt={class:"card-header"},Jt={class:"card-content"},Qt={class:"delivery-info"},Wt={class:"info-item"},ns={class:"info-item"},ts={key:0,class:"driver-info"},ss={class:"driver-avatar"},es={class:"driver-name"},as={class:"driver-phone"},is={key:1,class:"no-driver"},os={class:"info-item"},ls={class:"detail-card items-card"},rs={class:"card-header"},cs={class:"card-content"},ds={class:"items-summary"},gs=["src","alt"],hs={class:"item-info"},us={class:"item-name"},ps={class:"item-qty"},ms={class:"item-price"},vs={class:"total-summary"},_s={class:"total-row"},ys={class:"total-price"},Ts={key:1,class:"history-overlay"},fs={class:"history-modal"},Ds={class:"history-title"},Cs={class:"history-list"},bs={class:"history-action"},Hs={class:"history-time"},ks={class:"history-description"},Gs={key:0,class:"no-history"},Ns={class:"history-actions"},ws={__name:"OrderTrackingGuest",setup(Ss){const e=rn({}),f=cn(),E=dn(),H=async()=>{const a=f.params.id;if(a)try{const t=await mn(a);Object.assign(e,t.data)}catch(t){console.error("Lỗi khi tải chi tiết đơn hàng:",t)}},U=a=>{switch(a){case"SILVER":return"silver";case"GOLD":return"gold";case"DIAMOND":return"diamond";default:return"member"}},K=a=>{switch(a){case"SILVER":return"Bạc";case"GOLD":return"Vàng";case"DIAMOND":return"Kim cương";case"MEMBER":return"Thành viên";default:return"Không có hạng"}},$=u(()=>[{id:1,title:"Đặt Hàng Thành Công",icon:wn,status:e.trangThaiDonHang==="Chờ xử lý"?"current":["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng","Đã xác nhận","Sẵn sàng giao","Đã hủy"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:e.ngayDatHang,description:"Đơn hàng đang chờ được xác nhận"},{id:2,title:"Đơn hàng đã được xác nhận",icon:fn,status:e.trangThaiDonHang==="Đã xác nhận"?"current":["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng","Sẵn sàng giao"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:null,description:"Đơn hàng đang chờ được đóng gói"},{id:3,title:"Đã Đóng Gói",icon:F,status:e.trangThaiDonHang==="Đã đóng gói"?"current":["Đang giao","Đã giao","Giao thất bại","Trả hàng","Sẵn sàng giao"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.packedAt:null,description:["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng đã được đóng gói":null},{id:4,title:"Sẵn sàng giao",icon:Sn,status:e.trangThaiDonHang==="Sẵn sàng giao"?"current":["Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.packedAt:null,description:["Đã đóng gói","Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng sắp dược giao":null}]),X=u(()=>[{id:1,title:"Đang Giao",icon:B,status:e.trangThaiDonHang==="Đang giao"?"current":["Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:["Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.shippingAt:null,description:["Đang giao","Đã giao","Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng đang được giao":null},{id:2,title:"Giao Hàng Thành Công",icon:In,status:e.trangThaiDonHang==="Đã giao"?"current":["Trả hàng"].includes(e.trangThaiDonHang)?"completed":"pending",timestamp:e.trangThaiDonHang==="Đã giao"?e.deliveredAt:null,description:e.trangThaiDonHang==="Đã giao"?"Khách hàng đã nhận hàng":null}]),j=u(()=>[{id:1,title:"Giao Thất Bại",icon:Mn,status:["Giao thất bại"].includes(e.trangThaiDonHang)?"current":"pending",timestamp:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.failedAt:null,description:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng giao thất bại":null},{id:2,title:"Trả hàng",icon:Dn,status:["Trả hàng"].includes(e.trangThaiDonHang)?"current":"pending",timestamp:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.failedAt:null,description:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng Trả hàng":null},{id:3,title:"Đã hủy",icon:Cn,status:["Đã hủy"].includes(e.trangThaiDonHang)?"current":"pending",timestamp:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?e.failedAt:null,description:["Giao thất bại","Trả hàng"].includes(e.trangThaiDonHang)?"Đơn hàng đã bị hủy":null}]);u(()=>e.trangThaiDonHang==="Chờ xử lý"),u(()=>e.trangThaiDonHang==="Đã xác nhận"),u(()=>e.trangThaiDonHang==="Đã đóng gói");const z=u(()=>["Chờ xử lý"].includes(e.trangThaiDonHang));u(()=>e.trangThaiDonHang==="Đang giao"),u(()=>e.trangThaiDonHang==="Đã giao"||e.trangThaiDonHang==="Trả hàng");const T=a=>{if(!a)return"N/A";const t=new Date(a);if(isNaN(t.getTime()))return"Invalid Date";const s=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),_=t.getFullYear();return`${s}/${r}/${_}`},k=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),q=a=>({pending:"Chờ xác nhận",confirmed:"Đã xác nhận",preparing:"Đang chuẩn bị",shipping:"Đang giao hàng",delivered:"Đã giao hàng",cancelled:"Đã hủy"})[a]||a;function Y(a){const t={pending:["Chờ xử lý","Đã xác nhận"],packed:["Đã đóng gói","Sẵn sàng giao"],shipping:["Đang giao"],delivered:["Đã giao"],failed:["Giao thất bại"],returned:["Trả hàng","Đã hủy"]};if(typeof a!="string")return a;const s=a.trim().toLowerCase();for(const[r,_]of Object.entries(t))if(_.some(C=>C.toLowerCase()===s))return r;return a}const Z=a=>!a||typeof a!="string"?"Chưa thanh toán":{PENDING:"Chưa thanh toán",CONFIRMED:"Chưa thanh toán",PAID:"Đã thanh toán",COMPLETED:"Hoàn tất",CANCELLED:"Hủy",REFUNDED:"Hoàn tiền"}[a.toUpperCase()]||"Chưa thanh toán",J=a=>!a||typeof a!="string"?"pending":{PENDING:"pending",CONFIRMED:"pending",PAID:"paid",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded"}[a.toUpperCase()]||"pending";d(!1),d(""),d([]);const G=d(!1),p=d([]);d("");const Q=d([]),x=async(a,t,s)=>{const r=a.target.files[0];if(!r)return;const _=new FormData;_.append("idImei",t.idImei),_.append("file",r);try{const P=(await yn(_)).data.url;s==="image"?t.urlHinh=P:t.urlVideo=P}catch(C){console.error("Upload lỗi:",C)}},W=async()=>{try{const a={idHoaDon:e.idHoaDon,imeis:p.value.filter(t=>t.selected).map(t=>({idHoaDonChiTiet:t.idHoaDonChiTiet,soImei:t.soImei,idFailReason:t.reasonId,urlHinh:t.urlHinh||null,urlVideo:t.urlVideo||null}))};await Tn(a),A("Trả hàng"),G.value=!1,p.value.forEach(t=>{t.selected=!1,t.reasonId=""})}catch(a){console.error("Lỗi khi trả hàng:",a)}},V=d(!1),A=async a=>{var s;const t=f.params.id;try{a==="Sẵn sàng giao"&&(V.value=!0,E.info("Đang tạo mã vận đơn...",{autoClose:2e3}));const r=await Nn(t,a);e.trangThaiDonHang=a,console.log(r.data),console.log(`Order status updated to: ${a}`),await H()}catch(r){console.error("Failed to update order status:",((s=r.response)==null?void 0:s.data)||r.message)}finally{V.value=!1}},nn=()=>{window.open(`tel:${e.sdtNguoiNhan}`)},tn=()=>{window.open(`mailto:${e.customer.email}`)},sn=()=>{e.driver&&window.open(`tel:${e.driver.phone}`)},N=d(!1),w=d([]),en=async()=>{try{const a=f.params.id,t=await vn(a);w.value=t.data,N.value=!0}catch(a){console.error("Lỗi khi lấy lịch sử hóa đơn:",a),E.error("Không thể tải lịch sử hóa đơn")}};gn(()=>f.params.id,()=>H()),hn(()=>{H()});const D=d(!1),R=d("");let S=null;function an(a,t){R.value=a,S=t,D.value=!0}function on(){S&&S(),D.value=!1}return(a,t)=>(o(),l("div",xn,[n("div",Vn,[n("div",An,[e.maVanDon?(o(),l("h1",Rn,"Đơn hàng #"+i(e.maVanDon),1)):(o(),l("h1",Pn,"Hóa đơn #"+i(e.maHoaDon),1)),n("p",On,[g(h(bn),{class:"icon-small"}),M(" Ngày đặt: "+i(T(e.ngayDatHang)),1)])]),n("div",Fn,[t[4]||(t[4]=n("strong",null,"Trạng thái đơn hàng",-1)),t[5]||(t[5]=n("br",null,null,-1)),n("span",{class:y("status status-"+Y(e.trangThaiDonHang))},i(q(e.trangThaiDonHang)),3)]),n("div",Bn,[n("div",Un,[t[6]||(t[6]=n("span",{class:"total-label"},[n("strong",null,"Tổng tiền")],-1)),n("span",Kn,i(k(e.thanhTien)),1)]),n("span",{class:y("payment-status "+J(e.trangThaiThanhToan))},i(Z(e.trangThaiThanhToan)),3)])]),n("div",$n,[n("div",Xn,[t[7]||(t[7]=n("div",{class:"timeline-line"},null,-1)),(o(!0),l(m,null,v($.value,(s,r)=>(o(),l("div",{key:s.id,class:y(["timeline-step",{active:s.status==="completed",current:s.status==="current",pending:s.status==="pending"}])},[n("div",jn,[(o(),b(I(s.icon),{class:"icon"}))]),n("div",zn,[n("div",qn,i(s.title),1),s.timestamp?(o(),l("div",Yn,i(T(s.timestamp)),1)):c("",!0),s.description?(o(),l("div",Zn,i(s.description),1)):c("",!0)]),s.status!=="pending"?(o(),l("div",Jn)):c("",!0)],2))),128))])]),n("div",Qn,[n("div",Wn,[n("div",nt,[t[8]||(t[8]=n("div",{class:"timeline-line"},null,-1)),(o(!0),l(m,null,v(X.value,(s,r)=>(o(),l("div",{key:s.id,class:y(["timeline-step",{active:s.status==="completed",current:s.status==="current",pending:s.status==="pending"}])},[n("div",tt,[(o(),b(I(s.icon),{class:"icon"}))]),n("div",st,[n("div",et,i(s.title),1),s.timestamp?(o(),l("div",at,i(T(s.timestamp)),1)):c("",!0),s.description?(o(),l("div",it,i(s.description),1)):c("",!0)]),s.status!=="pending"?(o(),l("div",ot)):c("",!0)],2))),128))])]),n("div",lt,[n("div",rt,[t[9]||(t[9]=n("div",{class:"timeline-line"},null,-1)),(o(!0),l(m,null,v(j.value,(s,r)=>(o(),l("div",{key:s.id,class:y(["timeline-step-false",{active:s.status==="completed",current:s.status==="current",pending:s.status==="pending"}])},[n("div",ct,[(o(),b(I(s.icon),{class:"icon"}))]),n("div",dt,[n("div",gt,i(s.title),1),s.timestamp?(o(),l("div",ht,i(T(s.timestamp)),1)):c("",!0),s.description?(o(),l("div",ut,i(s.description),1)):c("",!0)])],2))),128))])])]),n("div",pt,[n("div",mt,[z.value?(o(),l("button",{key:0,onClick:t[0]||(t[0]=s=>an("Bạn có chắc muốn hủy đơn?",()=>A("Đã hủy"))),class:"action-btn cancel-btn"},[g(h(Ln),{class:"icon-small"}),t[10]||(t[10]=M(" HỦY ĐƠN "))])):c("",!0),G.value?(o(),l("div",vt,[n("div",_t,[t[17]||(t[17]=n("h3",{class:"return-title"},"Chọn sản phẩm/IMEI muốn trả",-1)),n("div",yt,[(o(!0),l(m,null,v(p.value,s=>(o(),l("label",{key:s.idImei,class:"return-imei-item"},[O(n("input",{type:"checkbox","onUpdate:modelValue":r=>s.selected=r},null,8,Tt),[[un,s.selected]]),n("div",ft,[n("span",Dt,i(s.soImei),1),n("span",Ct,i(s.tenSanPham)+" - "+i(s.dungLuongRom)+" - "+i(s.tenMau)+" ("+i(s.giaBan.toLocaleString())+"đ) ",1)])]))),128)),p.value.length===0?(o(),l("div",bt,t[11]||(t[11]=[n("p",{style:{"text-align":"center",color:"red"}}," Tất cả sản phẩm đều đã được gửi yêu cầu trả hàng ",-1)]))):c("",!0)]),p.value.some(s=>s.selected)?(o(),l("div",Ht,[t[16]||(t[16]=n("h4",null,"Danh sách trả hàng",-1)),n("table",kt,[t[15]||(t[15]=n("thead",null,[n("tr",null,[n("th",null,"IMEI"),n("th",null,"Sản phẩm"),n("th",null,"Lý do trả")])],-1)),n("tbody",null,[(o(!0),l(m,null,v(p.value.filter(s=>s.selected),s=>(o(),l("tr",{key:s.idImei},[n("td",null,i(s.soImei),1),n("td",null,i(s.tenSanPham)+" - "+i(s.dungLuongRom)+" - "+i(s.tenMau),1),n("td",null,[O(n("select",{"onUpdate:modelValue":r=>s.reasonId=r,class:"return-select"},[t[12]||(t[12]=n("option",{disabled:"",value:""},"-- Chọn lý do --",-1)),(o(!0),l(m,null,v(Q.value,r=>(o(),l("option",{key:r.idReason,value:r.idReason},i(r.tenLyDo),9,Nt))),128))],8,Gt),[[pn,s.reasonId]]),n("div",wt,[t[13]||(t[13]=n("label",{class:"upload-label"},"Ảnh lỗi:",-1)),n("input",{type:"file",accept:"image/*",onChange:r=>x(r,s,"image")},null,40,St),s.urlHinh?(o(),l("span",Mt,"✅ Đã upload ảnh")):c("",!0)]),n("div",It,[t[14]||(t[14]=n("label",{class:"upload-label"},"Video lỗi:",-1)),n("input",{type:"file",accept:"video/*",onChange:r=>x(r,s,"video")},null,40,Lt),s.urlVideo?(o(),l("span",Et,"✅ Đã upload video")):c("",!0)])])]))),128))])])])):c("",!0),n("div",xt,[n("button",{class:"return-btn cancel",onClick:t[1]||(t[1]=s=>G.value=!1)},"Hủy"),n("button",{class:"return-btn confirm",disabled:!p.value.some(s=>s.selected)||p.value.filter(s=>s.selected).some(s=>!s.reasonId),onClick:W}," Xác nhận ",8,Vt)])])])):c("",!0)]),n("div",At,[n("button",{onClick:en,class:"action-btn print-btn"},[g(h(En),{class:"icon-small"}),t[18]||(t[18]=M(" XEM LỊCH SỬ "))])])]),D.value?(o(),b(_n,{key:0,message:R.value,onConfirm:on,onCancel:t[2]||(t[2]=s=>D.value=!1)},null,8,["message"])):c("",!0),t[28]||(t[28]=n("br",null,null,-1)),t[29]||(t[29]=n("br",null,null,-1)),n("div",Rt,[n("div",Pt,[n("div",Ot,[n("div",Ft,[g(h(L),{class:"icon"}),t[19]||(t[19]=n("h3",null,"Thông tin khách hàng",-1))]),n("div",Bt,[n("div",Ut,[n("div",Kt,[g(h(L),{class:"avatar-icon"})]),n("div",$t,[n("h4",null,i(e.tenNguoiMua||"Khách vãng lai")+" ( Người mua )",1),n("div",{class:y(["customer-type",U(e.hangKhachHang)])},[n("span",null,i(K(e.hangKhachHang)),1)],2)])]),t[21]||(t[21]=n("br",null,null,-1)),n("div",Xt,[t[20]||(t[20]=n("h5",null,"Thông tin người nhận",-1)),n("div",jt,[g(h(L),{class:"icon-small"}),n("span",null,i(e.tenNguoiNhan),1)]),n("div",zt,[g(h(Hn),{class:"icon-small"}),n("span",null,i(e.sdtNguoiNhan),1),n("button",{onClick:nn,class:"contact-btn"},"Gọi")]),n("div",qt,[g(h(kn),{class:"icon-small"}),n("span",null,i(e.emailNguoiNhan),1),n("button",{onClick:tn,class:"contact-btn"},"Email")])])])]),n("div",Yt,[n("div",Zt,[g(h(Gn),{class:"icon"}),t[22]||(t[22]=n("h3",null,"Thông tin giao hàng",-1))]),n("div",Jt,[n("div",Qt,[n("div",Wt,[t[23]||(t[23]=n("label",null,"Địa chỉ giao hàng",-1)),n("p",null,i(e.diaChiGiaoHang),1)]),n("div",ns,[t[24]||(t[24]=n("label",null,"Người giao hàng",-1)),e.driver?(o(),l("div",ts,[n("div",ss,[g(h(B),{class:"icon-small"})]),n("div",null,[n("p",es,i(e.driver.name),1),n("p",as,i(e.driver.phone),1)]),n("button",{onClick:sn,class:"contact-btn"},"Gọi")])):(o(),l("p",is,"Nhân viên cửa hàng"))]),n("div",os,[t[25]||(t[25]=n("label",null,"Ghi chú",-1)),n("p",null,i(e.deliveryNotes||"Không có ghi chú"),1)])])])]),n("div",ls,[n("div",rs,[g(h(F),{class:"icon"}),t[26]||(t[26]=n("h3",null,"Sản phẩm",-1))]),n("div",cs,[n("div",ds,[(o(!0),l(m,null,v(e.chiTietHoaDonAdminResponseList,s=>(o(),l("div",{key:s.id,class:"item-row"},[n("img",{src:s.imageSanPham,alt:s.name,class:"item-image"},null,8,gs),n("div",hs,[n("span",us,i(s.tenSanPham),1),n("span",ps,"x"+i(s.soLuong),1)]),n("span",ms,i(k(s.donGia)),1)]))),128))]),n("div",vs,[n("div",_s,[t[27]||(t[27]=n("span",null,"Tổng cộng:",-1)),n("span",ys,i(k(e.thanhTien)),1)])])])])])]),N.value?(o(),l("div",Ts,[n("div",fs,[n("h3",Ds,"Lịch sử hóa đơn #"+i(e.maHoaDon),1),n("div",Cs,[(o(!0),l(m,null,v(w.value,s=>(o(),l("div",{key:s.idLichSuHoaDon,class:"history-item"},[n("div",bs,i(s.hanhDong),1),n("div",Hs,i(T(s.thoiGianThayDoi)),1),n("div",ks,i(s.moTa),1)]))),128)),w.value.length?c("",!0):(o(),l("div",Gs," Không có lịch sử nào để hiển thị "))]),n("div",Ns,[n("button",{class:"history-btn cancel",onClick:t[3]||(t[3]=s=>N.value=!1)},"Đóng")])])])):c("",!0)]))}},Bs=ln(ws,[["__scopeId","data-v-1f36fbb0"]]);export{Bs as default};
