import{_ as Ce,r as u,c as Be,a1 as xe,w as Le,o as Se,a as d,a2 as He,b as S,d as p,e as n,f as l,B as C,k as B,i as t,h as b,j as x,L as ae,s as Pe,am as Xe,v as Ee,t as h,ao as Ge,a6 as le,F as te,m as oe,E as _,R as ne}from"./index-BFtI-PwE.js";import{g as ze,a as ie,b as Fe,u as Ue}from"./LoaiBaoHanhService-DrQv7Whi.js";import{m as Ae}from"./ProductAdminService-Cqy2_DSd.js";const De={class:"warranty-container"},Ne={class:"page-header"},Ke={class:"header-content"},$e={class:"filters-content"},qe={class:"filter-group"},Re={class:"filter-item"},je={class:"filter-actions"},Ie={class:"row-index"},Oe={class:"code-cell"},Qe={class:"code-cell"},We={class:"value-cell"},Je={class:"warranty-percent"},Ye={class:"name-cell"},Ze={class:"warranty-name"},ea={class:"name-cell"},aa={class:"warranty-name"},la={class:"action-buttons"},ta={class:"pagination-wrapper"},oa={class:"model-option"},na={class:"model-name"},ia={key:0,class:"model-origin"},sa={class:"dialog-footer"},ra={class:"model-option"},ua={class:"model-name"},da={key:0,class:"model-origin"},ha={class:"dialog-footer"},ca={key:0,class:"detail-content"},ma={class:"detail-row"},ga={class:"detail-row"},pa={class:"detail-value"},va={class:"detail-row"},fa={class:"detail-value"},ba={class:"detail-row"},_a={class:"detail-value highlight"},ya={class:"detail-row"},Ta={class:"detail-description"},wa={class:"dialog-footer"},Va={__name:"LoaiBaoHanhAdmin",setup(Ma){const H=u(""),M=u(!1),L=u(!1),j=u([]),y=u([]),c=u([]),T=u(null),m=u({}),A=u(!1),P=u(""),g=u({page:1,size:5,total:0}),X=u(!1),E=u(!1),D=u(!1),N=u(""),s=u({id:null,idModelSanPham:null,tenLoaiBaoHanh:"",thoiGianThang:null,moTa:""}),G=u(null),z=u(null),se=u({tenLoaiBaoHanh:[{required:!0,message:"Vui lòng nhập tên loại bảo hành",trigger:"blur"},{min:2,max:100,message:"Tên phải từ 2-100 ký tự",trigger:"blur"}],thoiGianThang:[{required:!0,message:"Vui lòng nhập thời gian bảo hành",trigger:"blur"},{type:"number",min:1,max:12,message:"Thời gian từ 1-12 tháng",trigger:"blur"}],trangThai:[{required:!0,message:"Vui lòng chọn trạng thái",trigger:"blur"}],moTa:[{max:500,message:"Mô tả không quá 500 ký tự",trigger:"blur"}],idModelSanPham:[{required:!0,message:"Vui lòng chọn model sản phẩm",trigger:"blur"}]}),re=u({tenLoaiBaoHanh:[{required:!0,message:"Vui lòng nhập tên loại bảo hành",trigger:"blur"},{min:2,max:100,message:"Tên phải từ 2-100 ký tự",trigger:"blur"}],thoiGianThang:[{required:!0,message:"Vui lòng nhập thời gian bảo hành",trigger:"blur"},{type:"number",min:1,max:12,message:"Thời gian từ 1-12 tháng",trigger:"blur"}],trangThai:[{required:!0,message:"Vui lòng chọn trạng thái",trigger:"blur"}],moTa:[{max:500,message:"Mô tả không quá 500 ký tự",trigger:"blur"}]}),I=Be(()=>{const o=xe.state.roles;return Array.isArray(o)&&o.map(e=>typeof e=="string"?e:e.authority).includes("ROLE_ADMIN")}),O=(o,e)=>{m.value[o]=e},K=()=>{Object.keys(m.value).forEach(o=>{delete m.value[o]})},Q=o=>{P.value=o,o!==""?(A.value=!0,setTimeout(()=>{c.value=y.value.filter(e=>{var U,v;const r=o.toLowerCase(),i=((U=e.tenModel)==null?void 0:U.toLowerCase())||"",k=((v=e.maXuatXu)==null?void 0:v.toLowerCase())||"";return i.includes(r)||k.includes(r)}),A.value=!1},200)):c.value=[...y.value]},W=()=>{c.value.length===0&&(c.value=[...y.value])},J=()=>{P.value="",c.value=[...y.value]},ue=async()=>{try{const o=await Ae();y.value=o,c.value=[...o]}catch(o){console.error("Lỗi khi lấy danh sách model sản phẩm:",o),_.error("Không thể lấy danh sách model sản phẩm"),y.value=[],c.value=[]}},F=()=>{s.value={id:null,idModelSanPham:null,tenLoaiBaoHanh:"",thoiGianThang:null,moTa:""},K(),P.value="",c.value=[...y.value],G.value&&G.value.resetFields(),z.value&&z.value.resetFields()},de=()=>{F(),N.value="Thêm loại bảo hành mới",X.value=!0,c.value=[...y.value]},he=async o=>{var e,r;try{M.value=!0;const i=await ie(o.id);s.value={id:i.id,tenLoaiBaoHanh:i.tenLoaiBaoHanh,idModelSanPham:i.idModelSanPham,thoiGianThang:i.thoiGianThang,moTa:i.moTa||"",trangThai:i.trangThai==!0?"Đang hoạt động":"Không hoạt động"},K(),c.value=[...y.value],N.value="Chỉnh sửa loại bảo hành",E.value=!0}catch(i){console.error("Error opening edit dialog:",i),_.error(((r=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:r.message)||"Lỗi khi lấy thông tin loại bảo hành")}finally{M.value=!1}},ce=async o=>{var e,r;try{M.value=!0;const i=await ie(o.id);T.value=i,D.value=!0}catch(i){console.error("Error opening detail dialog:",i),_.error(((r=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:r.message)||"Lỗi khi lấy chi tiết loại bảo hành")}finally{M.value=!1}},me=async()=>{if(G.value){K(),L.value=!0;try{await G.value.validate(),console.log("Form data before submit: ",s.value),await ne.confirm("Bạn có chắc chắn muốn thêm loại bảo hành này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}),await Fe(s.value),_.success("Thêm loại bảo hành thành công"),X.value=!1,F(),await w()}catch(o){if(o==="cancel"||o==="close")return;if(console.error("Error creating warranty type:",o),Array.isArray(o)){let e=[];o.forEach(({field:r,message:i})=>{O(r,i),e.push(i)}),_.error(e.join(""))}else _.error("Thêm loại bảo hành thất bại")}finally{L.value=!1}}},ge=async()=>{if(z.value){K(),L.value=!0;try{if(!await z.value.validate())return;await ne.confirm("Bạn có chắc chắn muốn cập nhật loại bảo hành này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}),console.log("Form data before update:",s.value),await Ue(s.value.id,s.value),_.success("Cập nhật loại bảo hành thành công"),E.value=!1,F(),await w()}catch(o){if(o==="cancel"||o==="close")return;if(console.error("Error updating warranty type:",o),Array.isArray(o)){let e=[];o.forEach(({field:r,message:i})=>{O(r,i),e.push(i)}),_.error(e.join(""))}else _.error("Cập nhật loại bảo hành thất bại")}finally{L.value=!1}}},pe=()=>{X.value=!1,F()},ve=()=>{E.value=!1,F()},fe=()=>{D.value=!1,T.value=null},w=async()=>{var o,e;M.value=!0;try{const r=await ze({search:H.value,page:g.value.page-1,size:g.value.size});j.value=r.content,g.value.total=r.totalElements}catch(r){console.error("Error fetching warranty types:",r),_.error(((e=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:e.message)||"Lỗi khi lấy danh sách loại bảo hành")}finally{M.value=!1}},be=()=>{H.value="",g.value.page=1,w()},_e=o=>{g.value.page=o,w()},ye=o=>{g.value.size=o,g.value.page=1,w()},Te=({rowIndex:o})=>o%2===0?"even-row":"odd-row";return Le(H,()=>{g.value.page=1,w()}),Se(()=>{w(),ue()}),(o,e)=>{const r=d("el-icon"),i=d("el-button"),k=d("el-input"),U=d("el-card"),v=d("el-table-column"),q=d("el-tag"),Y=d("el-tooltip"),we=d("el-table"),Ve=d("el-pagination"),f=d("el-form-item"),V=d("el-option"),$=d("el-select"),Z=d("el-input-number"),ee=d("el-form"),R=d("el-dialog"),Me=He("loading");return p(),S("div",De,[n("div",Ne,[n("div",Ke,[e[16]||(e[16]=n("div",{class:"title-section"},[n("h1",{class:"page-title"},"Quản lý loại bảo hành"),n("p",{class:"page-subtitle"},"Tạo và quản lý các loại bảo hành")],-1)),I.value?(p(),C(i,{key:0,type:"primary",size:"large",class:"create-btn",onClick:e[0]||(e[0]=a=>de())},{default:t(()=>[l(r,{class:"btn-icon"},{default:t(()=>[l(x(ae))]),_:1}),e[15]||(e[15]=b(" Thêm loại bảo hành "))]),_:1})):B("",!0)])]),l(U,{class:"filters-card",shadow:"never"},{default:t(()=>[n("div",$e,[n("div",qe,[n("div",Re,[e[17]||(e[17]=n("label",{class:"filter-label"},"Tìm kiếm",-1)),l(k,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),placeholder:"Tìm kiếm theo tên bảo hành...",clearable:"",class:"filter-input",onInput:w},{prefix:t(()=>[l(r,{class:"search-icon"},{default:t(()=>[l(x(Pe))]),_:1})]),_:1},8,["modelValue"])]),n("div",je,[l(i,{onClick:be,class:"reset-btn"},{default:t(()=>[l(r,null,{default:t(()=>[l(x(Xe))]),_:1}),e[18]||(e[18]=b(" Làm mới "))]),_:1})])])])]),_:1}),l(U,{class:"table-card",shadow:"never"},{default:t(()=>[Ee((p(),C(we,{data:j.value,class:"warranty-table","row-class-name":Te,"empty-text":"Không có dữ liệu"},{default:t(()=>[l(v,{label:"STT",width:"75",align:"center"},{default:t(a=>[n("span",Ie,h(a.$index+1+(g.value.page-1)*g.value.size),1)]),_:1}),l(v,{prop:"tenLoaiBaoHanh",label:"Tên loại bảo hành","min-width":"170"},{default:t(a=>[n("div",Oe,[l(q,{type:"info",size:"small",class:"code-tag"},{default:t(()=>[b(h(a.row.tenLoaiBaoHanh),1)]),_:2},1024)])]),_:1}),l(v,{prop:"idModelSanPham",label:"Tên Model sản phẩm","min-width":"200"},{default:t(a=>[n("div",Qe,[l(q,{type:"info",size:"small",class:"code-tag"},{default:t(()=>[b(h(`${a.row.tenModelSanPham} ${a.row.maXuatXu}`||"Chưa có thông tin"),1)]),_:2},1024)])]),_:1}),l(v,{label:"Thời gian bảo hành (tháng)",width:"250",align:"center"},{default:t(a=>[n("div",We,[n("span",Je,h(a.row.thoiGianThang),1)])]),_:1}),l(v,{prop:"trangThai",label:"Trạng thái","min-width":"300"},{default:t(a=>[n("div",Ye,[n("span",Ze,h(a.row.trangThai==!0?"Đang hoạt động":"Không hoạt động"),1)])]),_:1}),l(v,{prop:"moTa",label:"Mô tả","min-width":"300"},{default:t(a=>[n("div",ea,[n("span",aa,h(a.row.moTa),1)])]),_:1}),I.value?(p(),C(v,{key:0,label:"Thao tác",width:"150",align:"center",fixed:"right"},{default:t(a=>[n("div",la,[l(Y,{content:"Xem chi tiết",placement:"top"},{default:t(()=>[l(i,{size:"small",type:"info",icon:x(Ge),circle:"",onClick:ke=>ce(a.row),class:"action-btn view-btn"},null,8,["icon","onClick"])]),_:2},1024),l(Y,{content:"Chỉnh sửa",placement:"top"},{default:t(()=>[l(i,{size:"small",type:"primary",icon:x(le),circle:"",onClick:ke=>he(a.row),class:"action-btn edit-btn"},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})):B("",!0)]),_:1},8,["data"])),[[Me,M.value]]),n("div",ta,[l(Ve,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":g.value.page,"page-size":g.value.size,"page-sizes":[5,10,20,50],total:g.value.total,onCurrentChange:_e,onSizeChange:ye,class:"custom-pagination"},null,8,["current-page","page-size","total"])])]),_:1}),l(R,{modelValue:X.value,"onUpdate:modelValue":e[7]||(e[7]=a=>X.value=a),title:N.value,width:"600px","close-on-click-modal":!1},{footer:t(()=>[n("div",sa,[l(i,{onClick:pe},{default:t(()=>e[19]||(e[19]=[b("Hủy")])),_:1}),l(i,{type:"primary",onClick:me,loading:L.value},{default:t(()=>[l(r,{class:"btn-icon"},{default:t(()=>[l(x(ae))]),_:1}),e[20]||(e[20]=b(" Thêm mới "))]),_:1},8,["loading"])])]),default:t(()=>[l(ee,{ref_key:"createFormRef",ref:G,model:s.value,rules:se.value,"label-width":"160px","label-position":"left"},{default:t(()=>[l(f,{label:"Tên loại bảo hành",prop:"tenLoaiBaoHanh",error:m.value.tenLoaiBaoHanh},{default:t(()=>[l(k,{modelValue:s.value.tenLoaiBaoHanh,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.tenLoaiBaoHanh=a),placeholder:"Nhập tên loại bảo hành",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Model sản phẩm",prop:"idModelSanPham",error:m.value.idModelSanPham},{default:t(()=>[l($,{modelValue:s.value.idModelSanPham,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.idModelSanPham=a),placeholder:"Chọn model sản phẩm",style:{width:"100%"},clearable:"",filterable:"",remote:"","reserve-keyword":"","remote-method":Q,loading:A.value,onFocus:W,onClear:J},{default:t(()=>[(p(!0),S(te,null,oe(c.value,a=>(p(),C(V,{key:a.idModelSanPham,label:`${a.tenModel}${a.maXuatXu?" - "+a.maXuatXu:""}`,value:a.idModelSanPham},{default:t(()=>[n("span",oa,[n("span",na,h(a.tenModel),1),a.maXuatXu?(p(),S("span",ia,"- "+h(a.maXuatXu),1)):B("",!0)])]),_:2},1032,["label","value"]))),128)),c.value.length===0&&P.value?(p(),C(V,{key:0,disabled:"",label:"Không tìm thấy model phù hợp",value:""})):B("",!0)]),_:1},8,["modelValue","loading"])]),_:1},8,["error"]),l(f,{label:"Trạng thái",prop:"trangThai",error:m.value.tranGThai},{default:t(()=>[l($,{modelValue:s.value.trangThai,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.trangThai=a),placeholder:"Chọn trạng thái",style:{width:"100%"},filterable:"",clearable:""},{default:t(()=>[l(V,{label:"Hoạt động",value:"true"}),l(V,{label:"Không hoạt động",value:"false"})]),_:1},8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Thời gian bảo hành",prop:"thoiGianThang",error:m.value.thoiGianThang},{default:t(()=>[l(Z,{modelValue:s.value.thoiGianThang,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.thoiGianThang=a),min:1,max:120,placeholder:"Nhập thời gian bảo hành",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Mô tả",prop:"moTa",error:m.value.moTa},{default:t(()=>[l(k,{modelValue:s.value.moTa,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.moTa=a),type:"textarea",rows:4,placeholder:"Nhập mô tả loại bảo hành",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["error"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(R,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=a=>E.value=a),title:N.value,width:"600px","close-on-click-modal":!1},{footer:t(()=>[n("div",ha,[l(i,{onClick:ve},{default:t(()=>e[21]||(e[21]=[b("Hủy")])),_:1}),l(i,{type:"primary",onClick:ge,loading:L.value},{default:t(()=>[l(r,{class:"btn-icon"},{default:t(()=>[l(x(le))]),_:1}),e[22]||(e[22]=b(" Cập nhật "))]),_:1},8,["loading"])])]),default:t(()=>[l(ee,{ref_key:"editFormRef",ref:z,model:s.value,rules:re.value,"label-width":"160px","label-position":"left"},{default:t(()=>[l(f,{label:"Tên loại bảo hành",prop:"tenLoaiBaoHanh",error:m.value.tenLoaiBaoHanh},{default:t(()=>[l(k,{modelValue:s.value.tenLoaiBaoHanh,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.tenLoaiBaoHanh=a),placeholder:"Nhập tên loại bảo hành",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Model sản phẩm",prop:"idModelSanPham",error:m.value.idModelSanPham},{default:t(()=>[l($,{modelValue:s.value.idModelSanPham,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.idModelSanPham=a),placeholder:"Chọn model sản phẩm",style:{width:"100%"},clearable:"",filterable:"",remote:"","reserve-keyword":"","remote-method":Q,loading:A.value,onFocus:W,onClear:J},{default:t(()=>[(p(!0),S(te,null,oe(c.value,a=>(p(),C(V,{key:a.idModelSanPham,label:`${a.tenModel}${a.maXuatXu?" - "+a.maXuatXu:""}`,value:a.idModelSanPham},{default:t(()=>[n("span",ra,[n("span",ua,h(a.tenModel),1),a.maXuatXu?(p(),S("span",da,"- "+h(a.maXuatXu),1)):B("",!0)])]),_:2},1032,["label","value"]))),128)),c.value.length===0&&P.value?(p(),C(V,{key:0,disabled:"",label:"Không tìm thấy model phù hợp",value:""})):B("",!0)]),_:1},8,["modelValue","loading"])]),_:1},8,["error"]),l(f,{label:"Trạng thái",prop:"trangThai",error:m.value.tranGThai},{default:t(()=>[l($,{modelValue:s.value.trangThai,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.trangThai=a),placeholder:"Chọn trạng thái",style:{width:"100%"},filterable:"",clearable:""},{default:t(()=>[l(V,{label:"Hoạt động",value:"true"}),l(V,{label:"Không hoạt động",value:"false"})]),_:1},8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Thời gian bảo hành",prop:"thoiGianThang",error:m.value.thoiGianThang},{default:t(()=>[l(Z,{modelValue:s.value.thoiGianThang,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.thoiGianThang=a),min:1,max:120,placeholder:"Nhập thời gian bảo hành",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["error"]),l(f,{label:"Mô tả",prop:"moTa",error:m.value.moTa},{default:t(()=>[l(k,{modelValue:s.value.moTa,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.moTa=a),type:"textarea",rows:4,placeholder:"Nhập mô tả loại bảo hành",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["error"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(R,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=a=>D.value=a),title:"Chi tiết loại bảo hành",width:"700px"},{footer:t(()=>[n("div",wa,[l(i,{onClick:fe},{default:t(()=>e[28]||(e[28]=[b("Đóng")])),_:1})])]),default:t(()=>[T.value?(p(),S("div",ca,[n("div",ma,[e[23]||(e[23]=n("label",{class:"detail-label"},"Tên loại bảo hành:",-1)),l(q,{type:"info",class:"detail-tag"},{default:t(()=>[b(h(T.value.tenLoaiBaoHanh),1)]),_:1})]),n("div",ga,[e[24]||(e[24]=n("label",{class:"detail-label"},"Model sản phẩm:",-1)),n("span",pa,h(T.value.tenModelSanPham||"Chưa có thông tin"),1)]),n("div",va,[e[25]||(e[25]=n("label",{class:"detail-label"},"Trạng thái:",-1)),n("span",fa,h(T.value.trangThai==!0?"Đang hoạt động":"Không hoạt động"),1)]),n("div",ba,[e[26]||(e[26]=n("label",{class:"detail-label"},"Thời gian bảo hành:",-1)),n("span",_a,h(T.value.thoiGianThang)+" tháng",1)]),n("div",ya,[e[27]||(e[27]=n("label",{class:"detail-label"},"Mô tả:",-1)),n("p",Ta,h(T.value.moTa||"Không có mô tả"),1)])])):B("",!0)]),_:1},8,["modelValue"])])}}},xa=Ce(Va,[["__scopeId","data-v-f2874fe0"]]);export{xa as default};
