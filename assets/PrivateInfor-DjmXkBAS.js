import{V as N,_ as I,H as $,c as X,r as g,o as j,w as A,a as x,b as v,d as p,e as l,k as c,f as y,t as r,v as b,U as P,i as k,h as K,X as G,R as U,E as C}from"./index-BFtI-PwE.js";const S="/client",O=async _=>{var f;try{return(await N.get(`${S}/${_}`)).data}catch(d){throw console.error("Có lỗi khi Detail client:",d),((f=d.response)==null?void 0:f.data)||"Lỗi lấy private information"}},H=async(_,f)=>{var d;try{return(await N.put(`${S}/${_}`,f)).data}catch(s){throw console.error("Có lỗi khi update client:",s),((d=s.response)==null?void 0:d.data)||"Lỗi update private information"}},R={class:"profile-container"},z={key:0,class:"loading"},F={class:"profile-card"},q={key:0},J={class:"profile-item"},Q={class:"profile-item"},W={class:"profile-item"},Y={class:"profile-item"},Z={class:"profile-item"},ee={class:"profile-item"},le={key:1,class:"edit-form"},te={class:"form-group"},ae={key:0,class:"text-danger mb-1"},ne={class:"form-group"},oe={key:0,class:"text-danger mb-1"},se={class:"form-group"},ie={key:0,class:"text-danger mb-1"},ue={class:"form-group"},re={class:"form-group"},de={key:0,class:"text-danger mb-1"},ve={class:"form-group"},pe={key:0,class:"text-danger mb-1"},he={class:"button-group"},me=["disabled"],ce=["disabled"],ge={class:"form-group"},fe={class:"form-group"},ye={__name:"PrivateInfor",setup(_){const f=$(),d=X(()=>f.getters.user||null),s=g({}),h=g(!1),m=g(!1),a=g({}),w=g(!1),t=g({tenKhachHang:"",email:"",sdt:"",matKhau:"",ngaySinh:"",gioiTinh:""}),i=g({oldPwd:"",newPwd:""}),V=async()=>{var n;try{m.value=!0,a.value={};const e=(n=d.value)==null?void 0:n.id;if(!e)throw new Error("Không tìm thấy ID người dùng");const u=await O(e);delete u.matKhau,s.value={...u},t.value={...s.value}}catch(e){a.value=e.message||"Lỗi khi tải thông tin người dùng",console.error("Error loading user profile:",e)}finally{m.value=!1}};j(()=>{var n;(n=d.value)!=null&&n.id&&V()}),A(()=>h.value,n=>{n&&(t.value={...s.value})});const E=()=>{h.value=!h.value,Object.keys(a.value).forEach(n=>delete a.value[n]),h.value||(t.value={...s.value})},B=async()=>{var n;Object.keys(a.value).forEach(e=>delete a.value[e]);try{await U.confirm("Bạn có chắc chắn muốn cập nhật thông tin cá nhân?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}).catch(()=>{throw"cancel"}),m.value=!0;const e=(n=d.value)==null?void 0:n.id;t.value.matKhau||delete t.value.matKhau,delete t.value.hangKhachHang,await H(e,t.value),await V(),C.success("Update thành công"),h.value=!1}catch(e){if(e==="cancel")return;Array.isArray(e)?e.forEach(({field:u,message:T})=>{a.value[u]=T}):C.error("Update thông tin thất bại")}finally{m.value=!1}},M=()=>{i.value.oldPwd="",i.value.newPwd="",w.value=!0},D=async()=>{var n;if(!i.value.oldPwd||!i.value.newPwd){C.warning("Vui lòng nhập đủ mật khẩu cũ và mới!");return}try{await U.confirm("Bạn có chắc chắn muốn đổi mật khẩu?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}).catch(()=>{throw"cancel"}),m.value=!0;const e=(n=d.value)==null?void 0:n.id,u={...t.value,matKhau:i.value.newPwd,matKhauCu:i.value.oldPwd};console.log("payload: ",u),delete u.hangKhachHang,await H(e,u),await V(),C.success("Đổi mật khẩu thành công"),w.value=!1,i.value.oldPwd="",i.value.newPwd=""}catch(e){if(e==="cancel")return;C.error("Mật khẩu cũ không đúng")}finally{m.value=!1}};return(n,e)=>{const u=x("el-button"),T=x("el-input"),L=x("el-dialog");return p(),v("div",R,[e[27]||(e[27]=l("h2",{class:"profile-title"},"Thông Tin Cá Nhân",-1)),m.value?(p(),v("div",z,"Đang tải...")):c("",!0),l("div",F,[h.value?c("",!0):(p(),v("div",q,[l("div",J,[e[9]||(e[9]=l("label",null,"Tài khoản:",-1)),l("p",null,r(s.value.taiKhoan||"Chưa cập nhật"),1)]),l("div",Q,[e[10]||(e[10]=l("label",null,"Họ và Tên:",-1)),l("p",null,r(s.value.tenKhachHang||"Chưa cập nhật"),1)]),l("div",W,[e[11]||(e[11]=l("label",null,"Email:",-1)),l("p",null,r(s.value.email||"Chưa cập nhật"),1)]),l("div",Y,[e[12]||(e[12]=l("label",null,"Số Điện Thoại:",-1)),l("p",null,r(s.value.sdt||"Chưa cập nhật"),1)]),l("div",Z,[e[13]||(e[13]=l("label",null,"Ngày Sinh:",-1)),l("p",null,r(s.value.ngaySinh||"Chưa cập nhật"),1)]),l("div",ee,[e[14]||(e[14]=l("label",null,"Giới Tính:",-1)),l("p",null,r(s.value.gioiTinh===!0?"Nam":"Nữ"),1)])])),h.value?(p(),v("div",le,[l("div",te,[a.value.tenKhachHang?(p(),v("div",ae,r(a.value.tenKhachHang),1)):c("",!0),e[15]||(e[15]=l("label",null,"Họ và Tên:",-1)),b(l("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.tenKhachHang=o),placeholder:"Nhập họ và tên",class:"form-input"},null,512),[[P,t.value.tenKhachHang]])]),l("div",ne,[a.value.email?(p(),v("div",oe,r(a.value.email),1)):c("",!0),e[16]||(e[16]=l("label",null,"Email:",-1)),b(l("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.email=o),type:"email",placeholder:"Nhập email",class:"form-input"},null,512),[[P,t.value.email]])]),l("div",se,[a.value.sdt?(p(),v("div",ie,r(a.value.sdt),1)):c("",!0),e[17]||(e[17]=l("label",null,"Số Điện Thoại:",-1)),b(l("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.sdt=o),placeholder:"Nhập số điện thoại",class:"form-input"},null,512),[[P,t.value.sdt]])]),l("div",ue,[e[19]||(e[19]=l("label",null,"Mật khẩu:",-1)),y(u,{type:"primary",plain:"",size:"small",onClick:M},{default:k(()=>e[18]||(e[18]=[K("Cập nhật mật khẩu")])),_:1})]),l("div",re,[a.value.ngaySinh?(p(),v("div",de,r(a.value.ngaySinh),1)):c("",!0),e[20]||(e[20]=l("label",null,"Ngày Sinh:",-1)),b(l("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.ngaySinh=o),type:"date",class:"form-input"},null,512),[[P,t.value.ngaySinh]])]),l("div",ve,[a.value.gioiTinh?(p(),v("div",pe,r(a.value.gioiTinh),1)):c("",!0),e[22]||(e[22]=l("label",null,"Giới Tính:",-1)),b(l("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.gioiTinh=o),class:"form-input"},e[21]||(e[21]=[l("option",{value:"",disabled:""},"Chọn giới tính",-1),l("option",{value:"true"},"Nam",-1),l("option",{value:"false"},"Nữ",-1)]),512),[[G,t.value.gioiTinh]])])])):c("",!0),l("div",he,[l("button",{class:"edit-button",onClick:E,disabled:m.value},r(h.value?"Hủy":"Chỉnh Sửa"),9,me),h.value?(p(),v("button",{key:0,class:"save-button",onClick:B,disabled:m.value}," Lưu Thay Đổi ",8,ce)):c("",!0)])]),y(L,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=o=>w.value=o),title:"Cập nhật mật khẩu",width:"400px"},{footer:k(()=>[y(u,{onClick:e[7]||(e[7]=o=>w.value=!1)},{default:k(()=>e[25]||(e[25]=[K("Hủy")])),_:1}),y(u,{type:"primary",onClick:D},{default:k(()=>e[26]||(e[26]=[K("Xác nhận")])),_:1})]),default:k(()=>[l("div",ge,[e[23]||(e[23]=l("label",null,"Mật khẩu cũ:",-1)),y(T,{modelValue:i.value.oldPwd,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value.oldPwd=o),type:"password"},null,8,["modelValue"])]),l("div",fe,[e[24]||(e[24]=l("label",null,"Mật khẩu mới:",-1)),y(T,{modelValue:i.value.newPwd,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value.newPwd=o),type:"password"},null,8,["modelValue"])])]),_:1},8,["modelValue"])])}}},be=I(ye,[["__scopeId","data-v-5984f961"]]);export{be as default};
