import{_ as be,r as s,T as we,w as Q,o as Ce,a as u,b as g,d as h,e as c,f as e,k as b,i as a,h as v,j as K,ac as X,L as Ve,ad as W,t as _,B as Z,F as ee,a6 as Te,y as xe,G,E as D,R as le}from"./index-BFtI-PwE.js";import{g as Ke,d as Ee,u as Ne,a as Ae}from"./KhachHangServices-DSZDVUWy.js";const Se={class:"client-container"},He={class:"search-section"},Me={class:"search-container"},Be={class:"search-input-group"},Ie={class:"search-input-wrapper"},Pe={key:0,class:"search-status"},Ue={key:0,class:"text-center"},Fe={class:"filter-section mb-3"},Ye={class:"d-flex gap-2 align-items-center justify-content-between"},ze={class:"d-flex gap-2 align-items-center"},De={key:0,class:"result-count"},Le={key:0},$e={key:1,class:"error-state"},je={key:2,class:"search-result-info"},Xe={key:3,class:"no-data"},Ge={key:0},Re={key:1},qe={key:4},Oe={style:{"white-space":"normal","word-break":"break-word"}},Je={class:"pagination-fixed"},Qe={class:"d-flex justify-content-center align-items-center gap-3",style:{"margin-top":"30px"}},We={class:"dialog-footer"},Ze={__name:"ClientAdmin",setup(el){const S=s([]),y=s(!1),H=s(""),d=s(0),M=s(0),R=s(0),o=s(""),L=s(null),E=s(!1),x=s(!1),B=s(null),I=s(!1),i=s({tenKhachHang:"",taiKhoan:"",matKhau:"",email:"",sdt:"",trangThai:"ACTIVE",gioiTinh:!0,ngaySinh:""}),w=we({}),m=s(null),$=s(0),C=s(null),V=s(null),ae=s({tenKhachHang:[{required:!0,message:"Vui lòng nhập tên khách hàng",trigger:"blur"}]}),te=(n,l)=>{w[n]=l},ne=n=>{w.hasOwnProperty(n)&&delete w[n]},P=()=>{[...Object.keys(w)].forEach(l=>{ne(l)}),G(()=>{m.value&&m.value.clearValidate()})},k=async(n=0,l=null)=>{try{y.value=!0,H.value="";const r=await Ke({page:n,keyword:l||o.value||null,gioiTinh:C.value,trangThai:V.value});S.value=r.content,d.value=n,M.value=r.totalPages,R.value=r.totalElements}catch(r){H.value=r.message||"An error was thrown while loading the clients"}finally{y.value=!1}},oe=()=>{L.value&&clearTimeout(L.value),L.value=setTimeout(()=>{d.value=0,k(0,o.value||null)},500)},ie=()=>{o.value="",d.value=0,k(0,null)};Q(o,(n,l)=>{n!==l&&oe()}),Q([C,V],()=>{var n;d.value=0,k(0,((n=o.value)==null?void 0:n.trim())||null)});const se=()=>{var l;d.value=0,k(d.value,((l=o.value)==null?void 0:l.trim())||null)},ue=()=>{var l;const n=M.value-1;d.value=n,k(d.value,((l=o.value)==null?void 0:l.trim())||null)},U=()=>{C.value=null,V.value=null,o.value="",d.value=0,k(0,null)},re=async n=>{d.value=n-1,await k(d.value,o.value||null)},de=()=>{E.value=!0,x.value=!1,B.value=null,q(),P(),$.value+=1,G(()=>{m.value&&(m.value.resetFields(),m.value.clearValidate())})},he=async n=>{E.value=!0,x.value=!0,B.value=n,P(),$.value+=1,G(()=>{m.value&&(m.value.resetFields(),m.value.clearValidate())});try{y.value=!0;const l=await Ee(n);Object.assign(i.value,l),i.value.matKhau=""}catch(l){D.error(l.message||"Lỗi khi tải thông tin khách hàng"),E.value=!1}finally{y.value=!1}},j=()=>{E.value=!1,q(),P(),x.value=!1,B.value=null,m.value&&(m.value.resetFields(),m.value.clearValidate())},q=()=>{i.value={tenKhachHang:"",taiKhoan:"",matKhau:"",email:"",sdt:"",trangThai:"ACTIVE",gioiTinh:!0,ngaySinh:""}},O=async()=>{P(),I.value=!0;try{if(await m.value.validate()){if(x.value){await le.confirm("Bạn có chắc chắn muốn cập nhật khách hàng này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"});const l={...i.value};l.matKhau||delete l.matKhau,delete l.hangKhachHang,await Ne(B.value,l),D.success("Cập nhật khách hàng thành công")}else await le.confirm("Bạn có chắc chắn muốn thêm khách hàng này?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}),await Ae(i.value),D.success("Thêm khách hàng thành công");j(),k(d.value,o.value||null)}}catch(n){if(n==="cancel"||n==="close")return;Array.isArray(n)?n.forEach(({field:l,message:r})=>{te(l,r)}):D.error(x.value?"Cập nhật khách hàng thất bại":"Thêm khách hàng thất bại")}finally{I.value=!1}};return Ce(()=>{k()}),(n,l)=>{const r=u("el-button"),ce=u("el-divider"),F=u("el-input"),T=u("el-option"),Y=u("el-select"),ve=u("el-text"),J=u("el-alert"),me=u("el-empty"),p=u("el-table-column"),ge=u("el-tag"),pe=u("el-table"),fe=u("el-pagination"),N=u("el-form-item"),A=u("el-col"),z=u("el-row"),_e=u("el-date-picker"),ye=u("el-form"),ke=u("el-dialog");return h(),g("div",Se,[c("div",null,[e(r,{type:"primary",onClick:de,class:"add-client-btn"},{default:a(()=>[e(K(X),null,{default:a(()=>[e(K(Ve))]),_:1}),l[10]||(l[10]=v(" Thêm khách hàng "))]),_:1})]),e(ce),c("div",He,[c("div",Me,[c("div",Be,[c("div",Ie,[e(F,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value=t),placeholder:"Tìm kiếm theo tên, email, số điện thoại, tên tài khoản...","prefix-icon":"Search",clearable:"",onClear:ie,class:"search-input"},null,8,["modelValue"])]),y.value?(h(),g("div",Pe,[e(K(X),{class:"is-loading"},{default:a(()=>[e(K(W))]),_:1}),l[11]||(l[11]=v(" Đang tìm kiếm... "))])):b("",!0)])])]),y.value?(h(),g("div",Ue,[e(K(X),{icon:K(W)},null,8,["icon"]),l[12]||(l[12]=c("p",null,"Đang tải dữ liệu...",-1))])):b("",!0),c("div",Fe,[c("div",Ye,[c("div",ze,[e(Y,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=t=>C.value=t),placeholder:"Lọc theo giới tính",clearable:"",size:"small",onClear:U,style:{width:"150px"}},{default:a(()=>[e(T,{label:"Nam",value:!0}),e(T,{label:"Nữ",value:!1})]),_:1},8,["modelValue"]),e(Y,{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=t=>V.value=t),placeholder:"Lọc theo trạng thái",clearable:"",size:"small",onClear:U,style:{width:"150px"}},{default:a(()=>[e(T,{label:"Hoạt động",value:"ACTIVE"}),e(T,{label:"Ngừng",value:"INACTIVE"})]),_:1},8,["modelValue"]),e(r,{size:"small",onClick:U,disabled:!C.value&&!V.value&&!o.value},{default:a(()=>l[13]||(l[13]=[v(" Xóa bộ lọc ")])),_:1},8,["disabled"])]),y.value?b("",!0):(h(),g("div",De,[e(ve,{size:"small",type:"info"},{default:a(()=>[v(" Tổng: "+_(R.value)+" khách hàng ",1),o.value||C.value!==null||V.value!==null?(h(),g("span",Le," (đã lọc) ")):b("",!0)]),_:1})]))])]),H.value&&!y.value?(h(),g("div",$e,[e(J,{title:H.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):b("",!0),o.value&&!y.value?(h(),g("div",je,[e(J,{title:`Kết quả tìm kiếm cho: '${o.value}' (${S.value.length} khách hàng)`,type:"info",closable:!1,"show-icon":""},null,8,["title"])])):b("",!0),!y.value&&S.value.length===0?(h(),g("div",Xe,[e(me,null,{description:a(()=>[o.value?(h(),g("span",Ge,' Không tìm thấy khách hàng nào với từ khóa "'+_(o.value)+'" ',1)):(h(),g("span",Re,"Chưa có khách hàng nào"))]),default:a(()=>[o.value||C.value!==null||V.value!==null?(h(),Z(r,{key:0,type:"primary",onClick:U},{default:a(()=>l[14]||(l[14]=[v(" Xóa bộ lọc ")])),_:1})):b("",!0)]),_:1})])):b("",!0),S.value.length>0?(h(),g("div",qe,[l[18]||(l[18]=c("h2",null,"Danh sách khách hàng",-1)),e(pe,{data:S.value,style:{width:"100%"},stripe:""},{default:a(()=>[e(p,{type:"index",label:"STT",width:"60",index:t=>t+1+d.value*10},null,8,["index"]),e(p,{prop:"maKhachHang",label:"Mã khách hàng",width:"120"}),e(p,{prop:"tenKhachHang",label:"Tên khách hàng",width:"150"}),e(p,{prop:"taiKhoan",label:"Tên đăng nhập",width:"130"}),e(p,{prop:"email",label:"Email",width:"180"}),e(p,{label:"Địa chỉ",width:"250"},{default:a(t=>[c("span",Oe,[t.row.diaChi&&t.row.diaChi.find(f=>f.diaChiChinh)?(h(),g(ee,{key:0},[v(_(t.row.diaChi.find(f=>f.diaChiChinh).soNha)+", "+_(t.row.diaChi.find(f=>f.diaChiChinh).tenDuong)+", "+_(t.row.diaChi.find(f=>f.diaChiChinh).xaPhuong)+", "+_(t.row.diaChi.find(f=>f.diaChiChinh).tinhThanhPho),1)],64)):(h(),g(ee,{key:1},[v("Không có")],64))])]),_:1}),e(p,{prop:"sdt",label:"Số điện thoại",width:"120"},{default:a(t=>[v(_(t.row.sdt?t.row.sdt:"Không có"),1)]),_:1}),e(p,{label:"Trạng thái",width:"100"},{default:a(t=>[e(ge,{type:t.row.trangThai==="ACTIVE"?"success":"danger",size:"small"},{default:a(()=>[v(_(t.row.trangThai==="ACTIVE"?"Hoạt động":"Ngừng"),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"Giới tính",width:"80"},{default:a(t=>[v(_(t.row.gioiTinh?"Nam":"Nữ"),1)]),_:1}),e(p,{label:"Năm sinh",width:"100"},{default:a(t=>[v(_(t.row.ngaySinh?new Date(t.row.ngaySinh).getFullYear():"Không"),1)]),_:1}),e(p,{label:"Thao tác",width:"150",fixed:"right"},{default:a(t=>[e(r,{type:"primary",size:"small",icon:K(Te),onClick:f=>he(t.row.id),title:"Chỉnh sửa"},null,8,["icon","onClick"]),e(r,{type:"warning",size:"small",onClick:f=>n.$router.push(`/admin/client/addresses/${t.row.id}`),title:"Xem địa chỉ"},{default:a(()=>l[15]||(l[15]=[c("i",{class:"bi bi-geo-alt"},null,-1)])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",Je,[c("div",Qe,[e(r,{disabled:d.value===0,onClick:se,type:"default"},{default:a(()=>l[16]||(l[16]=[v(" « ")])),_:1},8,["disabled"]),e(fe,{background:"",layout:"prev, pager, next","page-size":10,"current-page":d.value+1,total:M.value*10,"pager-count":7,"prev-text":"‹","next-text":"›",onCurrentChange:re},null,8,["current-page","total"]),e(r,{disabled:d.value===M.value-1,onClick:ue,type:"default"},{default:a(()=>l[17]||(l[17]=[v(" » ")])),_:1},8,["disabled"])])])])):b("",!0),e(ke,{modelValue:E.value,"onUpdate:modelValue":l[9]||(l[9]=t=>E.value=t),title:x.value?"Cập nhật thông tin khách hàng":"Thêm khách hàng mới",width:"800px","before-close":j},{footer:a(()=>[c("div",We,[e(r,{onClick:j,disabled:I.value},{default:a(()=>l[19]||(l[19]=[v(" Hủy ")])),_:1},8,["disabled"]),e(r,{type:"primary",onClick:O,loading:I.value},{default:a(()=>[v(_(x.value?"Cập nhật":"Thêm khách hàng"),1)]),_:1},8,["loading"])])]),default:a(()=>[(h(),Z(ye,{model:i.value,ref_key:"formRef",ref:m,key:$.value,"label-width":"140px","label-position":"left",rules:ae.value,onSubmit:xe(O,["prevent"])},{default:a(()=>[e(z,{gutter:20},{default:a(()=>[e(A,{span:12},{default:a(()=>[e(N,{label:"Tên khách hàng",error:w.tenKhachHang,prop:"tenKhachHang"},{default:a(()=>[e(F,{modelValue:i.value.tenKhachHang,"onUpdate:modelValue":l[3]||(l[3]=t=>i.value.tenKhachHang=t),placeholder:"Nhập tên khách hàng"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),e(z,{gutter:20},{default:a(()=>[e(A,{span:12},{default:a(()=>[e(N,{label:"Email",error:w.email},{default:a(()=>[e(F,{modelValue:i.value.email,"onUpdate:modelValue":l[4]||(l[4]=t=>i.value.email=t),modelModifiers:{trim:!0},placeholder:"Nhập email"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1}),e(A,{span:12},{default:a(()=>[e(N,{label:"Số điện thoại",error:w.sdt},{default:a(()=>[e(F,{modelValue:i.value.sdt,"onUpdate:modelValue":l[5]||(l[5]=t=>i.value.sdt=t),modelModifiers:{trim:!0},placeholder:"Nhập số điện thoại"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),e(z,{gutter:20},{default:a(()=>[e(A,{span:12},{default:a(()=>[e(N,{label:"Trạng thái"},{default:a(()=>[e(Y,{modelValue:i.value.trangThai,"onUpdate:modelValue":l[6]||(l[6]=t=>i.value.trangThai=t),placeholder:"Chọn trạng thái"},{default:a(()=>[e(T,{label:"Hoạt động",value:"ACTIVE"}),e(T,{label:"Ngừng hoạt động",value:"INACTIVE"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(A,{span:12},{default:a(()=>[e(N,{label:"Năm sinh",error:w.ngaySinh},{default:a(()=>[e(_e,{modelValue:i.value.ngaySinh,"onUpdate:modelValue":l[7]||(l[7]=t=>i.value.ngaySinh=t),type:"date",placeholder:"Chọn năm sinh",format:"DD/MM/YYYY","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1}),e(z,{gutter:20},{default:a(()=>[e(A,{span:12},{default:a(()=>[e(N,{label:"Giới tính"},{default:a(()=>[e(Y,{modelValue:i.value.gioiTinh,"onUpdate:modelValue":l[8]||(l[8]=t=>i.value.gioiTinh=t),placeholder:"Chọn giới tính"},{default:a(()=>[e(T,{label:"Nam",value:!0}),e(T,{label:"Nữ",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]))]),_:1},8,["modelValue","title"])])}}},tl=be(Ze,[["__scopeId","data-v-d6c23082"]]);export{tl as default};
