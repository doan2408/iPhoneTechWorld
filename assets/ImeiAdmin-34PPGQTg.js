import{ah as te,ai as le,aj as ae}from"./ProductAdminService-BjtVeFMT.js";import{_ as ne,r,T as B,c as U,w as N,o as oe,a as o,b as d,d as p,f as t,e as y,k as se,i as a,j as re,ad as ie,t as D,h as L,F as ue,m as ce,E as f}from"./index-I05jmhuU.js";const me={class:"container mt-4"},de={key:0,class:"text-center",style:{margin:"40px 0"}},pe={key:1,class:"text-center",style:{margin:"40px 0"}},ge={key:2,class:"table-responsive mb-4",style:{"margin-top":"20px"}},he={key:3,class:"pagination-fixed"},ve={class:"d-flex justify-content-center align-items-center gap-3"},I=5,_e={__name:"ImeiAdmin",setup(fe){const g=r([]),i=r(1),R=r(1),h=r(0),T=r(!1),x=r(!1),E=r(!1),b=r(!1),v=r(null),V=B({}),c=r(""),u=r(""),s=B({id:null,soImei:"",trangThaiImei:""}),F=[{value:"AVAILABLE",label:"Có sẵn"},{value:"RESERVED",label:"Đã đặt trước"},{value:"SOLD",label:"Đã bán"},{value:"RETURNED",label:"Đã trả lại"},{value:"REFURBISHED",label:"Tân trang"},{value:"BLACKLISTED",label:"Bị chặn"}],K={soImei:[{required:!0,message:"Vui lòng nhập số IMEI 1",trigger:"blur"},{pattern:/^\d{15}$/,message:"Số IMEI phải có đúng 15 chữ số",trigger:"blur"}],trangThaiImei:[{required:!0,message:"Vui lòng chọn trạng thái",trigger:"change"}]};U(()=>h.value===0?0:(i.value-1)*I+1),U(()=>Math.min(i.value*I,h.value));const m=async()=>{T.value=!0;try{console.log("Loading data with search term:",c.value.trim()||null);const e=await te(i.value-1,I,(c==null?void 0:c.value.trim())||null);if(console.log("API response:",e),e&&typeof e=="object")g.value=e.content||[],R.value=e.totalPages||1,h.value=e.totalElements||0;else throw new Error("Invalid response format")}catch(e){console.error("Load data error:",e),f.error("Không thể tải dữ liệu: "+(e.message||"Unknown error")),g.value=[],R.value=1,h.value=0}finally{T.value=!1}},j=()=>{u.value="",c.value="",i.value=1,m()},P=async()=>{if(v.value){Object.keys(V).forEach(e=>delete V[e]);try{await v.value.validate(),x.value=!0,b.value?(await le(s.id,s),f.success("Cập nhật IMEI thành công!")):(await ae(s),f.success("Thêm mới IMEI thành công!")),A(),E.value=!1,m(u.value)}catch(e){console.error("Lỗi xử lý form:",e),Array.isArray(e)?e.forEach(({field:l,message:_})=>{V[l]=_,f.error(_)}):f.error(b.value?"Cập nhật thất bại!":"Thêm mới thất bại!")}finally{x.value=!1}}},O=()=>{A(),E.value=!1},H=e=>{i.value=e,m(u.value)},q=e=>(i.value-1)*I+e+1,A=()=>{s.id=null,s.soImei="",s.trangThaiImei="",v.value&&v.value.resetFields()},z=e=>({AVAILABLE:"Có sẵn",RESERVED:"Đã đặt trước",SOLD:"Đã bán",RETURNED:"Đã trả lại",REFURBISHED:"Tân trang",BLACKLISTED:"Bị chặn"})[e]||e,$=e=>({AVAILABLE:"success",RESERVED:"warning",SOLD:"info",RETURNED:"danger",REFURBISHED:"primary",BLACKLISTED:"danger"})[e]||"info";return N(u,()=>{c.value=u.value.trim(),i.value=1,m()}),N(i,()=>{m()}),oe(()=>{m()}),(e,l)=>{const _=o("el-input"),S=o("el-col"),w=o("el-row"),G=o("el-icon"),C=o("el-table-column"),J=o("el-tag"),Q=o("el-table"),W=o("el-pagination"),k=o("el-form-item"),X=o("el-option"),Y=o("el-select"),M=o("el-button"),Z=o("el-form"),ee=o("el-dialog");return p(),d("div",me,[t(w,{gutter:20,class:"mb-4",align:"middle"},{default:a(()=>[t(S,{span:8},{default:a(()=>[t(_,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=n=>u.value=n),placeholder:"Tìm kiếm theo số imei, trạng thái...",clearable:"","prefix-icon":"Search",onClear:j,onInput:e.onSearchKeywordChange},null,8,["modelValue","onInput"])]),_:1})]),_:1}),l[6]||(l[6]=y("h2",null,"Danh sách IMEI",-1)),T.value?(p(),d("div",de,[t(G,{class:"is-loading"},{default:a(()=>[t(re(ie))]),_:1}),l[4]||(l[4]=y("p",null,"Đang tải dữ liệu...",-1))])):g.value.length===0?(p(),d("div",pe,[y("p",null,D(u.value?"Không tìm thấy kết quả phù hợp":"Không có dữ liệu"),1)])):(p(),d("div",ge,[t(Q,{data:g.value,border:"",style:{width:"100%"}},{default:a(()=>[t(C,{type:"index",index:q,label:"STT",width:"80"}),t(C,{prop:"soImei",label:"Số IMEI 1"}),t(C,{label:"Trạng thái"},{default:a(({row:n})=>[t(J,{type:$(n.trangThaiImei)},{default:a(()=>[L(D(z(n.trangThaiImei)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])),g.value.length>0?(p(),d("div",he,[y("div",ve,[t(W,{background:"",layout:"prev, pager, next","page-size":I,"current-page":i.value,total:h.value,"pager-count":7,"prev-text":"< Trước","next-text":"Sau >",onCurrentChange:H},null,8,["current-page","total"])])])):se("",!0),t(ee,{modelValue:E.value,"onUpdate:modelValue":l[3]||(l[3]=n=>E.value=n),title:b.value?"Chỉnh sửa IMEI":"Thêm mới IMEI",width:"800px","close-on-click-modal":!1,"destroy-on-close":!0},{default:a(()=>[t(Z,{model:s,ref_key:"formRef",ref:v,rules:K,"label-width":"140px","label-position":"left",class:"imei-form"},{default:a(()=>[t(w,{gutter:20},{default:a(()=>[t(S,{span:12},{default:a(()=>[t(k,{label:"Số IMEI 1",prop:"soImei"},{default:a(()=>[t(_,{modelValue:s.soImei,"onUpdate:modelValue":l[1]||(l[1]=n=>s.soImei=n),placeholder:"Nhập số IMEI (15 chữ số)",maxlength:"15","show-word-limit":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:12},{default:a(()=>[t(k,{label:"Trạng thái",prop:"trangThaiImei"},{default:a(()=>[t(Y,{modelValue:s.trangThaiImei,"onUpdate:modelValue":l[2]||(l[2]=n=>s.trangThaiImei=n),placeholder:"Chọn trạng thái",style:{width:"100%"}},{default:a(()=>[(p(),d(ue,null,ce(F,n=>t(X,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(w,{justify:"end",style:{"margin-top":"30px"}},{default:a(()=>[t(M,{onClick:O,style:{"margin-right":"10px"}},{default:a(()=>l[5]||(l[5]=[L("Hủy")])),_:1}),t(M,{type:"primary",onClick:P,loading:x.value},{default:a(()=>[L(D(b.value?"Cập nhật":"Lưu"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},be=ne(_e,[["__scopeId","data-v-2603b980"]]);export{be as default};
