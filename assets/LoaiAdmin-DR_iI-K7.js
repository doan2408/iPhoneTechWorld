import{ae as J,af as W,ag as Y,q as Z}from"./ProductAdminService-BjtVeFMT.js";import{_ as ee,u as te,r as u,T as ae,c as D,o as le,w as oe,a as d,a2 as ne,b as se,d as z,f as e,e as y,i as a,j as T,h as b,v as ie,B as re,a6 as ce,l as ue,t as de,R as P}from"./index-I05jmhuU.js";import{l as me}from"./lodash-B9bUVSq8.js";const pe={class:"container mt-4"},fe={class:"table-responsive mb-4",style:{"margin-top":"20px"}},he={class:"action-buttons-horizontal"},ve={class:"pagination-fixed"},_e={class:"d-flex justify-content-center align-items-center gap-3"},x=5,ge={__name:"LoaiAdmin",setup(ye){const o=te(),V=u([]),m=u(1),S=u(1),L=u(0),_=u(""),h=u(!1),v=u(!1),k=u(!1),C=u(!1),g=u(null),i=ae({id:null,tenLoai:""}),f=async()=>{try{k.value=!0;const l=await J(m.value-1,x,_.value.trim());V.value=l.content||[],S.value=l.totalPages||1,L.value=l.totalElements||0}catch(l){console.error("Không thể load dữ liệu:",l),o.error("Không thể tải dữ liệu. Vui lòng thử lại!")}finally{k.value=!1}},A=async()=>{g.value&&g.value.validate(async l=>{var t;if(l)try{await P.confirm(v.value?"Bạn có chắc chắn muốn cập nhật loại này?":"Bạn có chắc chắn muốn thêm loại mới?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}),C.value=!0,v.value?(await Y(i.id,i),o.success("Cập nhật loại thành công!")):(await Z(i),o.success("Thêm mới loại thành công!")),E(),h.value=!1,f()}catch(r){if(r==="cancel"||(r==null?void 0:r.message)==="cancel"){o.info("Hủy thao tác");return}if(console.error("Lỗi xử lý form:",r),(t=r.response)!=null&&t.data){const{message:n,errors:s}=r.response.data;Array.isArray(n)?n.forEach(c=>o.error(c)):typeof n=="object"&&n?Object.values(n).forEach(c=>o.error(c)):typeof s=="object"&&s?Object.values(s).forEach(c=>o.error(c)):o.error(n||s||"Lỗi không xác định!")}else o.error("Lỗi kết nối server. Vui lòng thử lại sau!")}finally{C.value=!1}})},M=l=>{v.value=!0,i.id=l.id,i.tenLoai=l.tenLoai,h.value=!0},H=l=>{P.confirm("Bạn có chắc chắn muốn xóa loại này?","Cảnh báo",{confirmButtonText:"Xóa",cancelButtonText:"Hủy",type:"warning"}).then(async()=>{try{await W(l),o.success("Xóa loại thành công!"),f()}catch(t){console.error("Lỗi khi xóa:",t),o.error("Lỗi khi xóa loại. Vui lòng thử lại!")}}).catch(()=>{o.info("Đã hủy thao tác xóa")})},B=()=>{m.value=1,f()},I=me.debounce(()=>{B()},500),N=()=>{_.value="",m.value=1,f()},R=()=>{E(),v.value=!1,h.value=!0},j=()=>{h.value=!1},E=()=>{i.id=null,i.tenLoai="",g.value&&g.value.resetFields()};D(()=>L.value===0?0:(m.value-1)*x+1),D(()=>Math.min(m.value*x,L.value));const F=l=>(m.value-1)*x+l+1,U=l=>{m.value=l,f()};return le(()=>{f()}),oe([m,_],()=>{f()}),(l,t)=>{const r=d("el-input"),n=d("el-col"),s=d("el-button"),c=d("el-row"),w=d("el-table-column"),X=d("el-table"),K=d("el-pagination"),O=d("el-form-item"),$=d("el-form"),q=d("el-dialog"),Q=ne("loading");return z(),se("div",pe,[e(c,{gutter:20,class:"mb-4 justify-content-center"},{default:a(()=>[e(n,{span:6},{default:a(()=>[e(r,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=p=>_.value=p),placeholder:"Tìm kiếm loại",clearable:"",onInput:T(I)},null,8,["modelValue","onInput"])]),_:1}),e(n,{span:3},{default:a(()=>[e(s,{type:"primary",onClick:B,class:"w-100"},{default:a(()=>t[3]||(t[3]=[b("Tìm kiếm")])),_:1})]),_:1})]),_:1}),e(c,{gutter:20,class:"mb-2",justify:"end"},{default:a(()=>[e(n,{span:3},{default:a(()=>[e(s,{type:"primary",onClick:R,class:"w-100"},{default:a(()=>t[4]||(t[4]=[b("Tạo mới")])),_:1})]),_:1}),e(n,{span:3},{default:a(()=>[e(s,{type:"primary",onClick:N,class:"w-100"},{default:a(()=>t[5]||(t[5]=[b("Làm mới")])),_:1})]),_:1})]),_:1}),t[7]||(t[7]=y("h2",null,"Danh sách loại",-1)),y("div",fe,[ie((z(),re(X,{data:V.value,border:"",style:{width:"100%"}},{default:a(()=>[e(w,{type:"index",index:F,label:"STT",width:"80"}),e(w,{prop:"tenLoai",label:"Tên loại"}),e(w,{label:"Thao tác",width:"180"},{default:a(({row:p})=>[y("div",he,[e(s,{size:"small",type:"primary",icon:T(ce),circle:"",onClick:G=>M(p)},null,8,["icon","onClick"]),e(s,{size:"small",type:"danger",icon:T(ue),circle:"",onClick:G=>H(p.id)},null,8,["icon","onClick"])])]),_:1})]),_:1},8,["data"])),[[Q,k.value]])]),y("div",ve,[y("div",_e,[e(K,{background:"",layout:"prev, pager, next","page-size":x,"current-page":m.value,total:L.value,"pager-count":7,"prev-text":"< Trước","next-text":"Sau >",onCurrentChange:U},null,8,["current-page","total"])])]),e(q,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=p=>h.value=p),title:v.value?"Chỉnh sửa Loại":"Thêm mới Loại",width:"900px","close-on-click-modal":!1,"destroy-on-close":!0,onClose:j},{default:a(()=>[e($,{model:i,ref_key:"formRef",ref:g,"label-width":"140px","label-position":"left",size:"default",class:"hdh-form"},{default:a(()=>[e(c,{gutter:20},{default:a(()=>[e(n,null,{default:a(()=>[e(O,{label:"Tên loại",prop:"tenLoai"},{default:a(()=>[e(r,{modelValue:i.tenLoai,"onUpdate:modelValue":t[1]||(t[1]=p=>i.tenLoai=p),placeholder:"Nhập tên loại (Ví dụ: Thường, Pro)",autocomplete:"on",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{justify:"end",style:{"margin-top":"30px"}},{default:a(()=>[e(s,{onClick:j,style:{"margin-right":"10px"}},{default:a(()=>t[6]||(t[6]=[b("Hủy")])),_:1}),e(s,{type:"primary",onClick:A,loading:C.value},{default:a(()=>[b(de(v.value?"Cập nhật":"Lưu"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=ee(ge,[["__scopeId","data-v-8edc8960"]]);export{ke as default};
