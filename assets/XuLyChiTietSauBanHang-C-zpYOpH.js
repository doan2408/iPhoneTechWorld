import{_ as X,z as G,u as F,r,c as P,o as j,b as d,d as u,e as t,t as e,n as S,F as z,m as A,k as x,v as Z,Z as q,B as Q,h as Y,S as J}from"./index-I05jmhuU.js";import{d as W,f as R}from"./ActionAfterCaseServices-BFZbvqk8.js";import{h as tt}from"./MyOrderClient-DquLT7bn.js";import{C as nt}from"./ConfirmModal-u76TAxHq.js";const st={class:"processing-detail"},ot={class:"page-header"},et={class:"header-content"},lt={class:"header-info"},at={class:"main-content"},it={class:"info-section"},rt={class:"info-grid"},ct={class:"info-item"},ut={class:"info-item"},dt={class:"info-item"},ht={class:"info-item"},vt={class:"info-item"},gt={class:"info-item"},mt={class:"price"},pt={class:"imei-section"},_t={class:"section-header"},bt={class:"header-actions"},ft={class:"selected-count"},kt={class:"table-toolbar"},yt={class:"bulk-actions-top"},Tt={class:"toolbar-label"},Ct={class:"toolbar-buttons"},wt=["disabled"],xt=["disabled"],Dt={class:"export-actions"},It=["disabled"],Ht={class:"imei-table-container"},Nt={class:"imei-table-wrapper"},St={class:"imei-table"},Rt={class:"checkbox-col"},Bt=["checked"],Et={class:"checkbox-col"},Mt=["value"],Vt={class:"imei-code"},$t={class:"product-name"},Lt=["onClick"],Ut={key:1,style:{color:"gray","font-size":"14px"}},Kt={class:"tw-modal-content",style:{"max-width":"80%","max-height":"80%",padding:"0",background:"transparent","box-shadow":"none"}},Ot=["src"],Xt={key:1,style:{color:"gray","font-size":"14px"}},Gt={controls:"",autoplay:"",style:{"max-width":"80%","max-height":"80%"}},Ft=["src"],Pt={class:"action-col"},jt={class:"row-actions"},zt=["onClick","disabled"],At={class:"mt-4",style:{color:"red"}},Zt={class:"contact-section"},qt={class:"contact-grid"},Qt={class:"contact-item"},Yt={class:"contact-item"},Jt={class:"contact-item"},Wt={__name:"XuLyChiTietSauBanHang",setup(tn){const m=G().params.idHoaDon,g=F(),a=r([]),f=async()=>{const s=await tt(m);a.value=s.data},h=r([]),k=async()=>{const s=await W(m);h.value=s.data};r(""),r(""),r("phone"),r(0),r("");const l=r([]);r([]);const p=P(()=>l.value.length===h.value.length),B=s=>({"delivery-failed":"Giao h√†ng th·∫•t b·∫°i","return-request":"Y√™u c·∫ßu tr·∫£ h√†ng",processing:"ƒêang x·ª≠ l√Ω",completed:"Ho√†n th√†nh"})[s]||s,E=s=>({active:"Ho·∫°t ƒë·ªông",returned:"ƒê√£ tr·∫£",warranty:"B·∫£o h√†nh"})[s]||s,y=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),D=()=>{p.value?l.value=[]:l.value=h.value.map(s=>s.soImei)},M=()=>{if(l.value.length===0)return;const s=l.value.join(`
`),n=new Blob([s],{type:"text/plain"}),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download=`imei_export_${order.id}.txt`,o.click(),window.URL.revokeObjectURL(c)},V=()=>{J.push("/admin/handle")},I=async s=>{if(l.value.length===0){alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt IMEI!");return}switch(console.log(l.value),console.log(`[v0] Processing ${l.value.length} IMEIs with action: ${s}`),s){case"retry":break;case"return_to_stock":H(l.value,s);break;case"refund":H(l.value,s);break;default:alert(`H√†nh ƒë·ªông ${s} ch∆∞a ƒë∆∞·ª£c h·ªó tr·ª£!`)}l.value=[]},H=async(s,n)=>{const c=n.toUpperCase(),o=[];if(s.forEach(i=>{const v=h.value.find(O=>O.soImei===i);v&&(v.trangThaiDon==="REFUND"&&o.push({imei:i,reason:"ƒë√£ ƒë∆∞·ª£c ho√†n ti·ªÅn"}),n==="return_to_stock"&&v.trangThaiDon==="RETURN_TO_STOCK"&&o.push({imei:i,reason:"ƒë√£ ƒë∆∞·ª£c tr·∫£ v·ªÅ kho v√† ƒëang ch·ªù ho√†n ti·ªÅn"}))}),o.length>0){const i=o.map(v=>`IMEI ${v.imei} ${v.reason}`).join(`
`);g.error(`Kh√¥ng th·ªÉ th·ª±c hi·ªán h√†nh ƒë·ªông v√¨ c√≥ s·∫£n ph·∫©m kh√¥ng h·ª£p l·ªá:
${i}`);return}if(n==="refund"){if(!p.value){g.error("B·∫°n ph·∫£i ch·ªçn t·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÉ ho√†n ti·ªÅn.");return}if(!h.value.every(v=>v.trangThaiDon==="RETURN_TO_STOCK")){g.error("Ch·ªâ ƒë∆∞·ª£c ho√†n ti·ªÅn khi t·∫•t c·∫£ s·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c tr·∫£ v·ªÅ kho.");return}}await R(s,m,c),k(),f(),c==="RETURN_TO_STOCK"?g.success("Tr·∫£ v·ªÅ kho th√†nh c√¥ng"):g.success("Ho√†n ti·ªÅn th√†nh c√¥ng")},$=async(s,n)=>{const c=n.toUpperCase();await R([s],m,c),k(),f()};function L(s){return s?new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(s)):""}const _=r(!1),N=r("");let T=null;function C(s,n){N.value=s,T=n,_.value=!0}function U(){T&&T(),_.value=!1}j(async()=>{k(),f()});const b=r(null),w=r(!1);function K(){w.value=!1}return(s,n)=>{var c;return u(),d("div",st,[t("div",ot,[t("div",et,[t("button",{class:"back-btn",onClick:V}," ‚Üê Quay l·∫°i "),t("div",lt,[t("h1",null,"X·ª≠ l√Ω ƒë∆°n h√†ng #"+e(a.value.maHoaDon),1),t("span",{class:S(["order-status",a.value.trangThaiDonHang])},e(B(a.value.trangThaiDonHang)),3)])])]),t("div",at,[t("div",it,[n[12]||(n[12]=t("h2",null,"Th√¥ng tin ƒë∆°n h√†ng",-1)),t("div",rt,[t("div",ct,[n[6]||(n[6]=t("label",null,"M√£ v·∫≠n ƒë∆°n:",-1)),t("span",null,e(a.value.maVanDon),1)]),t("div",ut,[n[7]||(n[7]=t("label",null,"Kh√°ch h√†ng:",-1)),t("span",null,e(a.value.tenKhachHang||"Kh√°ch v√£ng lai"),1)]),t("div",dt,[n[8]||(n[8]=t("label",null,"S·ªë ƒëi·ªán tho·∫°i:",-1)),t("span",null,e(a.value.sdtNguoiNhan),1)]),t("div",ht,[n[9]||(n[9]=t("label",null,"ƒê·ªãa ch·ªâ giao h√†ng:",-1)),t("span",null,e(a.value.diaChiGiaoHang),1)]),t("div",vt,[n[10]||(n[10]=t("label",null,"Ng√†y ƒë·∫∑t h√†ng:",-1)),t("span",null,e(L(a.value.ngayDatHang)),1)]),t("div",gt,[n[11]||(n[11]=t("label",null,"Gi√° tr·ªã ƒë∆°n h√†ng:",-1)),t("span",mt,e(y(a.value.thanhTien)),1)])])]),t("div",pt,[t("div",_t,[n[13]||(n[13]=t("h2",null,"Danh s√°ch IMEI",-1)),t("div",bt,[t("button",{class:"btn-select-all",onClick:D},e(p.value?"B·ªè ch·ªçn t·∫•t c·∫£":"Ch·ªçn t·∫•t c·∫£"),1),t("span",ft,e(l.value.length)+"/"+e(h.value.length)+" ƒë√£ ch·ªçn",1)])]),t("div",kt,[t("div",yt,[t("span",Tt,"X·ª≠ l√Ω h√†ng lo·∫°t ("+e(l.value.length)+" ƒë√£ ch·ªçn):",1),t("div",Ct,[t("button",{class:"toolbar-btn return",onClick:n[0]||(n[0]=o=>C("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën tr·∫£ s·ªë s·∫£n ph·∫©m ƒë√£ ch·ªçn v√†o kho?",()=>I("return_to_stock"))),title:"Tr·∫£ kho",disabled:l.value.length===0}," üì¶Tr·∫£ kho ",8,wt),t("button",{class:"toolbar-btn refund",onClick:n[1]||(n[1]=o=>C("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ho√†n ti·ªÅn cho to√†n b·ªô s·∫£n ph·∫©m trong ƒë∆°n?",()=>I("refund"))),title:"Ho√†n ti·ªÅn",disabled:l.value.length===0}," üí∞ Ho√†n ti·ªÅn ",8,xt)])]),t("div",Dt,[t("button",{class:"export-btn",onClick:M,disabled:l.value.length===0}," üìÑ Xu·∫•t danh s√°ch ",8,It)])]),t("div",Ht,[t("div",Nt,[t("table",St,[t("thead",null,[t("tr",null,[t("th",Rt,[t("input",{type:"checkbox",checked:p.value,onChange:D,class:"header-checkbox"},null,40,Bt)]),n[14]||(n[14]=t("th",null,"IMEI",-1)),n[15]||(n[15]=t("th",null,"S·∫£n ph·∫©m",-1)),n[16]||(n[16]=t("th",null,"Tr·∫°ng th√°i",-1)),n[17]||(n[17]=t("th",null,"Gi√° b√°n",-1)),n[18]||(n[18]=t("th",null,"L√Ω do tr·∫£ h√†ng",-1)),n[19]||(n[19]=t("th",null,"H√¨nh ·∫£nh",-1)),n[20]||(n[20]=t("th",null,"Video",-1)),n[21]||(n[21]=t("th",null,"H√†nh ƒë·ªông",-1))])]),t("tbody",null,[(u(!0),d(z,null,A(h.value,o=>(u(),d("tr",{key:o.idXlbh,class:"imei-row"},[t("td",Et,[Z(t("input",{type:"checkbox",value:o.soImei,"onUpdate:modelValue":n[2]||(n[2]=i=>l.value=i),class:"row-checkbox"},null,8,Mt),[[q,l.value]])]),t("td",Vt,e(o.soImei),1),t("td",$t,e(o.tenSanPham+"-"+o.mau+"-"+o.dungLuong),1),t("td",null,[t("span",{class:S(["imei-status",o.trangThaiDon])},e(E(o.trangThaiDon)),3)]),t("td",null,[t("span",null,e(y(o.donGia)),1)]),t("td",null,[t("span",null,e(o.tenLyDo),1)]),t("td",null,[o.urlHinh?(u(),d("button",{key:0,onClick:i=>b.value=o.urlHinh,style:{cursor:"pointer"},class:"view-button"}," Xem h√¨nh ·∫£nh ",8,Lt)):(u(),d("span",Ut,"Kh√¥ng c√≥ h√¨nh ·∫£nh"))]),b.value?(u(),d("div",{key:0,class:"tw-modal-overlay",onClick:n[3]||(n[3]=i=>b.value=null)},[t("div",Kt,[t("img",{src:b.value,style:{"max-width":"100%","max-height":"100%","border-radius":"8px"}},null,8,Ot)])])):x("",!0),t("td",null,[o.urlVideo?(u(),d("button",{key:0,onClick:n[4]||(n[4]=i=>w.value=!0),style:{cursor:"pointer"},class:"view-button"}," Xem video ")):(u(),d("span",Xt,"Kh√¥ng c√≥ video"))]),w.value?(u(),d("div",{key:1,class:"modal",onClick:K},[t("video",Gt,[t("source",{src:o.urlVideo,type:"video/mp4"},null,8,Ft)])])):x("",!0),t("td",Pt,[t("div",jt,[t("button",{class:"action-btn return",onClick:i=>C("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën g·ª≠i y√™u c·∫ßu nh·∫≠p kho?",()=>$(o.soImei,"return_to_stock")),title:"Tr·∫£ kho",disabled:o.trangThaiDon==="RETURN_TO_STOCK"||o.trangThaiDon==="REFUND"}," üì¶ ",8,zt),_.value?(u(),Q(nt,{key:0,message:N.value,onConfirm:U,onCancel:n[5]||(n[5]=i=>_.value=!1)},null,8,["message"])):x("",!0)])])]))),128))])]),t("div",At,[n[22]||(n[22]=t("strong",null,"S·ªë ti·ªÅn c·∫ßn tr·∫£:",-1)),Y(" "+e(y((c=h.value[0])==null?void 0:c.soTienHoan)),1)])])])]),t("div",Zt,[n[26]||(n[26]=t("h2",null,"Th√¥ng tin li√™n h·ªá kh√°ch h√†ng",-1)),t("div",qt,[t("div",Qt,[n[23]||(n[23]=t("label",null,"Email:",-1)),t("span",null,e(a.value.emailNguoiNhan),1)]),t("div",Yt,[n[24]||(n[24]=t("label",null,"Zalo:",-1)),t("span",null,e(a.value.sdtNguoiNhan),1)]),t("div",Jt,[n[25]||(n[25]=t("label",null,"Ghi ch√∫ kh√°ch h√†ng:",-1)),t("span",null,e(a.value.customerNote||"Kh√¥ng c√≥ ghi ch√∫"),1)])])])])])}}},an=X(Wt,[["__scopeId","data-v-46447d4c"]]);export{an as default};
