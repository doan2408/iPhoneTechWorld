import{_ as R,r as m,T as E,A as H,z as U,H as L,I as M,w as A,a as I,b as l,d as r,e as t,y as N,k as _,v as f,U as k,t as p,f as B,i as D,h as v,E as K,n as V,S as O,B as $}from"./index-BFtI-PwE.js";import{c as j}from"./GioHangClientService-DnoTnJBO.js";import q from"./VerifyRegister-BD6Kyvtz.js";const z={class:"login-page"},F={class:"login-container"},J={key:0,class:"text-danger mb-1"},P={key:0,class:"text-danger mb-1"},Q={key:0,class:"text-danger mb-1"},W={class:"forgot-password-wrapper"},X=["disabled"],G={class:"switch-mode"},Y={__name:"SignInView",emits:["switchToRegister"],setup(C,{emit:g}){const i=m(""),u=m("");m("");const e=E({}),d=m(!1),T=H(),x=U(),c=L(),y=g,s=m(0);c.hasModule("headerState")||c.registerModule("headerState",M);const a=()=>{c.commit("headerState/setCartItemCount",s.value)},w=async()=>{if(!i.value.trim()||!u.value.trim()){K.error("Vui lòng nhập tài khoản và mật khẩu");return}try{d.value=!0,await c.dispatch("login",{taiKhoan:i.value,matKhau:u.value});let n=x.query.redirect||h();(!n||n==="/")&&(n=h()),c.getters.isCustomer&&!n.startsWith("/client")?n=`/client${n}`:c.getters.isCustomer||(n=h()),console.log("path: ",n),T.push(n);const o=JSON.parse(localStorage.getItem("user"));try{s.value=await j.cartCount(o.id)}catch(b){console.error("Lỗi khi tải giỏ hàng:",b)}a(),K.success("Đăng nhập thành công !")}catch(n){console.log("Error:",n),Array.isArray(n)&&n.forEach(({field:o,message:b})=>{o==="trang_thai"?K.error(b):e[o]=b})}finally{d.value=!1}};function h(){return c.getters.isAdmin||c.getters.isStaff?"/admin/ban-hang":c.getters.isCustomer?"/client/home":"/"}return m(!0),A([i,u],()=>{delete e.tai_khoan,delete e.mat_khau,delete e.server}),(n,o)=>{const b=I("router-link");return r(),l("div",z,[t("div",F,[o[7]||(o[7]=t("h2",null,"Đăng nhập",-1)),t("form",{onSubmit:N(w,["prevent"])},[t("div",null,[o[3]||(o[3]=t("label",null,"Tài khoản:",-1)),f(t("input",{"onUpdate:modelValue":o[0]||(o[0]=S=>i.value=S),type:"text",placeholder:"Nhập tài khoản",class:"form-control"},null,512),[[k,i.value,void 0,{trim:!0}]]),e.tai_khoan?(r(),l("div",J,p(e.tai_khoan),1)):_("",!0)]),t("div",null,[o[4]||(o[4]=t("label",null,"Mật khẩu:",-1)),f(t("input",{"onUpdate:modelValue":o[1]||(o[1]=S=>u.value=S),type:"password",placeholder:"Nhập mật khẩu",class:"form-control"},null,512),[[k,u.value,void 0,{trim:!0}]]),e.mat_khau?(r(),l("div",P,p(e.mat_khau),1)):_("",!0)]),e.server?(r(),l("div",Q,p(e.server),1)):_("",!0),t("div",W,[B(b,{to:"/forgot-password",class:"forgot-password-link"},{default:D(()=>o[5]||(o[5]=[v("Quên mật khẩu?")])),_:1})]),t("button",{type:"submit",disabled:d.value,class:"btn btn-primary"},p(d.value?"Đang xử lý...":"Đăng nhập"),9,X),t("p",G,[o[6]||(o[6]=v(" Chưa có tài khoản? ")),t("span",{onClick:o[2]||(o[2]=S=>y("switchToRegister")),class:"switch-link"},"Tạo tài khoản")])],32)])])}}},Z=R(Y,[["__scopeId","data-v-b4084925"]]),tt={class:"signup-page"},et={class:"signup-container"},st={class:"form-row"},ot={class:"form-group"},it={class:"input-wrapper"},at={key:0,class:"error-message"},nt={class:"form-group"},rt={class:"input-wrapper"},lt={key:0,class:"error-message"},ut={class:"form-group form-full-width"},dt={class:"input-wrapper"},ct={key:0,class:"error-message"},ht={class:"form-row"},mt={class:"form-group"},pt={class:"input-wrapper"},gt={key:0,class:"error-message"},vt={class:"form-group"},_t={class:"input-wrapper"},ft={key:0,class:"error-message"},kt=["disabled"],yt={key:0,class:"loading-spinner"},wt={key:1,class:"icon"},bt={class:"switch-mode"},Vt={__name:"SignUpView",emits:["switchToLogin"],setup(C,{emit:g}){const i=m({}),u=m(""),e=E({}),d=m(!1),T=L(),x=g,c=async()=>{Object.keys(e).forEach(h=>delete e[h]);const{taiKhoan:y,matKhau:s,tenKhachHang:a,email:w}=i.value;if(y!=null&&y.trim()||(e.taiKhoan="Vui lòng nhập tài khoản"),s!=null&&s.trim()||(e.matKhau="Vui lòng nhập mật khẩu"),a!=null&&a.trim()||(e.tenKhachHang="Vui lòng nhập họ tên"),w!=null&&w.trim()||(e.email="Vui lòng nhập email"),s!==u.value&&(e.confirm_mat_khau="Mật khẩu nhập lại không khớp"),!(Object.keys(e).length>0))try{d.value=!0,console.log("Đăng ký với dữ liệu:",i.value),await T.dispatch("registerVerify",i.value),setTimeout(()=>{O.push({path:"/verify-register",query:{email:w}})},1e3),x("switchToVerify")}catch(h){console.log("Error:",h),Array.isArray(h)?h.forEach(({field:n,message:o})=>{e[n]=o}):e.server=h.message||"Register failed"}finally{d.value=!1}};return(y,s)=>(r(),l("div",tt,[t("div",et,[s[13]||(s[13]=t("div",{class:"header-section"},[t("h2",null,"Đăng ký tài khoản"),t("p",{class:"subtitle"},"Tạo tài khoản để bắt đầu hành trình của bạn")],-1)),t("form",{onSubmit:N(c,["prevent"]),class:"signup-form"},[t("div",st,[t("div",ot,[s[6]||(s[6]=t("label",null,[t("i",{class:"icon"},"👤"),v(" Tài khoản ")],-1)),t("div",it,[f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>i.value.taiKhoan=a),type:"text",placeholder:"Nhập tài khoản",class:V({error:e.taiKhoan})},null,2),[[k,i.value.taiKhoan,void 0,{trim:!0}]]),e.taiKhoan?(r(),l("div",at,p(e.taiKhoan),1)):_("",!0)])]),t("div",nt,[s[7]||(s[7]=t("label",null,[t("i",{class:"icon"},"📝"),v(" Họ tên ")],-1)),t("div",rt,[f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>i.value.tenKhachHang=a),type:"text",placeholder:"Nhập họ tên đầy đủ",class:V({error:e.tenKhachHang})},null,2),[[k,i.value.tenKhachHang]]),e.tenKhachHang?(r(),l("div",lt,p(e.tenKhachHang),1)):_("",!0)])])]),t("div",ut,[s[8]||(s[8]=t("label",null,[t("i",{class:"icon"},"📧"),v(" Email ")],-1)),t("div",dt,[f(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>i.value.email=a),type:"email",placeholder:"example@email.com",class:V({error:e.email})},null,2),[[k,i.value.email]]),e.emailExist?(r(),l("div",ct,p(e.emailExist),1)):_("",!0)])]),t("div",ht,[t("div",mt,[s[9]||(s[9]=t("label",null,[t("i",{class:"icon"},"🔒"),v(" Mật khẩu ")],-1)),t("div",pt,[f(t("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>i.value.matKhau=a),type:"password",placeholder:"Tối thiểu 8 ký tự",class:V({error:e.matKhau})},null,2),[[k,i.value.matKhau]]),e.matKhau?(r(),l("div",gt,p(e.matKhau),1)):_("",!0)])]),t("div",vt,[s[10]||(s[10]=t("label",null,[t("i",{class:"icon"},"🔐"),v(" Xác nhận mật khẩu ")],-1)),t("div",_t,[f(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>u.value=a),type:"password",placeholder:"Nhập lại mật khẩu",class:V({error:e.confirm_mat_khau})},null,2),[[k,u.value]]),e.confirm_mat_khau?(r(),l("div",ft,p(e.confirm_mat_khau),1)):_("",!0)])])]),t("button",{type:"submit",disabled:d.value,class:"submit-btn"},[d.value?(r(),l("span",yt)):(r(),l("i",wt,"🚀")),v(" "+p(d.value?"Đang xử lý...":"Tạo tài khoản"),1)],8,kt),s[12]||(s[12]=t("div",{class:"divider"},[t("span",null,"hoặc")],-1)),t("div",bt,[s[11]||(s[11]=t("p",null,"Đã có tài khoản?",-1)),t("button",{type:"button",onClick:s[5]||(s[5]=a=>x("switchToLogin")),class:"switch-link"}," Đăng nhập ngay ")])],32)])]))}},Tt=R(Vt,[["__scopeId","data-v-2a7d6b06"]]),xt={class:"auth-page"},St={class:"auth-container"},Rt={__name:"LoginView",setup(C){const g=m("login"),i=()=>g.value="login",u=()=>g.value="register",e=()=>g.value="verify";return(d,T)=>(r(),l("div",xt,[t("div",St,[g.value==="login"?(r(),$(Z,{key:0,onSwitchToRegister:u})):g.value==="register"?(r(),$(Tt,{key:1,onSwitchToLogin:i,onSwitchToVerify:e})):(r(),$(q,{key:2}))])]))}};export{Rt as default};
