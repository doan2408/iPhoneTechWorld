import{_ as G,r as u,T as j,u as J,o as Z,b as o,d as s,e as n,k as h,n as g,v as L,U as x,h as p,t as l,F as E,m as R,B as nn}from"./index-I05jmhuU.js";import{f as tn,c as an,b as ln,d as sn,h as en}from"./BaoHanhService-DLeMNXuR.js";import{C as on}from"./ConfirmModal-u76TAxHq.js";const un={class:"warranty-container"},rn={class:"tabs"},hn={key:0,class:"tab-content"},dn={class:"search-section"},vn={class:"search-form"},cn={key:0,class:"product-info"},gn={class:"product-card"},pn={class:"product-details"},yn={class:"warranty-types"},mn={class:"warranty-list"},bn={key:0},fn={class:"warranty-info"},Hn=["onClick"],Tn={key:1,class:"no-warranty"},kn={key:1,class:"create-warranty-form"},Bn={class:"form-card"},Cn={class:"selected-warranty"},In={class:"form-group"},_n={key:0,class:"error-reason"},Mn={class:"form-actions"},Nn=["disabled"],Ln={key:1,class:"tab-content"},xn={class:"table-container"},En={class:"warranty-table"},Rn=["onClick","disabled"],Dn={key:0},Wn={key:1},wn={class:"pagination-controls",style:{"margin-top":"0"}},Pn=["disabled"],Sn=["disabled"],An={key:2,class:"tab-content"},$n={class:"history-search"},Vn={key:0,class:"history-results"},Kn={class:"history-list"},Un={class:"history-header"},Yn={class:"order-id"},Fn={class:"history-details"},Xn={key:0},zn={__name:"YeuCauBaoHanhAdmin",setup(On){const v=u("lookup"),y=u(""),i=u(null),c=u(null),f=j({description:""}),D=u([]),m=u(""),k=u([]);u(!1),u(null);const _=u(!1),W=u(""),w=u("success"),r=u(0),A=u(5),B=u(0),d=J();function P(e,t="success"){W.value=e,w.value=t,_.value=!0,setTimeout(()=>{_.value=!1},3e3)}async function $(){if(i.value=null,c.value=null,!y.value){d.warning("Vui lòng nhập IMEI");return}if(y.value.length!==15||!/^\d+$/.test(y.value)){d.warning("IMEI phải có đúng 15 số");return}const e=await an(y.value);if(!e||e.data===""){d.warning("Không tìm thấy thông tin sản phẩm với IMEI này");return}i.value=e.data,d.success("Tìm thấy thông tin sản phẩm!")}function V(e){c.value=e,d.success("Đã chọn loại bảo hành "+c.value.tenLoaiBaoHanh)}const b=u({}),H=u(!1);async function K(){var e;if(!H.value){H.value=!0,b.value={};try{const t={idBaoHanh:c.value.idBaoHanh,lyDoBaoHanh:f.description};await ln(t),i.value=null,c.value=null,y.value="",f.description="",T(r.value),d.success("Tạo đơn bảo hành thành công!")}catch(t){((e=t.response)==null?void 0:e.status)===400&&t.response.data?(b.value=t.response.data,b.value.idBaoHanh&&P(b.value.idBaoHanh,"error")):P("Có lỗi xảy ra","error")}finally{H.value=!1}}}function U(){c.value=null,f.description=""}const C=u(!1);async function Y(e){try{C.value=!0,await en(e),await T(r.value),d.success("Đơn hàng đã được xử lý")}catch(t){console.error(t),d.error("Xử lý thất bại, vui lòng thử lại")}finally{C.value=!1}}async function F(){if(!m.value||m.value.trim()===""){d.warning("Vui lòng nhập IMEI","error");return}if(!/^\d+$/.test(m.value)){d.warning("IMEI chỉ được phép chứa số (0–9), không được nhập chữ cái hay ký tự đặc biệt.");return}const e=await sn(m.value);k.value=e.data,k.value.length===0&&d.warning("Không tìm thấy lịch sử bảo hành cho IMEI này","error")}async function T(e){r.value=e;const t=await tn(r.value,A.value);D.value=t.data.content,B.value=t.data.totalPages}const X=()=>{r.value<B.value-1&&T(r.value+1)},z=()=>{r.value>0&&T(r.value-1)};Z(()=>{T(r.value)});function O(e){return e?new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(e)):""}const I=u(!1),S=u("");let M=null;function Q(e,t){S.value=e,M=t,I.value=!0}function q(){M&&M(),I.value=!1}return(e,t)=>(s(),o("div",un,[t[30]||(t[30]=n("div",{class:"header"},[n("h1",null,"Hệ Thống Quản Lý Bảo Hành")],-1)),n("div",rn,[n("button",{class:g(["tab-btn",{active:v.value==="lookup"}]),onClick:t[0]||(t[0]=a=>v.value="lookup")}," Tra Cứu & Tạo Đơn ",2),n("button",{class:g(["tab-btn",{active:v.value==="manage"}]),onClick:t[1]||(t[1]=a=>v.value="manage")}," Quản Lý Đơn Bảo Hành ",2),n("button",{class:g(["tab-btn",{active:v.value==="history"}]),onClick:t[2]||(t[2]=a=>v.value="history")}," Lịch Sử Bảo Hành ",2)]),v.value==="lookup"?(s(),o("div",hn,[n("div",dn,[t[9]||(t[9]=n("h2",null,"Tra Cứu Thông Tin Bảo Hành",-1)),n("div",vn,[L(n("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),type:"text",placeholder:"Nhập IMEI (15 số)",class:"imei-input",maxlength:"15"},null,512),[[x,y.value]]),n("button",{onClick:$,class:"search-btn"},"Tra Cứu")])]),i.value?(s(),o("div",cn,[t[15]||(t[15]=n("h3",null,"Thông Tin Sản Phẩm",-1)),n("div",gn,[n("div",pn,[n("p",null,[t[10]||(t[10]=n("strong",null,"IMEI:",-1)),p(" "+l(i.value.soImei),1)]),n("p",null,[t[11]||(t[11]=n("strong",null,"Tên sản phẩm:",-1)),p(" "+l(i.value.tenSanPham+" "+i.value.mau+" "+i.value.dungLuong),1)]),n("p",null,[t[12]||(t[12]=n("strong",null,"Ngày mua:",-1)),p(" "+l(O(i.value.ngayMuaHang)),1)])]),n("div",yn,[t[14]||(t[14]=n("h4",null,"Các Loại Bảo Hành Có Sẵn:",-1)),n("div",mn,[i.value.lstBaoHanh&&i.value.lstBaoHanh.length>0?(s(),o("div",bn,[(s(!0),o(E,null,R(i.value.lstBaoHanh,a=>(s(),o("div",{key:a.idBaoHanh,class:g(["warranty-item",{expired:a.trangThaiBaoHanh==="WARRANTY_EXPIRED"}])},[n("div",fn,[n("h5",null,l(a.tenLoaiBaoHanh),1),n("p",null,"Thời hạn: "+l(a.thoiGianThang)+" tháng",1),n("p",null,"Hết hạn: "+l(a.ngayHetHan),1),n("span",{class:g(["status",a.trangThaiBaoHanh])},l(a.trangThaiBaoHanh==="UNDER_WARRANTY"?"Còn bảo hành":"Hết bảo hành"),3)]),a.trangThaiBaoHanh==="UNDER_WARRANTY"?(s(),o("button",{key:0,onClick:N=>V(a),class:"select-warranty-btn"}," Chọn ",8,Hn)):h("",!0)],2))),128))])):(s(),o("div",Tn,t[13]||(t[13]=[n("p",{style:{color:"red"}},"Không có loại bảo hành khả dụng",-1)])))])])])])):h("",!0),c.value?(s(),o("div",kn,[t[18]||(t[18]=n("h3",null,"Tạo Đơn Bảo Hành",-1)),n("div",Bn,[n("div",Cn,[n("p",null,[t[16]||(t[16]=n("strong",null,"Loại bảo hành đã chọn:",-1)),p(" "+l(c.value.tenLoaiBaoHanh),1)])]),n("div",In,[t[17]||(t[17]=n("label",null,"Mô tả lỗi:",-1)),L(n("textarea",{"onUpdate:modelValue":t[4]||(t[4]=a=>f.description=a),placeholder:"Mô tả chi tiết lỗi của sản phẩm",rows:"4"},null,512),[[x,f.description]]),b.value.lyDoBaoHanh?(s(),o("p",_n,l(b.value.lyDoBaoHanh),1)):h("",!0)]),n("div",Mn,[n("button",{onClick:K,class:"create-btn",disabled:H.value},l(H.value?"Đang xử lý...":"Tạo Đơn Bảo Hành"),9,Nn),n("button",{onClick:U,class:"cancel-btn"},"Hủy")])])])):h("",!0)])):h("",!0),v.value==="manage"?(s(),o("div",Ln,[t[22]||(t[22]=n("h2",null,"Danh Sách Đơn Bảo Hành",-1)),t[23]||(t[23]=n("br",null,null,-1)),n("div",xn,[n("table",En,[t[19]||(t[19]=n("thead",null,[n("tr",null,[n("th",null,"Mã Đơn"),n("th",null,"IMEI"),n("th",null,"Sản Phẩm"),n("th",null,"Loại BH"),n("th",null,"Khách Hàng"),n("th",null,"Ngày Tiếp Nhận"),n("th",null,"Ngày Hoàn Thành"),n("th",null,"Trạng Thái"),n("th",null,"Thao Tác")])],-1)),n("tbody",null,[(s(!0),o(E,null,R(D.value,a=>(s(),o("tr",{key:a.idLsbh,class:"table-row"},[n("td",null,l(a.idLsbh),1),n("td",null,l(a.soImei),1),n("td",null,l(a.tenSanPham+"-"+a.mau+"-"+a.rom),1),n("td",null,l(a.loaiBaoHanh),1),n("td",null,l(a.tenKhachHang),1),n("td",null,l(a.ngayTiepNhan),1),n("td",null,l(a.ngayHoanThanh||"Đơn hàng đang được xử lý"),1),n("td",null,[n("span",{class:g(["status-badge",a.status])},l(a.trangThai==="IN_REPAIR"?"Đang sửa chữa":"Đã sửa chữa"),3)]),n("td",null,[a.trangThai==="IN_REPAIR"?(s(),o("button",{key:0,onClick:N=>Q("Xác nhận là đã xử lý xong?",()=>Y(a.idLsbh)),class:"complete-btn",disabled:C.value},[C.value?(s(),o("span",Dn,"Đang xử lý...")):(s(),o("span",Wn,"Hoàn Thành"))],8,Rn)):h("",!0)])]))),128))]),I.value?(s(),nn(on,{key:0,message:S.value,onConfirm:q,onCancel:t[5]||(t[5]=a=>I.value=!1)},null,8,["message"])):h("",!0)]),t[20]||(t[20]=n("br",null,null,-1)),n("div",wn,[n("button",{onClick:t[6]||(t[6]=a=>z()),disabled:r.value===0},"Trước",8,Pn),n("span",null,"Trang "+l(r.value+1)+" / "+l(B.value),1),n("button",{onClick:t[7]||(t[7]=a=>X()),disabled:r.value>=B.value-1},"Sau",8,Sn)]),t[21]||(t[21]=n("br",null,null,-1))])])):h("",!0),v.value==="history"?(s(),o("div",An,[t[28]||(t[28]=n("h2",null,"Lịch Sử Bảo Hành",-1)),t[29]||(t[29]=n("br",null,null,-1)),n("div",$n,[L(n("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>m.value=a),type:"text",placeholder:"Nhập IMEI để xem lịch sử",maxlength:"15",class:"imei-input"},null,512),[[x,m.value]]),n("button",{onClick:F,class:"search-btn"},"Tìm Kiếm")]),k.value.length>0?(s(),o("div",Vn,[n("h3",null,"Lịch Sử Bảo Hành - IMEI: "+l(m.value),1),n("div",Kn,[(s(!0),o(E,null,R(k.value,(a,N)=>(s(),o("div",{key:a.idLsbh,class:"history-item"},[n("div",Un,[n("span",Yn,"Lần #"+l(N+1),1),n("span",{class:g(["status-badge",a.status])},l(a.status==="IN_REPAIR"?"Đang sửa chữa":"Đã sửa chữa"),3)]),n("div",Fn,[n("p",null,[t[24]||(t[24]=n("strong",null,"Loại bảo hành:",-1)),p(" "+l(a.loaiBaoHanh),1)]),n("p",null,[t[25]||(t[25]=n("strong",null,"Mô tả:",-1)),p(" "+l(a.moTa),1)]),n("p",null,[t[26]||(t[26]=n("strong",null,"Ngày yêu cầu:",-1)),p(" "+l(a.ngayYeuCau),1)]),a.ngayHoanThanh?(s(),o("p",Xn,[t[27]||(t[27]=n("strong",null,"Ngày hoàn thành:",-1)),p(" "+l(a.ngayHoanThanh),1)])):h("",!0)])]))),128))])])):h("",!0)])):h("",!0),_.value?(s(),o("div",{key:3,class:g(["toast",w.value])},l(W.value),3)):h("",!0)]))}},jn=G(zn,[["__scopeId","data-v-3655bda8"]]);export{jn as default};
