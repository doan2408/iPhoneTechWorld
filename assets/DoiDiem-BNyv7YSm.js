import{V as H,_ as J,r,T as Q,w as Z,o as tt,a as l,b as E,d as S,e as u,f as n,k as et,h as s,t as h,i as a,j as nt,a9 as at,F as ot,m as rt,E as g,R as st}from"./index-I05jmhuU.js";import{d as it}from"./TichDiemServices-Bu2dXRqM.js";import{g as lt}from"./HangServices-BuJW2bK0.js";const ct="/client/voucher",ut=async({params:p})=>{var c;try{return(await H.get(`${ct}`,{params:p})).data}catch(_){throw console.error("Errors when getting vouchers"),((c=_.response)==null?void 0:c.data)||new Error("Lỗi khi lấy danh sách phiếu giảm giá")}},ht="/client/viDiem",gt=async()=>{var p;try{return(await H.get(`${ht}`)).data}catch(c){throw console.log("Thrown errors when loading point of client"),((p=c.response)==null?void 0:p.data)||"Thrown errors when loading point of client"}},mt={class:"voucher-page"},dt={class:"header"},pt={class:"diem-kha-dung"},_t={class:"hang-thanh-vien"},ft={key:0,class:"diem-sap-het-han"},yt={class:"pagination"},N=10,Dt={__name:"DoiDiem",setup(p){const c=r([]),_=r(0),b=r(1),f=r({}),y=r("MEMBER"),x=["MEMBER","SILVER","GOLD","DIAMOND"],T=r("");Q([]);const L={MEMBER:0,SILVER:1,GOLD:2,DIAMOND:3};let k=null;const $=t=>{k||(k=g.warning({message:t,timeout:3e3,closeButton:!0,onClose:()=>{k=null}}))},A=t=>typeof t!="number"?"":t.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),V=t=>new Intl.NumberFormat("vi-VN").format(t),R=(t,e)=>typeof t!="number"?"":e==="Phần trăm"?t+"%":e==="Cố định"?t.toLocaleString("vi-VN",{style:"currency",currency:"VND"}):t,M=t=>{if(!t)return"";const e=new Date(t),m=e.getDate().toString().padStart(2,"0"),w=(e.getMonth()+1).toString().padStart(2,"0"),D=e.getFullYear(),i=e.getHours().toString().padStart(2,"0"),C=e.getMinutes().toString().padStart(2,"0");return`${m}/${w}/${D} ${i}:${C}`},I=(t,e)=>L[e]>=L[t],K=r(null),O=r(null),z=r(null),F=r(null),P=async(t="Xác nhận hành động?",e="Thông báo")=>{try{return await st.confirm(t,e),!0}catch{return!1}},v=async()=>{try{const t={page:b.value-1,size:N,search:K.value,trangThai:O.value,ngayBatDau:z.value,ngayKetThuc:F.value,hangToiThieu:y.value},e=await ut({params:t});c.value=Array.isArray(e.content)?e.content:[],_.value=e.totalElements||0}catch{g.error("Lỗi khi tải danh sách voucher")}},B=async()=>{try{const t=await gt();f.value=t}catch{g.error("Lỗi khi lấy điểm khả dụng")}},G=async t=>{if(await P("Xác nhận đổi điểm?")){if(new Date(t.ngayKetThuc)<=new Date){g.warning("Phiếu giảm giá đã hết hạn!");return}if(new Date(t.ngayBatDau)>new Date){g.warning("Phiếu giảm giá chưa bắt đầu!");return}try{await it(t.id),g.success("Đổi điểm thành công!"),v(),B()}catch(m){Array.isArray(m)?m.forEach(({field:w,message:D})=>{$(D)}):g.error("Lỗi khi đổi điểm")}}},U=async()=>{try{const t=await lt();T.value=t}catch(t){g.error((t==null?void 0:t.message)||"Lỗi khi lấy thông tin hạng")}},X=t=>{b.value=t,v()};return Z(y,()=>{b.value=1,v()}),tt(()=>{U(),v(),B()}),(t,e)=>{const m=l("router-link"),w=l("el-icon"),D=l("el-tooltip"),i=l("el-table-column"),C=l("el-button"),j=l("el-table"),W=l("el-pagination"),Y=l("el-tab-pane"),q=l("el-tabs");return S(),E("div",mt,[u("div",dt,[e[5]||(e[5]=u("h2",null,"Danh sách Voucher",-1)),u("div",pt,[e[1]||(e[1]=s(" Điểm khả dụng: ")),u("strong",null,h(V(f.value.diemKhaDung)),1)]),u("div",_t,[n(m,{to:"/client/khoangHang",class:"hang"},{default:a(()=>[e[2]||(e[2]=s("Hạng: ")),u("strong",null,h(T.value),1)]),_:1})]),f.value.diemSapHetHan?(S(),E("div",ft,[e[3]||(e[3]=s(" Có: ")),u("strong",null,h(V(f.value.diemSapHetHan||0)),1),e[4]||(e[4]=s(" điểm sắp hết hạn trong 7 ngày tới "))])):et("",!0),n(D,{content:"Lịch sử điểm",placement:"top"},{default:a(()=>[n(m,{to:"/client/lichSuDiem",class:"history-icon"},{default:a(()=>[n(w,null,{default:a(()=>[n(nt(at))]),_:1})]),_:1})]),_:1})]),n(q,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=d=>y.value=d),class:"tabs"},{default:a(()=>[(S(),E(ot,null,rt(x,d=>n(Y,{key:d,label:d,name:d},{default:a(()=>[n(j,{data:c.value,style:{width:"100%"},"empty-text":`Chưa có voucher cho mục ${d}`},{default:a(()=>[n(i,{prop:"tenGiamGia",label:"Tên voucher"}),n(i,{label:"Điểm cần đổi"},{default:a(o=>[s(h(V(o.row.soDiemCanDeDoi)),1)]),_:1}),n(i,{label:"Giá trị giảm"},{default:a(o=>[s(h(R(o.row.giaTriGiamGia,o.row.loaiGiamGia)),1)]),_:1}),n(i,{label:"Áp dụng đơn hàng tối thiểu"},{default:a(o=>[s(h(A(o.row.giaTriDonHangToiThieu)),1)]),_:1}),n(i,{label:"Thời gian bắt đầu"},{default:a(o=>[s(h(M(o.row.ngayBatDau)),1)]),_:1}),n(i,{label:"Thời gian kết thúc"},{default:a(o=>[s(h(M(o.row.ngayKetThuc)),1)]),_:1}),n(i,{label:"Thao tác"},{default:a(o=>[n(C,{type:"primary",size:"small",disabled:o.row.soDiemCanDeDoi>f.value.diemKhaDung||!I(y.value,T.value),onClick:vt=>G(o.row)},{default:a(()=>e[6]||(e[6]=[s(" Đổi điểm ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:2},1032,["data","empty-text"]),u("div",yt,[n(W,{background:"",layout:"prev, pager, next",total:_.value,"page-size":N,onCurrentChange:X},null,8,["total"])])]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}},kt=J(Dt,[["__scopeId","data-v-a1883ba6"]]);export{kt as default};
