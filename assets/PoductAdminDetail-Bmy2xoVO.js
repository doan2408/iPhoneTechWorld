import{_ as Ue,u as je,c as he,a1 as ce,z as He,A as Oe,r as x,T as H,o as qe,E as O,a as w,b as C,d as v,e as i,f as l,B as q,k as $,i as r,F as A,m as N,t as b,h as E,j as G,ao as ze,l as Ke,n as Ge,G as me,R as ne,V as Xe,aA as Je}from"./index-BFtI-PwE.js";import{aA as We,i as Qe,j as Ye,k as Ze,m as en,aB as nn}from"./ProductAdminService-Cqy2_DSd.js";import{l as an}from"./lodash-BgakiGRg.js";import{r as tn,u as ln}from"./xlsx-Ca6gsgWq.js";const sn={class:"container mt-4"},on={class:"form-section"},rn={class:"form-section"},un={class:"table-container"},hn={class:"table-cell-content"},cn={class:"table-cell-content"},mn={class:"table-cell-content"},dn={class:"price-cell"},pn={class:"table-images"},gn={key:0,class:"image-preview-container"},fn=["src","alt","onClick"],vn={key:0,class:"image-count"},In={key:1,class:"no-image"},Cn={key:0,class:"form-section edit-section"},_n={class:"edit-title"},bn={class:"imei-upload-container"},Pn={key:0,class:"file-name"},yn={key:1,class:"file-placeholder"},Tn={class:"imei-info"},kn={class:"imei-count"},Mn={key:0,class:"excel-indicator"},wn={key:1,class:"imei-error"},Sn={key:2,class:"imei-error"},Vn={class:"image-upload-section"},En={key:0,class:"current-images"},$n={class:"images-subtitle"},Bn={class:"images-grid"},xn={class:"image-wrapper"},Ln=["src","alt","onClick"],An={class:"image-overlay"},Nn={class:"image-info"},Fn={class:"image-name"},Rn={class:"image-size"},Dn={class:"upload-area"},Un={key:0,class:"upload-progress"},jn={class:"progress-text"},Hn={key:1,class:"form-section"},On={key:2,class:"form-actions"},qn={class:"preview-container"},zn={class:"preview-main"},Kn=["src","alt"],Gn={key:0,class:"preview-thumbnails"},Xn=["onClick"],Jn=["src","alt"],Wn={class:"preview-footer"},Qn={class:"image-counter"},Yn={class:"preview-actions"},Zn={__name:"PoductAdminDetail",setup(ea){const I=je(),de=he(()=>{const e=ce.state.roles;return Array.isArray(e)&&e.map(n=>typeof n=="string"?n:n.authority).includes("ROLE_ADMIN")});he(()=>{const e=ce.state.roles;return Array.isArray(e)&&e.map(n=>typeof n=="string"?n:n.authority).includes("ROLE_STAFF")});const ae=He(),X=ae.params.id,te=Oe(),z=x(null),a=H({id:null,maSanPham:"",tenSanPham:"",thuongHieu:"",idNhaCungCap:null,trangThaiSanPham:"",idModelSanPham:null,sanPhamChiTiets:[]}),le=x(null),_=x(""),u=x(null),se=x([]),J=x([]),W=x([]),ie=x([]),Q=H({submit:!1}),P=H({}),c=H({visible:!1,images:[],currentIndex:0,currentImage:"",currentName:""}),k=H({show:!1,percent:0,status:"",text:"Đang tải lên"}),pe=[{label:"Đang kinh doanh",value:"ACTIVE"},{label:"Ngừng kinh doanh",value:"DISCONTINUED"}],ge={tenSanPham:[{required:!0,message:"Vui lòng nhập tên sản phẩm",trigger:"blur"},{min:3,max:50,message:"Tên sản phẩm phải từ 3 đến 50 ký tự",trigger:"blur"}],thuongHieu:[{required:!0,message:"Vui lòng nhập thương hiệu",trigger:"blur"},{min:3,max:50,message:"Thương hiệu phải từ 3 đến 50 ký tự",trigger:"blur"}],idNhaCungCaps:[{required:!0,message:"Vui lòng chọn nhà cung cấp",trigger:"change"}],trangThaiSanPham:[{required:!0,message:"Vui lòng chọn trạng thái",trigger:"change"}],idModelSanPham:[{required:!0,message:"Vui lòng chọn model sản phẩm",trigger:"change"}]},K=e=>/^\d{15}$/.test(e),fe=e=>{c.images=e,c.currentIndex=0,c.currentImage=e[0].url,c.currentName=e[0].name,c.visible=!0},oe=(e,n)=>{const o=a.sanPhamChiTiets[u.value].hinhAnhs;c.images=o,c.currentIndex=n,c.currentImage=e,c.currentName=o[n].name,c.visible=!0},Y=e=>{c.currentIndex=e,c.currentImage=c.images[e].url,c.currentName=c.images[e].name},ve=()=>{c.currentIndex<c.images.length-1&&Y(c.currentIndex+1)},Ie=()=>{c.currentIndex>0&&Y(c.currentIndex-1)},re=()=>{c.visible=!1,c.images=[],c.currentIndex=0,c.currentImage="",c.currentName=""},Ce=(e,n,o)=>{try{P[n]=o,I.success("Đã xóa file thành công!")}catch(s){I.error("Đã xảy ra lỗi khi xóa file: "+(s.message||"Vui lòng thử lại.")),console.error("Lỗi khi xóa file:",s)}},_e=async(e,n)=>{try{await ne.confirm("Bạn có chắc chắn muốn xóa hình ảnh này?","Xác nhận xóa",{confirmButtonText:"Xóa",cancelButtonText:"Hủy",type:"warning"}),a.sanPhamChiTiets[e].hinhAnhs.splice(n,1),I.success("Đã xóa hình ảnh thành công!")}catch{}},be=e=>e.length>15?e.substring(0,12)+"...":e,Pe=e=>"~250KB",ue=e=>{const n=["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type),o=e.size/1024/1024<5;return n?o?!0:(I.error("Kích thước ảnh phải nhỏ hơn 5MB!"),!1):(I.error("Chỉ hỗ trợ định dạng JPG, PNG, WEBP!"),!1)},ye=()=>{I.warning("Chỉ được tải lên tối đa 5 ảnh cho mỗi biến thể!")},Te=async(e,n,o)=>{var h,m;if(!ue(e.raw))return;if(a.sanPhamChiTiets[o].hinhAnhs.length>=5){I.warning("Đã đạt giới hạn 5 ảnh cho biến thể này!");return}try{k.show=!0,k.percent=0,k.status="",k.text="Đang tải lên";const g=new FormData;g.append("file",e.raw);const d=setInterval(()=>{k.percent<90&&(k.percent+=10)},200),f=await Xe.post("http://localhost:8080/admin/hinhAnh/upload",g,{headers:{"Content-Type":"multipart/form-data"}});clearInterval(d),k.percent=100,k.status="success",k.text="Tải lên thành công",a.sanPhamChiTiets[o].hinhAnhs.push({name:e.name,url:f.data.url,imagePublicId:f.data.imagePublicId}),I.success(`Tải ảnh ${e.name} thành công!`),setTimeout(()=>{k.show=!1},1500)}catch(g){k.status="exception",k.text="Tải lên thất bại",I.error("Lỗi khi tải ảnh: "+(((m=(h=g.response)==null?void 0:h.data)==null?void 0:m.message)||g.message)),setTimeout(()=>{k.show=!1},2e3)}},ke=(e,n,o)=>{if(o.length>1){I.warning("Bạn chỉ được chọn 1 file. Vui lòng xóa file khác trước khi tiếp tục.");return}P[n]=o,e.raw.size>1024*1024?(I.error("File quá lớn, vui lòng chọn file dưới 1MB."),P[n]=[]):["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.raw.type)||(I.error("Vui lòng chọn file có định dạng .xlsx hoặc .xls."),P[n]=[])},Me=e=>{if(u.value===null||u.value!==e){I.error("Vui lòng chọn biến thể trước khi tải file IMEI!");return}if(!P[e]||P[e].length===0){I.error("Vui lòng chọn file trước khi upload!");return}const n=a.sanPhamChiTiets[e].imeisInput?a.sanPhamChiTiets[e].imeisInput.split(",").filter(s=>s.trim()).length:0,o=n>0?`Bạn đã có ${n} IMEI trong input. File "${P[e][0].name}" sẽ được thêm vào danh sách hiện tại. Tiếp tục?`:`Bạn có chắc muốn upload file "${P[e][0].name}" cho biến thể ${e+1}?`;ne.confirm(o,"Xác nhận",{confirmButtonText:"Upload",cancelButtonText:"Hủy",type:"warning"}).then(()=>{we(e)}).catch(()=>{O.info("Đã hủy upload file.")})},we=async e=>{const n=P[e][0],o=Je.service({text:"Đang đọc file Excel...",background:"rgba(0, 0, 0, 0.7)"});try{const s=new FileReader;s.onload=h=>{try{const m=new Uint8Array(h.target.result),g=tn(m,{type:"array"}),d=g.Sheets[g.SheetNames[0]],f=ln.sheet_to_json(d,{header:1}),V=f[0];if(V&&V[0]!=="soImei")throw new Error('Cột đầu tiên phải có tiêu đề "soImei". Vui lòng sửa file Excel và thử lại.');const p=f.slice(1).map(M=>String(M[0]).trim()).filter(M=>M&&M!=="undefined"&&M!=="null");console.log(`📋 IMEI từ file Excel: ${p.length} mã`);const B=a.sanPhamChiTiets[e].imeisInput||"",y=B?B.split(",").map(M=>M.trim()).filter(M=>M):[];console.log(`✏️ IMEI từ nhập tay: ${y.length} mã`);const F=[...y,...p];console.log(`🔗 Tổng IMEI sau khi kết hợp: ${F.length} mã`);const R=[...new Set(F)],L=F.filter((M,ee,j)=>j.indexOf(M)!==ee);if(L.length>0)throw new Error(`Có ${L.length} IMEI trùng lặp: ${L.slice(0,3).join(", ")}${L.length>3?"...":""}`);const D=R.filter(M=>!K(M));if(D.length>0)throw new Error(`Có ${D.length} giá trị không hợp lệ: ${D.slice(0,3).join(", ")}${D.length>3?"...":""}. IMEI phải là số 15 chữ số.`);const Z=a.sanPhamChiTiets.flatMap((M,ee)=>ee!==e?(M.imeisInput||"").split(",").map(j=>j.trim()).filter(j=>j):[]),t=R.filter(M=>Z.includes(M));if(t.length>0)throw new Error(`Có ${t.length} IMEI trùng lặp với các biến thể khác: ${t.slice(0,3).join(", ")}${t.length>3?"...":""}`);const T=R.length;a.sanPhamChiTiets[e].soLuong=T,a.sanPhamChiTiets[e].imeisInput=R.join(", "),a.sanPhamChiTiets[e].invalidImeis=[],a.sanPhamChiTiets[e].duplicateImeis=[],a.sanPhamChiTiets[e].hasExcelData=!0,P[e]=[];const S=p.length,U=y.length;I.success(`Thành công! Từ file: ${S} IMEI, Từ nhập tay: ${U} IMEI, Tổng cộng: ${T} IMEI cho biến thể ${e+1}`,{timeout:2e3,closeButton:!0}),console.log("✅ Upload thành công:",{fromFile:S,fromManual:U,total:T,variant:e+1})}catch(m){console.error("Lỗi khi xử lý file Excel:",m),a.sanPhamChiTiets[e].invalidImeis=[m.message||"Lỗi không xác định"],I.error(`Lỗi khi đọc file Excel: ${m.message||"Lỗi không xác định"}`,{timeout:2e3,closeButton:!0})}finally{o.close()}},s.onerror=()=>{console.error("Lỗi khi đọc file Excel từ FileReader"),I.error("Lỗi khi đọc file Excel.",{timeout:2e3,closeButton:!0}),o.close()},s.readAsArrayBuffer(n.raw)}catch(s){console.error("Lỗi khi xử lý file IMEI:",s),I.error(`Lỗi khi xử lý file IMEI: ${s.message||"Lỗi không xác định"}`,{timeout:2e3,closeButton:!0}),o.close()}},Se=e=>{ne.confirm("Bạn có chắc muốn xóa toàn bộ IMEI của biến thể này?","Xác nhận",{confirmButtonText:"Xóa",cancelButtonText:"Hủy",type:"warning"}).then(()=>{Ve(e)}).catch(()=>{O.info("Đã hủy xóa IMEI.")})},Ve=e=>{a.sanPhamChiTiets[e].imeisInput="",a.sanPhamChiTiets[e].soLuong=0,a.sanPhamChiTiets[e].isFileUploaded=!1,a.sanPhamChiTiets[e].hasExcelData=!1,a.sanPhamChiTiets[e].invalidImeis=[],a.sanPhamChiTiets[e].duplicateImeis=[],P[e]=[],me(()=>{const n=document.querySelector(`.el-upload[ref="upload-${e}"]`);n&&n.__vue__&&n.__vue__.clearFiles()}),I.success("Đã xóa toàn bộ danh sách IMEI!")},Ee=async e=>{var n,o;try{const s=await We(e);a.id=s.id,a.maSanPham=s.maSanPham||"",a.tenSanPham=s.tenSanPham,a.thuongHieu=s.thuongHieu,a.idNhaCungCaps=s.idNhaCungCaps,a.trangThaiSanPham=s.trangThaiSanPham,a.idModelSanPham=s.idModelSanPham,a.sanPhamChiTiets=s.sanPhamChiTiets.map(h=>{var m,g;return{id:h.id,idMau:h.idMau,idRom:h.idRom,soLuong:h.soLuong,giaBan:h.giaBan,maSanPhamChiTiet:h.maSanPhamChiTiet,imeisInput:((m=h.imeis)==null?void 0:m.map(d=>d.soImei).join(", "))||"",isFileUploaded:!1,hasExcelData:!1,invalidImeis:[],duplicateImeis:[],hinhAnhs:((g=h.hinhAnhs)==null?void 0:g.map(d=>({name:d.url.split("/").pop(),url:d.url,imagePublicId:d.imagePublicId})))||[]}}),console.log("Product data fetched successfully:",s),console.log("Fetched product data:",a.sanPhamChiTiets.map(h=>h.id)),console.log("Fetched product data id model:",a.id),u.value=a.sanPhamChiTiets.length>0?0:null}catch(s){_.value=((o=(n=s.response)==null?void 0:n.data)==null?void 0:o.message)||"Lỗi khi tải chi tiết sản phẩm",console.error("Error fetching product:",s),O.error(_.value)}},$e=async()=>{var e,n;try{const o=await Promise.all([Qe(),Ye(),Ze(),en()]);se.value=o[0],J.value=o[1],W.value=o[2],ie.value=o[3]}catch(o){_.value=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"Lỗi khi tải danh mục",console.error("Error fetching danh muc:",o),O.error(_.value)}},Be=an.debounce(e=>{if(e==null||!a.sanPhamChiTiets[e]){I.error("Vui lòng chọn một biến thể trước khi nhập IMEI");return}const n=a.sanPhamChiTiets[e].imeisInput||"";a.sanPhamChiTiets[e].hasExcelData||(a.sanPhamChiTiets[e].isFileUploaded=!1);const o=n.split(",").map(p=>p.trim()).filter(p=>p),s=[...new Set(o)],h=o.filter((p,B,y)=>y.indexOf(p)!==B),m=s.filter(K),g=s.filter(p=>!K(p)),d=a.sanPhamChiTiets.flatMap((p,B)=>B!==e&&p.imeisInput?p.imeisInput.split(",").map(y=>y.trim()).filter(y=>y):[]),f=m.filter(p=>d.includes(p)),V=m.filter(p=>!f.includes(p)).length;a.sanPhamChiTiets[e].soLuong=V,a.sanPhamChiTiets[e].invalidImeis=g,a.sanPhamChiTiets[e].duplicateImeis=[...new Set([...h,...f])],h.length>0&&I.error(`Biến thể ${e+1}: Có ${h.length} IMEI trùng lặp trong cùng biến thể`),f.length>0&&I.error(`Biến thể ${e+1}: Có ${f.length} IMEI trùng lặp với các biến thể khác`),console.log(`📊 Cập nhật số lượng biến thể ${e+1}:`,{totalInput:o.length,uniqueImeis:s.length,validImeis:m.length,finalCount:V,duplicateInSame:h.length,duplicateWithOthers:f.length,invalid:g.length})},100),xe=(e,n,o)=>{const s=a.sanPhamChiTiets.indexOf(e);u.value=s,P[s]=P[s]||[],a.sanPhamChiTiets[s].isFileUploaded||(P[s]=[],me(()=>{const h=document.querySelector(`.el-upload[ref="upload-${s}"]`);h&&h.__vue__&&h.__vue__.clearFiles()}))},Le=({rowIndex:e})=>(console.log("Row index:",e,"Selected index:",u.value),u.value===e?"current-row":""),Ae=e=>{var n;return((n=J.value.find(o=>o.id===e))==null?void 0:n.tenMau)||"Không rõ"},Ne=e=>{var n;return((n=W.value.find(o=>o.id===e))==null?void 0:n.dungLuong)||"Không rõ"},Fe=e=>e+1,Re=()=>{let e=!1;_.value="",a.tenSanPham?a.thuongHieu?a.idNhaCungCaps?a.trangThaiSanPham?a.idModelSanPham?a.sanPhamChiTiets.length||(_.value="Vui lòng thêm ít nhất một biến thể sản phẩm",e=!0):(_.value="Vui lòng chọn model sản phẩm",e=!0):(_.value="Vui lòng chọn trạng thái",e=!0):(_.value="Vui lòng chọn nhà cung cấp",e=!0):(_.value="Vui lòng nhập thương hiệu",e=!0):(_.value="Vui lòng nhập tên sản phẩm",e=!0);const n=new Set;return a.sanPhamChiTiets.forEach((o,s)=>{o.idMau?o.idRom?(!o.giaBan||o.giaBan<1e3)&&(_.value=`Biến thể ${s+1}: Giá bán phải lớn hơn hoặc bằng 1000 VND`,e=!0):(_.value=`Biến thể ${s+1}: Vui lòng chọn ROM`,e=!0):(_.value=`Biến thể ${s+1}: Vui lòng chọn màu sắc`,e=!0);const h=o.imeisInput.split(",").map(m=>m.trim()).filter(m=>m);if(h.length!==0){const m=h.filter(f=>!K(f));m.length>0&&(_.value=`Biến thể ${s+1}: Có ${m.length} IMEI không hợp lệ: ${m.slice(0,3).join(", ")}${m.length>3?"...":""}`,e=!0);const g=h.filter((f,V,p)=>p.indexOf(f)!==V);g.length>0&&(_.value=`Biến thể ${s+1}: Có ${g.length} IMEI trùng lặp trong cùng biến thể: ${g.slice(0,3).join(", ")}${g.length>3?"...":""}`,e=!0);const d=h.filter(f=>n.has(f));d.length>0?(_.value=`Biến thể ${s+1}: Có ${d.length} IMEI trùng lặp với các biến thể khác: ${d.slice(0,3).join(", ")}${d.length>3?"...":""}`,e=!0):h.forEach(f=>n.add(f))}}),!e},De=async()=>{var e,n,o,s;Q.submit=!0;try{if(console.log("🟡 Bắt đầu submit form..."),!z.value)throw console.error("❌ ID sản phẩm không hợp lệ"),new Error("ID sản phẩm không hợp lệ");console.log("🧾 ID sản phẩm:",z.value);const h=await le.value.validate();if(console.log("✅ Form Element Plus hợp lệ:",h),!h){I.error("Vui lòng kiểm tra lại dữ liệu nhập vào");return}const m=Re();if(console.log("✅ Form logic validate hợp lệ:",m),!m){I.error(_.value);return}const g={id:X,maSanPham:a.maSanPham,tenSanPham:a.tenSanPham,thuongHieu:a.thuongHieu,idNhaCungCaps:a.idNhaCungCaps,trangThaiSanPham:a.trangThaiSanPham,idModelSanPham:a.idModelSanPham,sanPhamChiTiets:a.sanPhamChiTiets.map((d,f)=>{const V=d.imeisInput?d.imeisInput.split(",").map(p=>p.trim()).filter(p=>p):[];return console.log(`📦 Biến thể ${f+1}:`,{id:d.id||null,idMau:d.idMau,idRom:d.idRom,soLuong:d.soLuong,imeiCount:V.length,imeis:V}),{id:d.id||null,maSanPhamChiTiet:d.maSanPhamChiTiet,idMau:d.idMau,idRom:d.idRom,soLuong:d.soLuong,giaBan:d.giaBan,imeis:V.map(p=>({soImei:p,trangThaiImei:"AVAILABLE"})),hinhAnhs:d.hinhAnhs.map(p=>({url:p.url,imagePublicId:p.imagePublicId}))}})};console.log("🔍 Kiểm tra payload trước khi gửi:",g),console.log("🔍 Kiểm tra ID sản phẩm trước khi gửi:",X),console.log("📤 Payload gửi lên:",JSON.stringify(g,null,2)),await nn(X,g),console.log("✅ Cập nhật thành công"),I.success("Cập nhật sản phẩm thành công!"),te.push("/admin/products")}catch(h){const m=((n=(e=h.response)==null?void 0:e.data)==null?void 0:n.message)||h.message||"Lỗi khi cập nhật sản phẩm";_.value=m,console.error("❌ Submit error:",{error:m,response:(o=h.response)==null?void 0:o.data,stack:h.stack}),((s=h.response)==null?void 0:s.status)===400&&m.includes("IMEI trùng lặp")?I.error("Không thể cập nhật: Có IMEI trùng lặp trong dữ liệu."):I.error(m)}finally{Q.submit=!1,console.log("🔚 Kết thúc submit")}};return qe(()=>{const e=ae.params.id;if(!e||isNaN(parseInt(e))){O.error("ID sản phẩm không hợp lệ"),te.push("/admin/products");return}z.value=parseInt(e),Ee(z.value),$e()}),(e,n)=>{const o=w("el-input"),s=w("el-form-item"),h=w("el-col"),m=w("el-row"),g=w("el-option"),d=w("el-select"),f=w("el-table-column"),V=w("el-tag"),p=w("el-table"),B=w("el-input-number"),y=w("el-button"),F=w("el-upload"),R=w("el-progress"),L=w("el-alert"),D=w("el-form"),Z=w("el-dialog");return v(),C("div",sn,[n[29]||(n[29]=i("div",{class:"form-header"},[i("h2",null,"Cập nhật sản phẩm"),i("div",{class:"header-divider"})],-1)),l(D,{model:a,ref_key:"sanPhamForm",ref:le,"label-width":"120px",rules:ge,class:"professional-form"},{default:r(()=>[i("div",on,[n[15]||(n[15]=i("h3",{class:"section-title"},"Thông tin cơ bản",-1)),l(m,{gutter:20},{default:r(()=>[l(h,{span:12},{default:r(()=>[l(s,{label:"Tên sản phẩm",prop:"tenSanPham"},{default:r(()=>[l(o,{modelValue:a.tenSanPham,"onUpdate:modelValue":n[0]||(n[0]=t=>a.tenSanPham=t),disabled:"",placeholder:"Nhập tên sản phẩm"},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:r(()=>[l(s,{label:"Thương hiệu",prop:"thuongHieu"},{default:r(()=>[l(o,{modelValue:a.thuongHieu,"onUpdate:modelValue":n[1]||(n[1]=t=>a.thuongHieu=t),disabled:"",placeholder:"Nhập thương hiệu"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:r(()=>[l(h,{span:12},{default:r(()=>[l(s,{label:"Nhà cung cấp",prop:"idNhaCungCap"},{default:r(()=>[l(d,{modelValue:a.idNhaCungCaps,"onUpdate:modelValue":n[2]||(n[2]=t=>a.idNhaCungCaps=t),multiple:"",disabled:"",placeholder:"Chọn nhà cung cấp",style:{width:"100%"}},{default:r(()=>[(v(!0),C(A,null,N(se.value,t=>(v(),q(g,{key:t.id,label:t.tenNhaCungCap,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:r(()=>[l(s,{label:"Trạng thái",prop:"trangThaiSanPham"},{default:r(()=>[l(d,{modelValue:a.trangThaiSanPham,"onUpdate:modelValue":n[3]||(n[3]=t=>a.trangThaiSanPham=t),placeholder:"Chọn trạng thái",style:{width:"100%"}},{default:r(()=>[(v(),C(A,null,N(pe,t=>l(g,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:r(()=>[l(h,{span:12},{default:r(()=>[l(s,{label:"Model sản phẩm",prop:"idModelSanPham"},{default:r(()=>[l(d,{modelValue:a.idModelSanPham,"onUpdate:modelValue":n[4]||(n[4]=t=>a.idModelSanPham=t),disabled:"",placeholder:"Chọn model sản phẩm",style:{width:"100%"}},{default:r(()=>[(v(!0),C(A,null,N(ie.value,t=>(v(),q(g,{key:t.id,label:t.tenModel,value:t.idModelSanPham},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),i("div",rn,[n[17]||(n[17]=i("h3",{class:"section-title"},"Danh sách biến thể sản phẩm",-1)),i("div",un,[l(p,{data:a.sanPhamChiTiets,class:"professional-table",border:"",onRowClick:xe,"row-class-name":Le},{default:r(()=>[l(f,{type:"index",label:"STT",width:"80",index:Fe}),l(f,{label:"Mã sản phẩm chi tiết",sortable:"",prop:"maSanPhamChiTiet",width:"180"},{default:r(t=>[i("span",hn,b(t.row.maSanPhamChiTiet),1)]),_:1}),l(f,{label:"Màu sắc",prop:"idMau"},{default:r(({row:t})=>[i("span",cn,b(Ae(t.idMau)),1)]),_:1}),l(f,{label:"ROM",prop:"idRom"},{default:r(({row:t})=>[i("span",mn,b(Ne(t.idRom)),1)]),_:1}),l(f,{prop:"soLuong",label:"Số lượng"},{default:r(({row:t})=>[l(V,{type:"info",size:"small"},{default:r(()=>[E(b(t.soLuong),1)]),_:2},1024)]),_:1}),l(f,{prop:"giaBan",label:"Giá bán"},{default:r(({row:t})=>[i("span",dn,b(new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.giaBan)),1)]),_:1}),l(f,{label:"Hình ảnh",width:"120"},{default:r(({row:t})=>[i("div",pn,[t.hinhAnhs&&t.hinhAnhs.length>0?(v(),C("div",gn,[i("img",{src:t.hinhAnhs[0].url,alt:t.hinhAnhs[0].name,class:"table-image",onClick:T=>fe(t.hinhAnhs)},null,8,fn),t.hinhAnhs.length>1?(v(),C("span",vn,"+"+b(t.hinhAnhs.length-1),1)):$("",!0)])):(v(),C("div",In,n[16]||(n[16]=[i("i",{class:"el-icon-picture-outline"},null,-1),i("span",null,"Chưa có ảnh",-1)])))])]),_:1})]),_:1},8,["data"])])]),u.value!==null?(v(),C("div",Cn,[i("h4",_n,[n[18]||(n[18]=i("i",{class:"el-icon-edit"},null,-1)),E(" Chỉnh sửa biến thể "+b(u.value+1),1)]),l(m,{gutter:20},{default:r(()=>[l(h,{span:8},{default:r(()=>[l(s,{label:"Màu SPCT",prop:`sanPhamChiTiets.${u.value}.maSanPhamChiTiet`},{default:r(()=>[l(o,{modelValue:a.sanPhamChiTiets[u.value].maSanPhamChiTiet,"onUpdate:modelValue":n[5]||(n[5]=t=>a.sanPhamChiTiets[u.value].maSanPhamChiTiet=t),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["prop"])]),_:1}),l(h,{span:8},{default:r(()=>[l(s,{label:"Màu sắc",prop:`sanPhamChiTiets.${u.value}.idMau`,rules:[{required:!0,message:"Vui lòng chọn màu sắc"}]},{default:r(()=>[l(d,{modelValue:a.sanPhamChiTiets[u.value].idMau,"onUpdate:modelValue":n[6]||(n[6]=t=>a.sanPhamChiTiets[u.value].idMau=t),placeholder:"Chọn màu sắc",style:{width:"100%"}},{default:r(()=>[(v(!0),C(A,null,N(J.value,t=>(v(),q(g,{key:t.id,label:t.tenMau,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["prop"])]),_:1}),l(h,{span:8},{default:r(()=>[l(s,{label:"ROM",prop:`sanPhamChiTiets.${u.value}.idRom`,rules:[{required:!0,message:"Vui lòng chọn ROM"}]},{default:r(()=>[l(d,{modelValue:a.sanPhamChiTiets[u.value].idRom,"onUpdate:modelValue":n[7]||(n[7]=t=>a.sanPhamChiTiets[u.value].idRom=t),placeholder:"Chọn ROM",style:{width:"100%"}},{default:r(()=>[(v(!0),C(A,null,N(W.value,t=>(v(),q(g,{key:t.id,label:t.dungLuong,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["prop"])]),_:1}),l(h,{span:8},{default:r(()=>[l(s,{label:"Giá bán",prop:`sanPhamChiTiets.${u.value}.giaBan`,rules:[{required:!0,message:"Vui lòng nhập giá bán",type:"number"}]},{default:r(()=>[l(B,{modelValue:a.sanPhamChiTiets[u.value].giaBan,"onUpdate:modelValue":n[8]||(n[8]=t=>a.sanPhamChiTiets[u.value].giaBan=t),min:1e3,precision:0,step:1e6,style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["prop"])]),_:1})]),_:1}),l(s,{label:"IMEI",prop:`sanPhamChiTiets.${u.value}.imeisInput`,rules:[{required:!0,message:"Vui lòng nhập IMEI"}]},{default:r(()=>{var t,T;return[l(o,{type:"textarea",modelValue:a.sanPhamChiTiets[u.value].imeisInput,"onUpdate:modelValue":n[9]||(n[9]=S=>a.sanPhamChiTiets[u.value].imeisInput=S),placeholder:"Nhập danh sách IMEI, phân tách bởi dấu phẩy (có thể kết hợp với file Excel)",onInput:n[10]||(n[10]=S=>G(Be)(u.value))},null,8,["modelValue"]),i("div",bn,[l(F,{ref:`upload-${u.value}`,"file-list":P[u.value]||[],"auto-upload":!1,"on-change":(S,U)=>ke(S,u.value,U),"on-remove":(S,U)=>Ce(S,u.value,U),"on-exceed":()=>G(I).warning("Bạn chỉ được chọn 1 file. Vui lòng xóa file khác trước khi tiếp tục."),limit:1,accept:".xlsx,.xls,.txt","list-type":"text",class:"custom-upload"},{trigger:r(()=>[l(y,{type:"default",plain:"",class:"choose-file-btn"},{default:r(()=>n[19]||(n[19]=[i("i",{class:"el-icon-upload"},null,-1),E(" Chọn file Excel ")])),_:1})]),default:r(()=>[P[u.value]&&P[u.value].length>0?(v(),C("span",Pn,b(P[u.value][0].name),1)):(v(),C("span",yn,"Chưa chọn file"))]),_:1},8,["file-list","on-change","on-remove","on-exceed"]),l(y,{type:"primary",disabled:!(P[u.value]&&P[u.value].length>0),onClick:n[11]||(n[11]=S=>Me(u.value)),class:"upload-btn"},{default:r(()=>[n[20]||(n[20]=i("i",{class:"el-icon-upload"},null,-1)),E(" "+b(a.sanPhamChiTiets[u.value].imeisInput?"Thêm từ Excel":"Upload"),1)]),_:1},8,["disabled"]),l(y,{type:"warning",plain:"",onClick:n[12]||(n[12]=S=>Se(u.value)),class:"clear-btn"},{default:r(()=>n[21]||(n[21]=[i("i",{class:"el-icon-delete"},null,-1),E(" Xóa tất cả IMEI ")])),_:1})]),i("div",Tn,[i("span",kn,"Tổng số IMEI: "+b(a.sanPhamChiTiets[u.value].soLuong),1),a.sanPhamChiTiets[u.value].hasExcelData?(v(),C("span",Mn,n[22]||(n[22]=[i("i",{class:"el-icon-document"},null,-1),E(" (Có dữ liệu từ Excel) ")]))):$("",!0),(t=a.sanPhamChiTiets[u.value].invalidImeis)!=null&&t.length?(v(),C("span",wn," ("+b(a.sanPhamChiTiets[u.value].invalidImeis.length)+" IMEI không hợp lệ: "+b(a.sanPhamChiTiets[u.value].invalidImeis.join(", "))+") ",1)):$("",!0),(T=a.sanPhamChiTiets[u.value].duplicateImeis)!=null&&T.length?(v(),C("span",Sn," ("+b(a.sanPhamChiTiets[u.value].duplicateImeis.length)+" IMEI trùng lặp: "+b(a.sanPhamChiTiets[u.value].duplicateImeis.join(", "))+") ",1)):$("",!0)])]}),_:1},8,["prop"]),l(s,{label:"Hình ảnh sản phẩm"},{default:r(()=>[i("div",Vn,[a.sanPhamChiTiets[u.value].hinhAnhs.length>0?(v(),C("div",En,[i("h5",$n," Hình ảnh hiện tại ("+b(a.sanPhamChiTiets[u.value].hinhAnhs.length)+"/5) ",1),i("div",Bn,[(v(!0),C(A,null,N(a.sanPhamChiTiets[u.value].hinhAnhs,(t,T)=>(v(),C("div",{key:T,class:"image-item"},[i("div",xn,[i("img",{src:t.url,alt:t.name,class:"preview-image",onClick:S=>oe(t.url,T)},null,8,Ln),i("div",An,[l(y,{type:"primary",size:"small",icon:G(ze),circle:"",class:"overlay-btn view-btn",onClick:S=>oe(t.url,T)},null,8,["icon","onClick"]),l(y,{type:"danger",size:"small",icon:G(Ke),circle:"",class:"overlay-btn delete-btn",onClick:S=>_e(u.value,T)},null,8,["icon","onClick"])]),i("div",Nn,[i("span",Fn,b(be(t.name)),1),i("span",Rn,b(Pe(t)),1)])])]))),128))])])):$("",!0),i("div",Dn,[l(F,{"wool-upload":"",ref:"imageUpload","file-list":[],"on-change":(t,T)=>Te(t,T,u.value),"on-exceed":ye,"before-upload":ue,"auto-upload":!1,accept:"image/jpeg,image/png,image/webp,image/jpg",limit:5,multiple:"",drag:"",class:"image-uploader"},{default:r(()=>n[23]||(n[23]=[i("div",{class:"upload-content"},[i("i",{class:"el-icon-upload upload-icon"}),i("div",{class:"upload-text"},[i("p",{class:"upload-title"},[E(" Kéo thả hoặc "),i("em",null,"click để tải ảnh")]),i("p",{class:"upload-subtitle"}," Hỗ trợ: JPG, PNG, WEBP (tối đa 5 ảnh, mỗi ảnh < 5MB) ")])],-1)])),_:1},8,["on-change"]),k.show?(v(),C("div",Un,[l(R,{percentage:k.percent,status:k.status,"stroke-width":8},{default:r(({percentage:t})=>[i("span",jn,b(k.text)+" "+b(t)+"%",1)]),_:1},8,["percentage","status"])])):$("",!0)])])]),_:1})])):(v(),C("div",Hn,[l(L,{title:"Vui lòng chọn một biến thể để chỉnh sửa",type:"info","show-icon":"",class:"selection-alert"})])),de.value?(v(),C("div",On,[l(y,{type:"success",size:"large",loading:Q.submit,onClick:De,class:"action-btn primary-btn"},{default:r(()=>n[24]||(n[24]=[i("i",{class:"el-icon-check"},null,-1),E(" Cập nhật sản phẩm ")])),_:1},8,["loading"]),l(y,{type:"default",size:"large",onClick:n[13]||(n[13]=t=>e.$router.push("/admin/products")),class:"action-btn secondary-btn"},{default:r(()=>n[25]||(n[25]=[i("i",{class:"el-icon-close"},null,-1),E(" Hủy ")])),_:1})])):$("",!0)]),_:1},8,["model"]),_.value?(v(),q(L,{key:0,title:_.value,type:"error","show-icon":"",class:"error-alert"},null,8,["title"])):$("",!0),l(Z,{modelValue:c.visible,"onUpdate:modelValue":n[14]||(n[14]=t=>c.visible=t),title:"Xem trước hình ảnh",width:"80%","before-close":re,class:"image-preview-dialog"},{footer:r(()=>[i("div",Wn,[i("span",Qn,b(c.currentIndex+1)+" / "+b(c.images.length),1),i("div",Yn,[l(y,{onClick:Ie,disabled:c.currentIndex===0},{default:r(()=>n[26]||(n[26]=[i("i",{class:"el-icon-arrow-left"},null,-1),E(" Trước ")])),_:1},8,["disabled"]),l(y,{onClick:ve,disabled:c.currentIndex===c.images.length-1},{default:r(()=>n[27]||(n[27]=[E(" Sau "),i("i",{class:"el-icon-arrow-right"},null,-1)])),_:1},8,["disabled"]),l(y,{type:"primary",onClick:re},{default:r(()=>n[28]||(n[28]=[E("Đóng")])),_:1})])])]),default:r(()=>[i("div",qn,[i("div",zn,[i("img",{src:c.currentImage,alt:c.currentName,class:"preview-main-image"},null,8,Kn)]),c.images.length>1?(v(),C("div",Gn,[(v(!0),C(A,null,N(c.images,(t,T)=>(v(),C("div",{key:T,class:Ge(["thumbnail-item",{active:T===c.currentIndex}]),onClick:S=>Y(T)},[i("img",{src:t.url,alt:t.name,class:"thumbnail-image"},null,8,Jn)],10,Xn))),128))])):$("",!0)])]),_:1},8,["modelValue"])])}}},sa=Ue(Zn,[["__scopeId","data-v-0b1a031f"]]);export{sa as default};
