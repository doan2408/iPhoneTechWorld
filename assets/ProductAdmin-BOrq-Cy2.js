import{_ as ce,r as p,T as re,c as O,a1 as U,w as ue,o as de,a as i,b as P,d as r,e as s,f as e,i as a,j as o,ak as R,B as v,k as N,h as u,t as y,al as he,s as F,F as K,m as q,am as X,L as pe,an as me,M as _e,a0 as ge,v as fe,ao as ve,a6 as ye,x as Te,E as k,O as be,N as j,a9 as ke,ap as Le,aq as Se,R as Ce}from"./index-I05jmhuU.js";import{g as Ie,c as we,d as Ae,e as Oe}from"./ProductAdminService-BjtVeFMT.js";import{l as Pe}from"./lodash-B9bUVSq8.js";const xe={class:"page-wrapper"},Ne={class:"page-header"},Ee={class:"header-content"},Ve={class:"header-left"},De={class:"header-right"},Me={class:"container mt-4"},Be={class:"filter-title"},ze={key:0,class:"mb-3 action-section"},Ue={class:"page-title"},Re={class:"image-container"},Fe={class:"image-error"},Ke={class:"product-name"},qe={class:"action-buttons-horizontal"},Xe={class:"pagination-fixed"},je={class:"d-flex justify-content-center align-items-center gap-3"},w=5,Ge={__name:"ProductAdmin",setup(He){const E=p([]),T=p(!1),m=p(""),d=p(1),G=p(1),b=p(0),g=p(""),V=p([]),D=p([]),c=re({idLoai:null,trangThai:""}),H=async()=>{try{const n=await Ae();V.value=n||[]}catch(n){m.value=n.message||"Lỗi khi tải loại sản phẩm",k.error(m.value)}},Y=async()=>{try{const n=await we();D.value=n||[],console.log("111111111111",n)}catch(n){m.value=n.message||"Lỗi khi tải trạng thái sản phẩm",k.error(m.value)}},L=async()=>{if(!T.value)try{T.value=!0,console.log("Đang tải sản phẩm, trang:",d.value,"Tìm kiếm:",g.value,"Loại:",c.idLoai,"Trạng thái:",c.trangThai);const n=await Ie(d.value-1,w,g.value,c.idLoai,c.trangThai,c.maXuatXu);console.log("Đang tải sản phẩm, trang22222:",d.value,"Tìm kiếm:",g.value,"Loại:",c.idLoai,"Trạng thái:",c.trangThai),console.log("Dữ liệu trả về từ API:",n),E.value=n.content||[],G.value=n.totalPages||1,b.value=n.totalElements||0}catch(n){m.value=n.message||"Lỗi khi tải sản phẩm",k.error(m.value)}finally{T.value=!1}},S=Pe.debounce(async()=>{d.value=1,await L()},300),$=async()=>{g.value="",c.idLoai=null,c.trangThai="",d.value=1,await L()},Q=async n=>{if(console.log("ID sản phẩm:",n),!n){k.error("ID sản phẩm không hợp lệ");return}try{await Ce.confirm("Bạn có chắc chắn muốn kinh doanh lại sản phẩm này?","Xác nhận",{confirmButtonText:"Kinh doanh lại",cancelButtonText:"Hủy",type:"warning"}),await Oe(n),k.success("Sản phẩm kinh doanh lại !!!"),await L()}catch(l){console.error("Lỗi khi kinh doanh lại:",l),l!=="cancel"&&k.error("Lỗi khi kinh doanh lại sản phẩm: "+(l.message||"Không rõ"))}},J=n=>({ACTIVE:"success",DISCONTINUED:"danger",COMING_SOON:"warning",TEMPORARILY_UNAVAILABLE:"info",OUT_OF_STOCK:"danger"})[n]||"info",W=n=>({ACTIVE:Se,DISCONTINUED:Le,COMING_SOON:ke,TEMPORARILY_UNAVAILABLE:j,OUT_OF_STOCK:be})[n]||j;O(()=>b.value===0?0:(d.value-1)*w+1),O(()=>Math.min(d.value*w,b.value));const Z=n=>(d.value-1)*w+n+1,ee=n=>{d.value=n,L()},ae={ACTIVE:"Đang kinh doanh",DISCONTINUED:"Ngừng kinh doanh",COMING_SOON:"Sắp ra mắt",TEMPORARILY_UNAVAILABLE:"Tạm ngừng bán",OUT_OF_STOCK:"Hết hàng"},M=O(()=>{const n=U.state.roles;return Array.isArray(n)&&n.map(l=>typeof l=="string"?l:l.authority).includes("ROLE_ADMIN")});return O(()=>{const n=U.state.roles;return Array.isArray(n)&&n.map(l=>typeof l=="string"?l:l.authority).includes("ROLE_STAFF")}),ue(g,()=>{S()}),de(async()=>{await Promise.all([Y(),H(),L()])}),(n,l)=>{const h=i("el-icon"),C=i("el-tag"),te=i("el-input"),I=i("el-col"),B=i("el-option"),z=i("el-select"),f=i("el-button"),ne=i("el-row"),A=i("router-link"),_=i("el-table-column"),le=i("el-image"),x=i("el-tooltip"),se=i("el-table"),oe=i("el-pagination"),ie=i("el-alert");return r(),P("div",xe,[s("div",Ne,[s("div",Ee,[s("div",Ve,[e(h,{class:"header-icon"},{default:a(()=>[e(o(R))]),_:1}),l[3]||(l[3]=s("div",{class:"header-text"},[s("h1",{class:"header-title"},"Quản lý sản phẩm"),s("p",{class:"header-subtitle"},"Danh sách và quản lý tất cả sản phẩm")],-1))]),s("div",De,[b.value>0?(r(),v(C,{key:0,type:"success",size:"large"},{default:a(()=>[u(y(b.value)+" sản phẩm ",1)]),_:1})):N("",!0)])])]),s("div",Me,[s("h2",Be,[e(h,{class:"title-icon"},{default:a(()=>[e(o(he))]),_:1}),l[4]||(l[4]=u(" Bộ lọc sản phẩm "))]),e(ne,{gutter:20,class:"mb-4 justify-content-center"},{default:a(()=>[e(I,{span:6},{default:a(()=>[e(te,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=t=>g.value=t),placeholder:"Tìm kiếm sản phẩm",clearable:"",onInput:o(S),class:"search-input"},{prefix:a(()=>[e(h,{class:"search-icon"},{default:a(()=>[e(o(F))]),_:1})]),_:1},8,["modelValue","onInput"])]),_:1}),e(I,{span:6},{default:a(()=>[e(z,{modelValue:c.idLoai,"onUpdate:modelValue":l[1]||(l[1]=t=>c.idLoai=t),placeholder:"Lọc theo loại",clearable:"",onChange:o(S),class:"filter-select"},{default:a(()=>[(r(!0),P(K,null,q(V.value,t=>(r(),v(B,{key:t.id,label:t.tenLoai,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),e(I,{span:6},{default:a(()=>[e(z,{modelValue:c.trangThai,"onUpdate:modelValue":l[2]||(l[2]=t=>c.trangThai=t),placeholder:"Lọc theo trạng thái",clearable:"",onChange:o(S),class:"filter-select"},{default:a(()=>[(r(!0),P(K,null,q(D.value,t=>(r(),v(B,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),e(I,{span:3},{default:a(()=>[e(f,{type:"primary",size:"default",class:"w-100 search-btn",onClick:o(S),loading:T.value},{default:a(()=>[e(h,null,{default:a(()=>[e(o(F))]),_:1}),l[5]||(l[5]=u(" Tìm kiếm "))]),_:1},8,["onClick","loading"])]),_:1}),e(I,{span:3},{default:a(()=>[e(f,{type:"default",size:"default",class:"w-100 reset-btn",onClick:$,disabled:T.value},{default:a(()=>[e(h,null,{default:a(()=>[e(o(X))]),_:1}),l[6]||(l[6]=u(" Đặt lại "))]),_:1},8,["disabled"])]),_:1})]),_:1}),M.value?(r(),P("div",ze,[e(A,{to:"/admin/products/create",class:"el-link--success"},{default:a(()=>[e(f,{type:"success",size:"default",class:"action-btn"},{default:a(()=>[e(h,null,{default:a(()=>[e(o(pe))]),_:1}),l[7]||(l[7]=u(" Thêm sản phẩm mới "))]),_:1})]),_:1}),e(A,{to:"/admin/products/create/modelSanPham",class:"el-link--success"},{default:a(()=>[e(f,{type:"success",size:"default",plain:"",class:"action-btn"},{default:a(()=>[e(h,null,{default:a(()=>[e(o(me))]),_:1}),l[8]||(l[8]=u(" Thêm mẫu sản phẩm "))]),_:1})]),_:1})])):N("",!0),s("h2",Ue,[e(h,{class:"title-icon"},{default:a(()=>[e(o(R))]),_:1}),l[9]||(l[9]=u(" Danh sách sản phẩm "))]),e(se,{data:E.value,style:{width:"100%"},border:"",stripe:"",loading:T.value,class:"beautiful-table","empty-text":"Không có dữ liệu"},{default:a(()=>[e(_,{type:"index",index:Z,label:"STT",width:"80",align:"center"}),e(_,{label:"Hình ảnh",width:"120",align:"center"},{default:a(({row:t})=>[s("div",Re,[e(le,{src:t.url||"/placeholder.svg?height=60&width=60",alt:"Ảnh sản phẩm",class:"product-image",fit:"cover","preview-src-list":[t.url||"/placeholder.svg?height=60&width=60"],"preview-teleported":""},{error:a(()=>[s("div",Fe,[e(h,null,{default:a(()=>[e(o(_e))]),_:1})])]),_:2},1032,["src","preview-src-list"])])]),_:1}),e(_,{prop:"maSanPham",label:"Mã sản phẩm"},{default:a(({row:t})=>[e(C,{type:"info",effect:"light",class:"code-tag"},{default:a(()=>[u(y(t.maSanPham),1)]),_:2},1024)]),_:1}),e(_,{prop:"tenSanPham",label:"Tên sản phẩm","show-overflow-tooltip":""},{default:a(({row:t})=>[s("span",Ke,y(t.tenSanPham)+" - "+y(t.maXuatXu),1)]),_:1}),e(_,{prop:"tenLoai",label:"Tên loại"},{default:a(({row:t})=>[e(C,{size:"small",effect:"light",class:"category-tag"},{default:a(()=>[u(y(t.tenLoai),1)]),_:2},1024)]),_:1}),e(_,{prop:"soLuong",label:"Số lượng",align:"center"},{default:a(({row:t})=>[e(C,{type:t.soLuong>10?"success":t.soLuong>0?"warning":"danger",effect:"light",class:"quantity-tag"},{default:a(()=>[u(y(t.soLuong),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"Trạng thái",align:"center"},{default:a(({row:t})=>[e(C,{type:J(t.trangThaiSanPham),effect:"light",class:"status-tag"},{default:a(()=>[e(h,{class:"status-icon"},{default:a(()=>[(r(),v(ge(W(t.trangThaiSanPham))))]),_:2},1024),u(" "+y(ae[t.trangThaiSanPham]||"Không rõ"),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"Thao tác",width:"180",align:"center"},{default:a(({row:t})=>[s("div",qe,[e(A,{to:`/admin/products/view/${t.id}`},{default:a(()=>[e(x,{content:"Xem chi tiết",placement:"top"},{default:a(()=>[e(f,{size:"small",type:"info",icon:o(ve),class:"action-btn-square"},null,8,["icon"])]),_:1})]),_:2},1032,["to"]),t.trangThaiSanPham==="ACTIVE"?fe((r(),v(A,{key:0,to:`/admin/products/${t.id}`},{default:a(()=>[e(x,{content:"Chỉnh sửa",placement:"top"},{default:a(()=>[e(f,{size:"small",type:"primary",icon:o(ye),class:"action-btn-square"},null,8,["icon"])]),_:1})]),_:2},1032,["to"])),[[Te,M.value]]):(r(),v(x,{key:1,content:"Kinh doanh lại",placement:"top"},{default:a(()=>[e(f,{size:"small",type:"success",icon:o(X),class:"action-btn-square",onClick:Ye=>Q(t.id)},null,8,["icon","onClick"])]),_:2},1024))])]),_:1})]),_:1},8,["data","loading"]),s("div",Xe,[s("div",je,[e(oe,{background:"",layout:"prev, pager, next","page-size":w,"current-page":d.value,total:b.value,"pager-count":7,"prev-text":"< Trước","next-text":"Sau >",onCurrentChange:ee,class:"simple-pagination"},null,8,["current-page","total"])])]),m.value?(r(),v(ie,{key:1,title:m.value,type:"error","show-icon":"",class:"mt-3 error-alert",closable:""},null,8,["title"])):N("",!0)])])}}},We=ce(Ge,[["__scopeId","data-v-df47cd8d"]]);export{We as default};
