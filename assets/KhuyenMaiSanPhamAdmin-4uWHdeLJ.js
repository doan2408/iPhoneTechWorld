import{_ as oa,u as ua,r,c as F,a1 as ra,w as le,o as ca,J as da,a as g,a2 as ha,b as ma,d as z,e as s,f as t,B as x,k as me,i as n,h as d,j as k,L as ga,s as we,am as pa,v as ne,t as p,aN as De,ao as va,a6 as fa,l as ya,E as _,R as Ta,aO as Ce,G as _a}from"./index-I05jmhuU.js";import{g as ba,b as wa,a as Da,c as Se,d as Ca,u as Sa,e as ka,f as Ma}from"./KhuyenMaiSanPhamService-B9L5aGWt.js";const Pa={class:"promotion-container"},Va={class:"page-header"},za={class:"header-content"},Ka={class:"filters-content"},La={class:"filter-group"},xa={class:"filter-item"},Ea={class:"filter-item"},Ua={class:"filter-item"},Ya={class:"filter-item"},Aa={class:"filter-actions"},Ba={class:"row-index"},Ia={class:"code-cell"},Ha={class:"name-cell"},Na={class:"promotion-name"},Ra={class:"value-cell"},$a={class:"discount-percent"},Oa={class:"date-range"},Ga={class:"date-item"},Fa={class:"date-item"},Xa={class:"action-buttons"},qa={class:"pagination-wrapper"},ja={class:"dialog-content"},Wa={class:"form-grid"},Qa={class:"form-section"},Ja={class:"form-row"},Za={class:"form-row"},et={class:"form-row"},at={class:"form-section"},tt={class:"form-row"},lt={class:"form-section"},nt={class:"filter-item"},it={class:"quick-filter-buttons",style:{"margin-top":"10px",display:"flex",gap:"10px"}},st={class:"pagination-wrapper"},ot={class:"pagination-wrapper"},ut={class:"dialog-footer"},rt={class:"dialog-content"},ct={class:"form-section",style:{"margin-top":"20px"}},dt={class:"pagination-wrapper"},ht={class:"dialog-footer"},mt={__name:"KhuyenMaiSanPhamAdmin",setup(gt){const ke=ua(),H=r(""),N=r(""),R=r(null),$=r(null),E=r(""),M=r(!1),ie=r(!1),se=r(!1),oe=r(!1),U=r(!1),X=r(!1),Y=r(!1),q=r([]),A=r([]),C=r([]),O=r([]),P=r([]),G=r([]),w=r(null),ue=r(null),re=r(null),y=r({page:1,size:5,total:0}),h=r({page:1,size:5,total:0}),f=r({page:1,size:5,total:0}),T=r({page:1,size:5,total:0}),o=r({id:null,maKhuyenMai:"",tenKhuyenMai:"",moTa:"",phanTramGiam:0,mucDoUuTien:"1",ngayBatDau:"",ngayKetThuc:"",trangThai:"",doiTuongApDung:"ALL",idSanPhamList:[],idSanPhamChiTietList:[]}),B=r(null),Me={maKhuyenMai:[{min:3,message:"Mã khuyến mãi phải có ít nhất 3 ký tự",trigger:"blur"}],tenKhuyenMai:[{required:!0,message:"Tên khuyến mãi là bắt buộc",trigger:"blur"},{min:3,message:"Tên khuyến mãi phải có ít nhất 3 ký tự",trigger:"blur"}],phanTramGiam:[{type:"number",min:1,max:60,message:"Phần trăm giảm phải từ 1-60",trigger:"blur"}],mucDoUuTien:[{required:!0,message:"Vui lòng chọn mức độ ưu tiên",trigger:"change"}],ngayBatDau:[{required:!0,message:"Thời gian bắt đầu là bắt buộc",trigger:"change"},{validator:(a,e,i)=>{if(Y.value){i();return}e&&o.value.ngayBatDau&&new Date(e)<=new Date?i(new Error("Thời gian bắt đầu phải sau thời gian hiện tại")):i()},trigger:"change"}],ngayKetThuc:[{required:!0,message:"Thời gian kết thúc là bắt buộc",trigger:"change"},{validator:(a,e,i)=>{if(!e)return i(new Error("Thời gian kết thúc là bắt buộc"));const u=o.value.ngayBatDau?new Date(o.value.ngayBatDau):null,m=new Date(e),v=new Date;if(u&&m<=u)return i(new Error("Thời gian kết thúc phải sau thời gian bắt đầu"));if((!o.value.id||o.value.trangThai!=="EXPIRED")&&m<=v)return i(new Error("Thời gian kết thúc phải sau thời điểm hiện tại"));i()},trigger:"change"}],idSanPhamList:[{required:!0,message:"Vui lòng chọn ít nhất một sản phẩm",trigger:"change",type:"array",min:1}],idSanPhamChiTietList:[{required:!0,message:"Vui lòng chọn ít nhất một sản phẩm chi tiết",trigger:"change",type:"array",min:1}]},ge=F(()=>{const a=ra.state.roles;return Array.isArray(a)&&a.map(e=>typeof e=="string"?e:e.authority).includes("ROLE_ADMIN")}),ce=F(()=>{const a=(h.value.page-1)*h.value.size,e=a+h.value.size;return A.value.slice(a,e)}),de=F(()=>{const a=(f.value.page-1)*f.value.size,e=a+f.value.size;return C.value.slice(a,e)}),Pe=F(()=>{const a=(T.value.page-1)*T.value.size,e=a+T.value.size;return O.value.slice(a,e)}),b=async()=>{var a,e;M.value=!0;try{const i=await ba({search:H.value,trangThai:N.value,ngayBatDau:R.value,ngayKetThuc:$.value,page:y.value.page-1,size:y.value.size});q.value=i.content,y.value.total=i.totalElements}catch(i){_.error(((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||"Lỗi khi lấy danh sách khuyến mãi")}finally{M.value=!1}},j=r("ALL"),Ve=async()=>{j.value="LOW_STOCK",h.value.page=1,await V()},ze=async()=>{j.value="HIGH_STOCK",h.value.page=1,await V()},Ke=async()=>{j.value="ALL",E.value="",h.value.page=1,await V()},V=async()=>{ie.value=!0;try{const a=await wa({search:E.value,page:h.value.page-1,size:h.value.size,filter:j.value});A.value=a.map(e=>({...e,selected:P.value.includes(e.id)})),h.value.total=a.length}catch(a){_.error("Lỗi khi lấy danh sách sản phẩm"),console.error(a)}finally{ie.value=!1}};r(null),r({page:1,size:5,total:0}),F(()=>{const a=conflictSearch.value.toLowerCase();return a?conflictedSanPhamChiTiets.value.filter(e=>e.maSanPhamChiTiet.toLowerCase().includes(a)||e.khuyenMais.some(i=>i.maKhuyenMai.toLowerCase().includes(a)||i.tenKhuyenMai.toLowerCase().includes(a))):conflictedSanPhamChiTiets.value});const Le=async a=>{const e=(f.value.page-1)*f.value.size,i=Math.min(e+f.value.size,C.value.length);C.value=C.value.map((u,m)=>m>=e&&m<i?{...u,selected:a}:u),pe()},pe=()=>{G.value=C.value.filter(a=>a.selected).map(a=>a.id),o.value.idSanPhamChiTietList=G.value},ve=async a=>{if(!a.length){C.value=[],o.value.idSanPhamChiTietList=[],f.value.total=0;return}se.value=!0;try{const e=await Ma(a);C.value=e.map(i=>({...i,selected:G.value.includes(i.id)})),f.value.total=e.length}catch(e){_.error("Lỗi khi lấy danh sách sản phẩm chi tiết"),console.error(e)}finally{se.value=!1}},xe=async a=>{if(!a){O.value=[],T.value.total=0;return}oe.value=!0;try{const e=await Se(a);O.value=e,T.value.total=O.value.length}catch{_.error("Lỗi khi lấy danh sách sản phẩm chi tiết")}finally{oe.value=!1}},Ee=()=>{const a=A.value.filter(e=>e.selected);P.value=a.map(e=>e.id),o.value.idSanPhamList=P.value,ve(P.value)},Ue=()=>{Y.value=!1,o.value={id:null,maKhuyenMai:"",tenKhuyenMai:"",moTa:"",phanTramGiam:0,mucDoUuTien:"1",ngayBatDau:"",ngayKetThuc:"",trangThai:"",doiTuongApDung:"ALL",idSanPhamChiTietList:[]},P.value=[],G.value=[],C.value=[],E.value="",h.value.page=1,f.value.page=1,U.value=!0,_a(()=>{V(),ue.value&&ue.value.clearSelection(),re.value&&re.value.clearSelection(),B.value&&B.value.clearValidate()})},Ye=async a=>{if(Y.value=!0,B.value&&B.value.clearValidate(),o.value={...a,doiTuongApDung:a.doiTuongApDung||"ALL",mucDoUuTien:a.mucDoUuTien.toString(),idSanPhamChiTietList:a.idSanPhamChiTietList||[]},G.value=o.value.idSanPhamChiTietList,P.value=[],o.value.idSanPhamChiTietList.length){const i=(await Se(a.id)).map(u=>u.idSanPham);P.value=[...new Set(i)],await V(),await ve(i)}U.value=!0},Ae=async a=>{w.value=a,O.value=[],T.value.page=1,X.value=!0,a.id&&await xe(a.id)},Be=async()=>{B.value.validate(async a=>{if(a)try{M.value=!0;const e={...o.value,ngayBatDau:Te(o.value.ngayBatDau),ngayKetThuc:Te(o.value.ngayKetThuc)};Y.value?(await Sa(o.value.id,e),_.success("Cập nhật khuyến mãi thành công")):(await ka(e),_.success("Tạo khuyến mãi thành công")),U.value=!1,b()}catch(e){_.error((e==null?void 0:e.message)||"Lỗi khi lưu khuyến mãi")}finally{M.value=!1}else _.error("Vui lòng kiểm tra các lỗi trong form")})},Ie=async a=>{try{await Ta.confirm("Bạn có chắc chắn muốn xóa khuyến mãi này?","Xác nhận",{confirmButtonText:"Xóa",cancelButtonText:"Hủy",type:"warning"}),new Date(a.ngayBatDau)<new Date?_.error("Không thể xóa khuyến mại đã bắt đầu"):(M.value=!0,await Ca(a.id),_.success("Xóa khuyến mãi thành công"),b())}catch(e){e==="cancel"?_.info("Đã hủy xóa"):(console.error(e.message||"Lỗi khi xóa khuyến mãi"),_.error(e.message||"Lỗi khi xóa khuyến mãi"))}finally{M.value=!1}},He=a=>{if(!a)return;let e=new Date(a);const i=new Date;if(e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()&&e.getHours()===i.getHours()&&e.getMinutes()===i.getMinutes()&&e.setMinutes(e.getMinutes()+1),o.value.ngayBatDau=Ce(e).format("YYYY-MM-DD HH:mm"),!Y.value&&!o.value.ngayKetThuc){let u=new Date(e);u.setDate(e.getDate()+2),o.value.ngayKetThuc=Ce(u).format("YYYY-MM-DD HH:mm")}},Ne=a=>{A.value=A.value.map((e,i)=>{const u=(h.value.page-1)*h.value.size,m=u+h.value.size;return i>=u&&i<m?{...e,selected:a}:e})},Re=()=>{H.value="",N.value="",R.value=null,$.value=null,y.value.page=1,b()},$e=a=>{y.value.page=a,b()},Oe=a=>{y.value.size=a,y.value.page=1,b()},Ge=a=>{h.value.page=a},Fe=a=>{h.value.size=a,h.value.page=1},Xe=a=>{f.value.page=a},qe=a=>{f.value.size=a,f.value.page=1},je=a=>{T.value.page=a},We=a=>{T.value.size=a,T.value.page=1},W=a=>{if(!a)return"";const e=new Date(a),i=e.getDate().toString().padStart(2,"0"),u=(e.getMonth()+1).toString().padStart(2,"0"),m=e.getFullYear(),v=e.getHours().toString().padStart(2,"0"),K=e.getMinutes().toString().padStart(2,"0");return`${i}/${u}/${m} ${v}:${K}`},fe=a=>a==null?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),ye=a=>({NOT_STARTED:"Chưa bắt đầu",ACTIVE:"Đang hoạt động",EXPIRED:"Đã hết hạn"})[a]||"Không xác định",Qe=a=>({ALL:"Tất cả",NEW_CUSTOMER:"Khách hàng mới",OLD_CUSTOMER:"Khách hàng cũ"})[a]||"Không xác định",Je=a=>({1:"Thấp",2:"Trung bình",3:"Cao"})[a]||"Thấp",Ze=a=>({NOT_STARTED:"info",ACTIVE:"success",EXPIRED:"danger"})[a]||"info",ea=(a,e)=>{const i=new Date,u=new Date(a),m=new Date(e);return i<u?"NOT_STARTED":i>=u&&i<=m?"ACTIVE":"EXPIRED"},aa=()=>{q.value=q.value.map(a=>({...a,trangThai:ea(a.ngayBatDau,a.ngayKetThuc)}))},ta=({rowIndex:a})=>a%2===0?"even-row":"odd-row";function Te(a){if(!a)return null;const e=new Date(a),i=c=>c<10?"0"+c:c,u=e.getFullYear(),m=i(e.getMonth()+1),v=i(e.getDate()),K=i(e.getHours()),I=i(e.getMinutes()),J=i(e.getSeconds());return`${u}-${m}-${v}T${K}:${I}:${J}`}const la=async()=>{try{const a=await Da();return Math.max(1e3,a.delay||6e4)}catch(a){return a.name!=="AbortError"&&(console.error("Không thể lấy thời gian cập nhật:",a),ke.error("Không thể lấy thời gian cập nhật")),6e4}};le(()=>A.value.map(a=>({id:a.id,selected:a.selected})),()=>{Ee()},{deep:!0}),le(()=>C.value.map(a=>({id:a.id,selected:a.selected})),()=>{pe()},{deep:!0}),le([H,N,R,$],()=>{y.value.page=1,b()}),le(E,()=>{h.value.page=1,V()});let Q=null;return ca(()=>{b(),V();const a=la();Q=setInterval(aa,a)}),da(()=>{Q&&(clearInterval(Q),Q=null)}),(a,e)=>{const i=g("el-icon"),u=g("el-button"),m=g("el-input"),v=g("el-option"),K=g("el-select"),I=g("el-date-picker"),J=g("el-card"),c=g("el-table-column"),_e=g("el-tag"),he=g("el-tooltip"),Z=g("el-table"),ee=g("el-pagination"),D=g("el-form-item"),na=g("el-input-number"),ae=g("el-checkbox"),ia=g("el-form"),be=g("el-dialog"),S=g("el-descriptions-item"),sa=g("el-descriptions"),te=ha("loading");return z(),ma("div",Pa,[s("div",Va,[s("div",za,[e[18]||(e[18]=s("div",{class:"title-section"},[s("h1",{class:"page-title"},"Quản lý khuyến mãi sản phẩm"),s("p",{class:"page-subtitle"},"Tạo và quản lý các chương trình khuyến mãi sản phẩm")],-1)),ge.value?(z(),x(u,{key:0,type:"primary",size:"large",class:"create-btn",onClick:Ue},{default:n(()=>[t(i,{class:"btn-icon"},{default:n(()=>[t(k(ga))]),_:1}),e[17]||(e[17]=d(" Thêm khuyến mãi "))]),_:1})):me("",!0)])]),t(J,{class:"filters-card",shadow:"never"},{default:n(()=>[s("div",Ka,[s("div",La,[s("div",xa,[e[19]||(e[19]=s("label",{class:"filter-label"},"Tìm kiếm",-1)),t(m,{modelValue:H.value,"onUpdate:modelValue":e[0]||(e[0]=l=>H.value=l),placeholder:"Tìm kiếm theo mã hoặc tên...",clearable:"",class:"filter-input",onInput:b},{prefix:n(()=>[t(i,{class:"search-icon"},{default:n(()=>[t(k(we))]),_:1})]),_:1},8,["modelValue"])]),s("div",Ea,[e[20]||(e[20]=s("label",{class:"filter-label"},"Trạng thái",-1)),t(K,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l),placeholder:"Chọn trạng thái",clearable:"",class:"filter-select",onChange:b},{default:n(()=>[t(v,{label:"Tất cả",value:""}),t(v,{label:"Chưa bắt đầu",value:"NOT_STARTED"}),t(v,{label:"Đang hoạt động",value:"ACTIVE"}),t(v,{label:"Đã hết hạn",value:"EXPIRED"})]),_:1},8,["modelValue"])]),s("div",Ua,[e[21]||(e[21]=s("label",{class:"filter-label"},"Thời gian bắt đầu",-1)),t(I,{modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=l=>R.value=l),type:"date",placeholder:"Chọn thời gian bắt đầu","value-format":"YYYY-MM-DD",clearable:"",class:"filter-date",onChange:b},null,8,["modelValue"])]),s("div",Ya,[e[22]||(e[22]=s("label",{class:"filter-label"},"Thời gian kết thúc",-1)),t(I,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=l=>$.value=l),type:"date",placeholder:"Chọn thời gian kết thúc","value-format":"YYYY-MM-DD",clearable:"",class:"filter-date",onChange:b},null,8,["modelValue"])]),s("div",Aa,[t(u,{onClick:Re,class:"reset-btn"},{default:n(()=>[t(i,null,{default:n(()=>[t(k(pa))]),_:1}),e[23]||(e[23]=d(" Làm mới "))]),_:1})])])])]),_:1}),t(J,{class:"table-card",shadow:"never"},{default:n(()=>[ne((z(),x(Z,{data:q.value,class:"promotion-table","row-class-name":ta,"empty-text":"Không có dữ liệu"},{default:n(()=>[t(c,{label:"STT",width:"75",align:"center"},{default:n(l=>[s("span",Ba,p(l.$index+1+(y.value.page-1)*y.value.size),1)]),_:1}),t(c,{prop:"maKhuyenMai",label:"Mã khuyến mãi","min-width":"145"},{default:n(l=>[s("div",Ia,[t(_e,{type:"info",size:"small",class:"code-tag"},{default:n(()=>[d(p(l.row.maKhuyenMai),1)]),_:2},1024)])]),_:1}),t(c,{prop:"tenKhuyenMai",label:"Tên khuyến mãi","min-width":"170"},{default:n(l=>[s("div",Ha,[s("span",Na,p(l.row.tenKhuyenMai),1)])]),_:1}),t(c,{label:"Phần trăm giảm",width:"150",align:"center"},{default:n(l=>[s("div",Ra,[s("span",$a,p(l.row.phanTramGiam)+"%",1)])]),_:1}),t(c,{label:"Thời gian",width:"180"},{default:n(l=>[s("div",Oa,[s("div",Ga,[t(i,{class:"date-icon"},{default:n(()=>[t(k(De))]),_:1}),s("span",null,p(W(l.row.ngayBatDau)),1)]),e[24]||(e[24]=s("div",{class:"date-separator"},"→",-1)),s("div",Fa,[t(i,{class:"date-icon"},{default:n(()=>[t(k(De))]),_:1}),s("span",null,p(W(l.row.ngayKetThuc)),1)])])]),_:1}),t(c,{label:"Trạng thái",width:"140",align:"center"},{default:n(l=>[t(_e,{type:Ze(l.row.trangThai),size:"small"},{default:n(()=>[d(p(ye(l.row.trangThai)),1)]),_:2},1032,["type"])]),_:1}),ge.value?(z(),x(c,{key:0,label:"Thao tác",width:"200",align:"center",fixed:"right"},{default:n(l=>[s("div",Xa,[t(he,{content:"Xem chi tiết",placement:"top"},{default:n(()=>[t(u,{size:"small",type:"info",icon:k(va),circle:"",onClick:L=>Ae(l.row),class:"action-btn view-btn"},null,8,["icon","onClick"])]),_:2},1024),t(he,{content:"Chỉnh sửa",placement:"top"},{default:n(()=>[t(u,{size:"small",type:"primary",icon:k(fa),circle:"",onClick:L=>Ye(l.row),class:"action-btn edit-btn"},null,8,["icon","onClick"])]),_:2},1024),t(he,{content:"Xóa",placement:"top"},{default:n(()=>[t(u,{size:"small",type:"danger",icon:k(ya),circle:"",onClick:L=>Ie(l.row),class:"action-btn delete"},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})):me("",!0)]),_:1},8,["data"])),[[te,M.value]]),s("div",qa,[t(ee,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":y.value.page,"page-size":y.value.size,"page-sizes":[5,10,20,50],total:y.value.total,onCurrentChange:$e,onSizeChange:Oe,class:"custom-pagination"},null,8,["current-page","page-size","total"])])]),_:1}),t(be,{modelValue:U.value,"onUpdate:modelValue":e[14]||(e[14]=l=>U.value=l),width:"1100px",style:{"margin-top":"30px"},class:"promotion-dialog","close-on-click-modal":!1},{footer:n(()=>[s("div",ut,[t(u,{onClick:e[13]||(e[13]=l=>U.value=!1),size:"large",class:"cancel-btn"},{default:n(()=>e[31]||(e[31]=[d("Hủy")])),_:1}),t(u,{type:"primary",onClick:Be,size:"large",class:"save-btn",loading:M.value},{default:n(()=>[d(p(Y.value?"Cập nhật":"Tạo mới"),1)]),_:1},8,["loading"])])]),default:n(()=>[s("div",ja,[t(ia,{model:o.value,"label-position":"top",class:"promotion-form",rules:Me,ref_key:"formRef",ref:B},{default:n(()=>[s("div",Wa,[s("div",Qa,[e[25]||(e[25]=s("h3",{class:"section-title"},"Thông tin cơ bản",-1)),s("div",Ja,[t(D,{label:"Mã khuyến mãi",prop:"maKhuyenMai",class:"form-item"},{default:n(()=>[t(m,{modelValue:o.value.maKhuyenMai,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.maKhuyenMai=l),placeholder:"Mã tự động",readonly:!!o.value.id},null,8,["modelValue","readonly"])]),_:1}),t(D,{label:"Tên khuyến mãi *",prop:"tenKhuyenMai",class:"form-item"},{default:n(()=>[t(m,{modelValue:o.value.tenKhuyenMai,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.tenKhuyenMai=l),placeholder:"Nhập tên khuyến mãi"},null,8,["modelValue"])]),_:1})]),s("div",Za,[t(D,{label:"Phần trăm giảm",prop:"phanTramGiam",class:"form-item"},{default:n(()=>[t(na,{modelValue:o.value.phanTramGiam,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.phanTramGiam=l),min:1,max:100,placeholder:"0",class:"full-width"},null,8,["modelValue"])]),_:1}),t(D,{label:"Mức độ ưu tiên",prop:"mucDoUuTien",class:"form-item"},{default:n(()=>[t(K,{modelValue:o.value.mucDoUuTien,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.mucDoUuTien=l),placeholder:"Chọn đối tượng áp dụng"},{default:n(()=>[t(v,{label:"Cao",value:"3"}),t(v,{label:"Trung bình",value:"2"}),t(v,{label:"Thấp",value:"1"})]),_:1},8,["modelValue"])]),_:1})]),s("div",et,[t(D,{label:"Đối tượng áp dụng",prop:"doiTuongApDung",class:"form-item"},{default:n(()=>[t(K,{modelValue:o.value.doiTuongApDung,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.doiTuongApDung=l),placeholder:"Chọn đối tượng áp dụng"},{default:n(()=>[t(v,{label:"Tất cả",value:"ALL"}),t(v,{label:"Khách hàng mới",value:"NEW_CUSTOMER"}),t(v,{label:"Khách hàng cũ",value:"OLD_CUSTOMER"})]),_:1},8,["modelValue"])]),_:1})]),t(D,{label:"Mô tả",prop:"moTa",class:"form-item full-width"},{default:n(()=>[t(m,{modelValue:o.value.moTa,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.moTa=l),type:"textarea",rows:3,placeholder:"Nhập mô tả khuyến mãi"},null,8,["modelValue"])]),_:1})]),s("div",at,[e[26]||(e[26]=s("h3",{class:"section-title"},"Thời gian hiệu lực",-1)),s("div",tt,[t(D,{label:"Thời gian bắt đầu",prop:"ngayBatDau",class:"form-item"},{default:n(()=>[t(I,{modelValue:o.value.ngayBatDau,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.ngayBatDau=l),type:"datetime",placeholder:"Chọn thời gian bắt đầu",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","default-time":[new Date(2e3,1,1,0,0,0)],"show-seconds":!1,class:"full-width",onChange:He},null,8,["modelValue","default-time"])]),_:1}),t(D,{label:"Thời gian kết thúc",prop:"ngayKetThuc",class:"form-item"},{default:n(()=>[t(I,{modelValue:o.value.ngayKetThuc,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.ngayKetThuc=l),type:"datetime",placeholder:"Chọn thời gian kết thúc",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","default-time":[new Date(2e3,1,1,0,0,0)],"show-seconds":!1,class:"full-width"},null,8,["modelValue","default-time"])]),_:1})])]),s("div",lt,[e[30]||(e[30]=s("h3",{class:"section-title"},"Sản phẩm áp dụng",-1)),s("div",nt,[t(m,{modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=l=>E.value=l),placeholder:"Tìm kiếm theo mã hoặc tên...",clearable:"",class:"filter-input",onInput:V},{prefix:n(()=>[t(i,{class:"search-icon"},{default:n(()=>[t(k(we))]),_:1})]),_:1},8,["modelValue"])]),s("div",it,[t(u,{type:"primary",size:"small",onClick:Ve},{default:n(()=>e[27]||(e[27]=[d("Sản phẩm sắp hết hàng")])),_:1}),t(u,{type:"info",size:"small",onClick:ze},{default:n(()=>e[28]||(e[28]=[d("Sản phẩm tồn kho nhiều")])),_:1}),t(u,{type:"default",size:"small",onClick:Ke},{default:n(()=>e[29]||(e[29]=[d("Tất cả sản phẩm")])),_:1})]),t(D,{label:"Danh sách sản phẩm",prop:"idSanPhamList",class:"form-item full-width",style:{"margin-top":"10px"}},{default:n(()=>[ne((z(),x(Z,{data:ce.value,class:"product-table",border:"",ref_key:"productTable",ref:ue,"row-key":l=>l.id},{default:n(()=>[t(c,{prop:"selected",width:"80"},{header:n(()=>[t(ae,{"model-value":ce.value.length>0&&ce.value.every(l=>l.selected),onChange:Ne},null,8,["model-value"])]),default:n(({row:l})=>[t(ae,{modelValue:l.selected,"onUpdate:modelValue":L=>l.selected=L},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(c,{prop:"maSanPham",label:"Mã sản phẩm",width:"200"}),t(c,{prop:"tenSanPham",label:"Tên sản phẩm","min-width":"200"})]),_:1},8,["data","row-key"])),[[te,ie.value]]),s("div",st,[t(ee,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":h.value.page,"page-size":h.value.size,"page-sizes":[5,10,20,50],total:h.value.total,onCurrentChange:Ge,onSizeChange:Fe,class:"custom-pagination"},null,8,["current-page","page-size","total"])])]),_:1}),P.value.length?(z(),x(D,{key:0,label:"Sản phẩm chi tiết",class:"form-item full-width",prop:"idSanPhamChiTietList"},{default:n(()=>[ne((z(),x(Z,{data:de.value,class:"product-detail-table",border:"",ref_key:"sanPhamChiTietTable",ref:re,"row-key":l=>l.id},{default:n(()=>[t(c,{prop:"selected",width:"70"},{header:n(()=>[t(ae,{"model-value":de.value.length>0&&de.value.every(l=>l.selected),onChange:Le},null,8,["model-value"])]),default:n(({row:l})=>[t(ae,{modelValue:l.selected,"onUpdate:modelValue":L=>l.selected=L,onChange:L=>a.checkExistingPromotions(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(c,{prop:"maSanPhamChiTiet",label:"Mã SPCT",width:"150"}),t(c,{prop:"soLuongSPCT",label:"Số lượng","min-width":"100"}),t(c,{prop:"tenMau",label:"Màu sắc",width:"150"}),t(c,{prop:"dungLuongRom",label:"Kích thước",width:"130"}),t(c,{prop:"giaBan",label:"Giá bán",width:"150"},{default:n(l=>[d(p(fe(l.row.giaBan)),1)]),_:1})]),_:1},8,["data","row-key"])),[[te,se.value]]),s("div",ot,[t(ee,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":f.value.page,"page-size":f.value.size,"page-sizes":[5,10,20,50],total:f.value.total,onCurrentChange:Xe,onSizeChange:qe,class:"custom-pagination"},null,8,["current-page","page-size","total"])])]),_:1})):me("",!0)])])]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(be,{modelValue:X.value,"onUpdate:modelValue":e[16]||(e[16]=l=>X.value=l),width:"1000px",style:{"margin-top":"30px"},class:"promotion-dialog","close-on-click-modal":!1},{footer:n(()=>[s("div",ht,[t(u,{onClick:e[15]||(e[15]=l=>X.value=!1),size:"large",class:"cancel-btn"},{default:n(()=>e[34]||(e[34]=[d("Đóng")])),_:1})])]),default:n(()=>[s("div",rt,[e[33]||(e[33]=s("h3",{class:"section-title"},"Chi tiết khuyến mãi",-1)),t(sa,{column:2,border:""},{default:n(()=>[t(S,{label:"Mã khuyến mãi"},{default:n(()=>{var l;return[d(p((l=w.value)==null?void 0:l.maKhuyenMai),1)]}),_:1}),t(S,{label:"Tên khuyến mãi"},{default:n(()=>{var l;return[d(p((l=w.value)==null?void 0:l.tenKhuyenMai),1)]}),_:1}),t(S,{label:"Phần trăm giảm"},{default:n(()=>{var l;return[d(p((l=w.value)==null?void 0:l.phanTramGiam)+"%",1)]}),_:1}),t(S,{label:"Mức độ ưu tiên"},{default:n(()=>{var l;return[d(p(Je((l=w.value)==null?void 0:l.mucDoUuTien)),1)]}),_:1}),t(S,{label:"Thời gian bắt đầu"},{default:n(()=>{var l;return[d(p(W((l=w.value)==null?void 0:l.ngayBatDau)),1)]}),_:1}),t(S,{label:"Thời gian kết thúc"},{default:n(()=>{var l;return[d(p(W((l=w.value)==null?void 0:l.ngayKetThuc)),1)]}),_:1}),t(S,{label:"Đối tượng áp dụng"},{default:n(()=>{var l;return[d(p(Qe((l=w.value)==null?void 0:l.doiTuongApDung)),1)]}),_:1}),t(S,{label:"Trạng thái"},{default:n(()=>{var l;return[d(p(ye((l=w.value)==null?void 0:l.trangThai)),1)]}),_:1}),t(S,{label:"Mô tả",span:2},{default:n(()=>{var l;return[d(p(((l=w.value)==null?void 0:l.moTa)||"Không có mô tả"),1)]}),_:1})]),_:1}),s("div",ct,[e[32]||(e[32]=s("h3",{class:"section-title"},"Sản phẩm chi tiết áp dụng",-1)),ne((z(),x(Z,{data:Pe.value,class:"product-detail-table",border:""},{default:n(()=>[t(c,{prop:"maSanPhamChiTiet",label:"Mã SPCT",width:"160"}),t(c,{prop:"soLuongSPCT",label:"Số lượng","min-width":"160"}),t(c,{prop:"tenMau",label:"Màu sắc",width:"180"}),t(c,{prop:"dungLuongRom",label:"Kích thước",width:"160"}),t(c,{prop:"giaBan",label:"Giá bán",width:"200"},{default:n(l=>[d(p(fe(l.row.giaBan)),1)]),_:1})]),_:1},8,["data"])),[[te,oe.value]]),s("div",dt,[t(ee,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":T.value.page,"page-size":T.value.size,"page-sizes":[5,10,20,50],total:T.value.total,onCurrentChange:je,onSizeChange:We,class:"custom-pagination"},null,8,["current-page","page-size","total"])])])])]),_:1},8,["modelValue"])])}}},ft=oa(mt,[["__scopeId","data-v-4e074cee"]]);export{ft as default};
