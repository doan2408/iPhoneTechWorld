import{_ as re,r as p,z as ce,A as de,c as S,a1 as ge,T as R,w as me,o as pe,a as c,b as d,d as h,e as g,f as l,i as o,h as C,j as U,L as Ne,t as u,F as z,m as O,B as T,k as f,y as $,a6 as fe,n as y,a7 as _e,E as V,R as ve,G as be}from"./index-BFtI-PwE.js";import{g as Ce,u as ye,a as Ve}from"./DiaChiServices-DHZKHsuW.js";import{p as ke,w as Pe}from"./ward-CwBRO0K0.js";const Te={class:"address-view"},we={class:"header-section"},xe={key:0},De={key:1},Ae={class:"address-list"},Me={class:"address-content"},Be={class:"address-details"},Ee={class:"address-actions"},Se={class:"action-buttons"},Ue={class:"footer-actions"},ze={key:0,class:"error-message"},Oe={key:0,class:"error-message"},qe={key:0,class:"error-message"},Fe={key:0,class:"error-message"},Ke={key:0,class:"error-message"},je={class:"switch-container"},He={key:0,class:"note"},Le={key:0,class:"error-message"},Re={class:"dialog-footer"},$e={__name:"AddressesClient",setup(Je){const v=p([]),J=p(null),Z=p(null);ce();const X=de(),x=S(()=>ge.getters.user||null);console.log(x);const i=R({}),D=p(Object.values(ke)),A=p(Object.values(Pe).flat()),k=p(!1),b=p(!1),M=p(!1),q=p({}),a=R({id:null,tenNguoiNhan:"",sdtNguoiNhan:"",emailNguoiNhan:"",soNha:"",tenDuong:"",xaPhuong:null,tinhThanhPho:null,diaChiChinh:!1}),I=S(()=>a.tinhThanhPho?A.value.filter(t=>t.parent_code===String(a.tinhThanhPho)):[]);me(()=>a.tinhThanhPho,()=>{a.xaPhuong=null});const G={tenNguoiNhan:[{required:!0,message:"Vui lòng nhập tên người nhận",trigger:"blur"}],sdtNguoiNhan:[{required:!0,message:"Vui lòng nhập số điện thoại",trigger:"blur"},{pattern:/^[0-9]{10}$/,message:"Số điện thoại không hợp lệ",trigger:"blur"}],soNha:[{required:!0,message:"Vui lòng nhập thông tin cụ thể",trigger:"blur"}],tenDuong:[{required:!0,message:"Vui lòng nhập thôn/làng",trigger:"blur"}],xaPhuong:[{required:!0,message:"Vui lòng chọn xã/phường",trigger:"blur"}],emailNguoiNhan:[{required:!0,message:"Vui lòng nhập email người nhận",trigger:"blur"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[a-zA-Z0-9]\.com$/i,message:"Email không đúng định dạng",trigger:["blur","change"]}],tinhThanhPho:[{required:!0,message:"Vui lòng chọn tỉnh/thành phố",trigger:"blur"}]},w=p(),F=async()=>{var t;try{const n=(t=x.value)==null?void 0:t.id;console.log(n),console.log(n);const s=await Ce(n);v.value=s}catch(n){J.value=n}},K=()=>{var t;Object.assign(a,{id:null,tenNguoiNhan:"",sdtNguoiNhan:"",soNha:"",tenDuong:"",xaPhuong:null,emailNguoiNhan:"",tinhThanhPho:null,diaChiChinh:!1}),(t=w.value)==null||t.clearValidate()},Q=()=>{if(v.value.length>=5){V.warning("Mỗi khách hàng chỉ được phép có tối đa 5 địa chỉ");return}b.value=!1,K(),k.value=!0},B=p(!1),W=t=>{b.value=!0,a.id=t.id,a.tenNguoiNhan=t.tenNguoiNhan,a.sdtNguoiNhan=t.sdtNguoiNhan,a.emailNguoiNhan=t.emailNguoiNhan,a.soNha=t.soNha,a.tenDuong=t.tenDuong,a.diaChiChinh=t.diaChiChinh;const n=D.value.find(s=>s.name===t.tinhThanhPho);a.tinhThanhPho=(n==null?void 0:n.code)||"",be(()=>{const s=A.value.find(r=>r.name===t.xaPhuong&&r.parent_code===a.tinhThanhPho);a.xaPhuong=(s==null?void 0:s.code)||""}),B.value=t.diaChiChinh,q.value=JSON.parse(JSON.stringify(a)),k.value=!0},Y=S(()=>JSON.stringify(a)!==JSON.stringify(q.value)),E=()=>{k.value=!1,K()},ee=async()=>{var t;if(w.value)try{await w.value.validate(),await ve.confirm(b.value?"Bạn có chắc chắn muốn cập nhật địa chỉ này?":"Bạn có chắc chắn muốn thêm địa chỉ mới?","Xác nhận",{confirmButtonText:"Đồng ý",cancelButtonText:"Hủy",type:"warning"}).catch(()=>{throw"cancel"}),M.value=!0;const n=(t=x.value)==null?void 0:t.id;Object.keys(i).forEach(m=>delete i[m]);const s=D.value.find(m=>m.code===a.tinhThanhPho),r=A.value.find(m=>m.code===a.xaPhuong);if(!s||!r){V.warning("Vui lòng chọn tỉnh và xã hợp lệ.");return}const N={id:a.id,tenNguoiNhan:a.tenNguoiNhan,sdtNguoiNhan:a.sdtNguoiNhan,soNha:a.soNha,tenDuong:a.tenDuong,xaPhuong:(r==null?void 0:r.name)||"",emailNguoiNhan:a.emailNguoiNhan,tinhThanhPho:(s==null?void 0:s.name)||"",diaChiChinh:a.diaChiChinh,idKhachHang:n};if(b.value){const m=await ye(N.id,N);console.log(m),console.log("Updating address:",N),V.success("Cập nhật địa chỉ thành công!")}else{const m=await Ve(N);console.log(m),console.log("Adding new address:",N),V.success("Thêm địa chỉ thành công!")}await F(),E()}catch(n){if(n==="cancel")return;console.error("Form validation failed:",n),Array.isArray(n)?n.forEach(({field:s,message:r})=>{i[s]=r}):V.error("Cập nhật địa chỉ thất bại")}finally{M.value=!1}},ne=t=>{const n=v.value.find(s=>s.id===t);n&&W(n)},ae=()=>{Q()},le=()=>{X.push("/client/home")};function te(t){B.value===!0&&t===!1&&(a.diaChiChinh=!0,V.error("Không thể bỏ trạng thái địa chỉ chính. Mỗi khách hàng phải có ít nhất một địa chỉ chính."))}return pe(()=>{F()}),(t,n)=>{const s=c("el-icon"),r=c("el-button"),N=c("el-descriptions-item"),m=c("el-descriptions"),oe=c("el-tag"),ie=c("el-card"),P=c("el-input"),_=c("el-form-item"),j=c("el-option"),H=c("el-select"),se=c("el-switch"),he=c("el-form"),ue=c("el-dialog");return h(),d("div",Te,[g("div",we,[v.value.length==0?(h(),d("h2",xe,"Bạn chưa cập nhật địa chỉ")):(h(),d("h2",De,"Địa chỉ giao hàng")),l(r,{type:"primary",onClick:ae,disabled:v.value.length>=5,class:"add-address-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(U(Ne))]),_:1}),C(" Thêm địa chỉ ("+u(v.value.length)+"/5) ",1)]),_:1},8,["disabled"])]),g("div",Ae,[(h(!0),d(z,null,O(v.value,e=>(h(),T(ie,{key:e.id,class:y(["address-card",{"is-default":e.diaChiChinh}]),shadow:"hover",onClick:L=>!e.diaChiChinh&&t.selectAddress(e.id)},{default:o(()=>[g("div",Me,[g("div",Be,[l(m,{column:1,border:""},{default:o(()=>[l(N,{label:"Người nhận:"},{default:o(()=>[g("span",null,u(e.tenNguoiNhan!=null?e.tenNguoiNhan:"Không có thông tin"),1)]),_:2},1024),l(N,{label:"Số điện thoại:"},{default:o(()=>[g("span",null,u(e.sdtNguoiNhan!=null?e.sdtNguoiNhan:"Không có thông tin"),1)]),_:2},1024),l(N,{label:"Địa chỉ:"},{default:o(()=>[g("span",null,u(e.soNha!=null?e.soNha:"")+u(e.soNha?", ":"")+u(e.tenDuong!=null?e.tenDuong:"")+u(e.tenDuong?", ":"")+" "+u(e.xaPhuong!=null?e.xaPhuong:"")+u(e.xaPhuong?", ":"")+u(e.tinhThanhPho!=null?e.tinhThanhPho:""),1)]),_:2},1024)]),_:2},1024)]),g("div",Ee,[e.diaChiChinh?(h(),T(oe,{key:0,type:"danger",effect:"plain",class:"default-tag"},{default:o(()=>n[9]||(n[9]=[C(" Mặc định ")])),_:1})):f("",!0),g("div",Se,[l(r,{type:"primary",size:"small",circle:"",onClick:$(L=>ne(e.id),["stop"]),title:"Chỉnh sửa"},{default:o(()=>[l(s,null,{default:o(()=>[l(U(fe))]),_:1})]),_:2},1032,["onClick"]),Z.value===e.id&&!e.diaChiChinh?(h(),T(r,{key:0,type:"success",size:"small",onClick:$(L=>t.setPrimary(e),["stop"]),class:"set-primary-btn"},{default:o(()=>n[10]||(n[10]=[C(" Đặt làm mặc định ")])),_:2},1032,["onClick"])):f("",!0)])])])]),_:2},1032,["class","onClick"]))),128)),g("div",Ue,[l(r,{onClick:le,type:"info"},{default:o(()=>[l(s,null,{default:o(()=>[l(U(_e))]),_:1}),n[11]||(n[11]=C(" Quay lại "))]),_:1})])]),l(ue,{modelValue:k.value,"onUpdate:modelValue":n[8]||(n[8]=e=>k.value=e),title:b.value?"Chỉnh sửa địa chỉ":"Thêm địa chỉ mới",width:"600px","before-close":E},{footer:o(()=>[g("div",Re,[l(r,{onClick:E},{default:o(()=>n[12]||(n[12]=[C("Hủy")])),_:1}),l(r,{type:"primary",onClick:ee,loading:M.value,disabled:b.value&&!Y.value},{default:o(()=>[C(u(b.value?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading","disabled"])])]),default:o(()=>[l(he,{ref_key:"formRef",ref:w,model:a,rules:G,"label-width":"140px","label-position":"left"},{default:o(()=>[l(_,{label:"Tên người nhận",prop:"tenNguoiNhan"},{default:o(()=>[l(P,{modelValue:a.tenNguoiNhan,"onUpdate:modelValue":n[0]||(n[0]=e=>a.tenNguoiNhan=e),placeholder:"Nhập tên người nhận",clearable:"",class:y({"is-error":i.tenNguoiNhan})},null,8,["modelValue","class"]),i.tenNguoiNhan?(h(),d("div",ze,u(i.tenNguoiNhan),1)):f("",!0)]),_:1}),l(_,{label:"Số điện thoại",prop:"sdtNguoiNhan"},{default:o(()=>[l(P,{modelValue:a.sdtNguoiNhan,"onUpdate:modelValue":n[1]||(n[1]=e=>a.sdtNguoiNhan=e),placeholder:"Nhập số điện thoại",clearable:"",maxlength:"10",class:y({"is-error":i.sdtNguoiNhan})},null,8,["modelValue","class"]),i.sdtNguoiNhan?(h(),d("div",Oe,u(i.sdtNguoiNhan),1)):f("",!0)]),_:1}),l(_,{label:"Email người nhận",prop:"emailNguoiNhan"},{default:o(()=>[l(P,{modelValue:a.emailNguoiNhan,"onUpdate:modelValue":n[2]||(n[2]=e=>a.emailNguoiNhan=e),placeholder:"Nhập email người nhận",clearable:"",class:y({"is-error":i.emailNguoiNhan})},null,8,["modelValue","class"]),i.emailNguoiNhan?(h(),d("div",qe,u(i.emailNguoiNhan),1)):f("",!0)]),_:1}),l(_,{label:"Tỉnh/Thành phố",prop:"tinhThanhPho"},{default:o(()=>[l(H,{modelValue:a.tinhThanhPho,"onUpdate:modelValue":n[3]||(n[3]=e=>a.tinhThanhPho=e),placeholder:"Chọn tỉnh/thành phố",clearable:"",filterable:""},{default:o(()=>[(h(!0),d(z,null,O(D.value,e=>(h(),T(j,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"Xã/Phường",prop:"xaPhuong"},{default:o(()=>[l(H,{modelValue:a.xaPhuong,"onUpdate:modelValue":n[4]||(n[4]=e=>a.xaPhuong=e),disabled:!a.tinhThanhPho,placeholder:"Chọn xã/phường",clearable:"",filterable:""},{default:o(()=>[(h(!0),d(z,null,O(I.value,e=>(h(),T(j,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(_,{label:"Thôn/làng",prop:"tenDuong"},{default:o(()=>[l(P,{modelValue:a.tenDuong,"onUpdate:modelValue":n[5]||(n[5]=e=>a.tenDuong=e),placeholder:"Nhập tên thôn/làng",clearable:"",class:y({"is-error":i.tenDuong})},null,8,["modelValue","class"]),i.tenDuong?(h(),d("div",Fe,u(i.tenDuong),1)):f("",!0)]),_:1}),l(_,{label:"Cụ thể",prop:"soNha"},{default:o(()=>[l(P,{modelValue:a.soNha,"onUpdate:modelValue":n[6]||(n[6]=e=>a.soNha=e),placeholder:"Nhập thông tin cụ thể",clearable:"",class:y({"is-error":i.soNha})},null,8,["modelValue","class"]),i.soNha?(h(),d("div",Ke,u(i.soNha),1)):f("",!0)]),_:1}),l(_,{label:"Địa chỉ chính"},{default:o(()=>[g("div",je,[l(se,{modelValue:a.diaChiChinh,"onUpdate:modelValue":n[7]||(n[7]=e=>a.diaChiChinh=e),onChange:te,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"]),B.value?(h(),d("span",He," (Địa chỉ chính không thể bỏ chọn) ")):f("",!0)]),i.diaChiChinh?(h(),d("div",Le,u(i.diaChiChinh),1)):f("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ge=re($e,[["__scopeId","data-v-edaaeda0"]]);export{Ge as default};
